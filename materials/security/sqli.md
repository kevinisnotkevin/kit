# SQLi

SQLi (SQL Injection) - атака, нацеленная на веб-приложения и БД, которая использует уязвимости в коде приложения, внедряет вредоносные операторы SQL и использует их для получения несанкционированного доступа или манипулирования данными в БД. Используется для манипулирования данных в БД без авторизации. 

Успешная инъекционная атака может подделать удостоверения, создать новые удостоверения с правами администратора, получить доступ ко всем данным на сервере или уничтожить / изменить данные, чтобы сделать их непригодными для использования.

## Blind SQLi

Blind SQLi - возникает, когда веб-приложение уязвимо для SQLi, но HTTP-ответы не содержат результатов атаки или сведений об ошибках БД.

## Описание 

- Обнаружение полей ввода в веб-приложении в веб-приложении (Например, текстовые поля или параметры URL-адреса);
- Проверка уязвимости этих полей для внедрения SQL-кода;
- Внедрение SQL-кода для управления базовым запросом SQL или выполнения дополнительных запросов к БД.

## Способы защиты

- Использовать параметризированные запросы и подготовленные операторы;
- Проверять ввод пользователя;
- Ограничивать разрешения БД.




## Пример

Вводимые пользователем в форму имя и пароль всегда сверяются с данными из БД. Если там всё верно и нет никаких ошибок, то веб-страница разрешит ему доступ.

```sql
SELECT * FROM users WHERE username=’login’ and password=’pass’;
```
- В БД отправляется такой SQL-запрос

В этом случае произойдёт извлечение из таблицы users всех тех записей, где указано имя пользователя ProvidedUsername, а пароль - ProvidedPassword. Если в таблице найдётся запись, соблюдающая оба этих условия, то пользователь правильно ввёл имя и пароль. А значит, ему откроется доступ.

Теперь предположим, что вместо имени пользователь введёт вот это:

```sql
a’ OR 1=1;--
```

А вместо пароля - случайный набор символов. Приложение сформирует следующее SQL-выражение:

```sql
SELECT * FROM users WHERE username=’a’ OR 1=1;--’ and password=’RandomPass’;
```

При обработке этого запроса БД извлечёт запись из таблицы с именем users, если в ней имя пользователя указано как a. Она будет извлечена и в случае выполнения второго условия - если выражение 1=1 верно. То есть тут используется принцип «‎верно это значение ИЛИ то значение». А так как 1=1 верно всегда, при вводе такого запроса будут извлечены все записи из таблицы.

Обратите также внимание на дублирующийся дефис в SQL-выражении. Его используют для комментариев - получается, что остальная часть строки будет закомментирована. То есть БД её обрабатывать не будет.

Комментарии могут быть двух типов: однострочные и многострочные. Синтаксис комментариев зависит от системы, к которой выполняется запрос. Приведенные выше примеры подходят для систем MS SQL Server и Oracle, являющимися самыми распространенными.

Получается, что БД выполнит только эту часть запроса:

```sql
SELECT * FROM users WHERE username=’a’ OR 1=1;--’ and password=’RandomPass’;
```

При обработке запроса БД извлечёт список записей, которые отличаются от NULL. Следовательно, пользователь получит доступ.

## **Типы SQLi**

Существует 5 основных типов SQL инъекций:

1. Классическая (In-Band или Union-based). Самая опасная и редко встречающаяся сегодня атака. Позволяет сразу получать любые данные из базы.
2. Error-based. Позволяет получать информацию о базе, таблицах и данных на основе выводимого текста ошибки СУБД.
3. Boolean-based. Вместо получения всех данных, атакующий может поштучно их перебирать, ориентируясь на простой ответ типа true/false.
4. Time-based. Похожа на предыдущую атаку принципом перебора, манипулируя временем отклика базы.
5. Out-of-Band. Очень редкие и специфические типы атак, основанные на индивидуальных особенностях баз данных.