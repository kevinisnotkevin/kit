# CSRF

CSRF (Cross-Site Request Forgery) – атака, при которой используется доверие браузера пользователя к веб-приложению, чтобы обманным путем заставить браузер пользователя выполнять нежелательные действия в веб-приложении, в котором пользователь в данный момент аутентифицирован с целью изменения данных, повышения привилегий, поглощения аккаунта. 

Описание атаки: 
- Пользователь входит в уязвимое веб-приложение
- Веб-приложение возвращает файл cookie в браузер пользователя, указывая, что пользователь прошел аутентификацию
- Злоумышленник создает вредоносную ссылку или встраивает вредоносный код на другой веб-сайт
- Пользователь посещает веб-сайт злоумышленника, что запускает вредоносный код
- Код злоумышленника отправляет запрос целевому веб-приложению, используя аутентифицированный файл cookie пользователя
- Уязвимое веб-приложение выполняет вредоносное действие от лица пользователя

Для защиты от атаки рекомендуется: Использовать CSRF токены, использовать SameSite заголовок, использовать CSP заголовок, использовать CORS заголовки.

Пользователю достаточно перейти по ссылке от мошенника, которая может быть изменена с помощью сокращателя. Например, человек, авторизованный на сайте банка, может кликнуть по фишинговой ссылке с запросом на перевод денег на счет мошенника. Из-за авторизации обработается запрос на перевод.

CSRF-атака не подходит для кражи конфиденциальных данных, так как итоговый запрос, выполняющий основное действие, не отправляет их мошеннику.

## Принцип работы CSRF

Разобраться, как работает межсайтовая подделка запросов, поможет понятие сессионных cookies (куки).

Сессионные cookies - это небольшой набор данных, которые веб-сервер отправляет браузеру при посещении сайта. Они хранятся на компьютерах пользователей и используются для их идентификации. Именно благодаря cookies не нужно авторизовываться на сайте дважды, а в корзине интернет-магазина содержится все, что было добавлено, даже если страницу перезагрузили.

После сохранения браузер отправляет cookies на сервер с каждым запросом и идентифицирует пользователя. С их помощью злоумышленник может выдать себя за потенциальную жертву и заставить ее браузер выполнить запрос. Если пользователь уже авторизован на сайте, cookies отправятся автоматически вместе с запросом.

**Для выполнения CSRF необходимы несколько условий:**

- на уязвимом сайте есть действие, которое можно выполнить от имени жертвы, например изменить адрес @mail, осуществить перевод денежных средств, изменить пароль и так далее
- злоумышленник заранее знает все параметры запроса, которые ожидает увидеть уязвимый сайт. Даже незначительное отличие в тексте повлияет на работоспособность
- действие полагается только на файлы cookies для верификации пользователя и выполняется с помощью HTTP-запросов

CSRF-атаке могут быть подвержены все сайты и веб-приложения, которые добавляют данные для аутентификации пользователя к HTTP-запросу автоматически.

Либо злоумышленник может обманом заставить жертву загрузить или отправить информацию. Например, через фишинговую ссылку.

```html
<img src=“фишинговая ссылка” width=“0” height=“0” border=“0”>
```
- Она может быть скрыта в теге изображения
```html
<a href=“фишинговая ссылка”>Unsubscribe here</a>
```
- Или замаскирована под обычную ссылку