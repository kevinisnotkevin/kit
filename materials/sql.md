# SQL

SQL - это язык программирования, используемый в большинстве реляционных баз данных  для запросов, обработки и определения данных, а также контроля доступа. SQL был разработан в IBM в 1970-х годах. Со временем у стандарта SQL ANSI появились многочисленные расширения, разработанные такими компаниями как IBM, Oracle и Microsoft. Хотя в настоящее время SQL все еще широко используется, начали появляться новые языки программирования запросов.

Назначение SQL:
- создание БД и таблицы с полным описанием их структуры
- выполнение основных операций манипулирования данными (такие как вставка, модификация и удаление данных из таблиц)
- выполнение простых и сложных запросов

Одна из ключевых особенностей языка SQL заключается в том, что с его помощью формируются запросы, описывающие, какую информацию из БД необходимо получить, а пути решения этой задачи программа определяет сама.

## Принцип работы запросов

Чтобы разобраться, как именно работает магия запроса, давайте представим его путь от пользователя до нужных ему данных:

Пользователь → Клиент → Запрос → Система управления → База данных → Таблица с базами данных

- Клиент - способ введения запроса. В случае с Google, например, клиентом будет поисковая строка браузера, в которую пользователь вводит сформулированный запрос
- Система управления базами данных (СУБД) - комплекс программ, которые позволяют управлять данными. Эта система помогает таблицам понять, чего хочет пользователь, а пользователю - что ему отвечают таблицы
- База данных - система хранения таблиц, в которой они связаны между собой. База данных сама по себе не умеет манипулировать информацией - это просто хранилище, где у каждого объекта есть свое место

## **SQL-операторы**

Работать с данными помогают операторы - определенные слова или символы, которые используются для выполнения конкретной операции - например, для выбора из множества по конкретному параметру. Если нам нужно из всех видов пиццы отсортировать те, в которых есть пармезан, - нужно использовать оператор SELECT (выбор в соответствии с условием).

Операторы в SQL делятся на несколько групп в соответствии с задачами, которые они решают.

### DDL

DDL (Data Definition Language) - операторы определения данных. Они работают с объектами, то есть с целыми таблицами. Если базу нужно дополнить таблицей с новыми данными или, наоборот, убрать одну из таблиц с ошибочными данными - используется этот набор операторов.

- `CREATE` - создание объекта в базе данных
- `ALTER` - изменение объекта
- `DROP` - удаление объекта

### DML

DML (Data Manipulation Language) - операторы манипуляции данными. Эти операторы уже работают с содержимым таблиц - строками, атрибутами и значениями. С их помощью можно вносить изменения в конкретное значение. Например, заменить поле в колонке «Фамилия» в строке с данными сотрудницы компании посте того, как она вышла замуж. Или удалить строку с данными уволенного сотрудника.

- `SELECT` - выбор данных в соответствии с условием
- `INSERT` - добавление новых данных
- `UPDATE` - изменение существующих данных
- `DELETE` - удаление данных

### DCL

DCL (Data Control Language) - оператор определения доступа к данным. Он определяет, кто из пользователей может отправлять запросы к базе, менять объекты и значения. Например, можно отозвать доступ у сотрудника, перешедшего в другой отдел, а также открыть доступ к базе новому маркетологу или разработчику.

- `GRANT` - предоставление доступа к объекту
- `REVOKE` - отзыв ранее выданного разрешения
- `DENY` - запрет, который является приоритетным над разрешением

### TCL

TCL (Transaction Control Language) - язык управления транзакциями. Транзакции - это набор команд, которые выполняются поочередно. Если все команды выполнены, транзакция считается успешной, а если где-то произошла ошибка — транзакция откатывается назад, отменяя все выполненные команды. Наглядный пример такой транзакции - оплата онлайн, когда банк просит сначала ввести сумму и получателя, затем проверить и подтвердить операцию, а после ввести одноразовый код. На каждом из этих этапов оплату можно отменить и транзакция откатится назад.

- `BEGIN TRANSACTION` - обозначение начала транзакции
- `COMMIT TRANSACTION` - изменение команд внутри транзакции
- `ROLLBACK TRANSACTION` - откат транзакции
- `SAVE TRANSACTION` - указание промежуточной точки сохранения внутри транзакции

## Синтаксис SQL запроса

Одна из основных функций SQL - получение данных из СУБД. Для построения всевозможных запросов к базе данных используется оператор `SELECT`. Он позволяет выполнять сложные проверки и обработку данных.

```sql
SELECT [DISTINCT | ALL] поля_таблиц
FROM список_таблиц
[WHERE условия_на_ограничения_строк]
[GROUP BY условия_группировки]
[HAVING условия_на_ограничения_строк_после_группировки]
[ORDER BY порядок_сортировки [ASC | DESC]]
[LIMIT ограничение_количества_записей]
```

### Параметры оператора

- `DISTINCT` используется для исключения повторяющихся строк из результата ALL (по умолчанию) используется для получения всех данных, в том числе и повторений
- `FROM` перечисляет используемые в запросе таблицы из базы данных
- `WHERE` - это условный оператор, который используется для ограничения строк по какому-либо условию
- `GROUP BY` используется для группировки строк
- `HAVING` применяется после группировки строк для фильтрации по значениям агрегатных функций
- `ORDER BY` используется для сортировки. У него есть два параметра:
    - `ASC` (по умолчанию) используется для сортировки по возрастанию
    - `DESC` - по убыванию
- `LIMIT` используется для ограничения количества строк для вывода

### Порядок выполнения инструкций

Следующие действия демонстрируют логический порядок обработки инструкции `SELECT`. Этот порядок определяет, когда объекты, определенные в одном шаге, становятся доступными для предложений в последующих шагах.

Например, в предложении `WHERE` не доступны псевдонимы столбцов, определяемых в предложении `SELECT`, потому что, согласно списку, оно выполняется до `SELECT`.

- `FROM`
- `WHERE`
- `GROUP BY`
- `HAVING`
- `SELECT`
- `DISTINCT`
- `ORDER BY`

Фактическое выполнение инструкций определяется СУБД и порядок из этого списка может значительно отличаться.

### Примеры использования

Вы можете выводить любые строки и числа вместо столбцов:

```sql
SELECT "Hello world", 1;
```

Для того, чтобы вывести все данные из таблицы Company, вы можете использовать символ «`*`», который буквально означает «все столбцы»:

```sql
SELECT * FROM Company;
```

Вы можете вывести любой столбец, определённый в таблице, например, town_to из таблицы Trip:

```sql
SELECT town_to FROM Trip;
```

Также вы можете вывести несколько столбцов. Для этого их нужно перечислить через запятую:

```sql
SELECT member_name, state FROM FamilyMembers;
```

Иногда возникают ситуации, в которых нужно получить только уникальные записи. Для этого вы можете использовать `DISTINCT`. Например, выведем список городов без повторений, в которые летали самолеты:

```sql
SELECT DISTINCT town_to FROM Trip;
```