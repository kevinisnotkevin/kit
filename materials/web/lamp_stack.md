# LAMP-stack

## Что такое LAMP?

LAMP стек - четыре различные технологии, которые разработчики используют для создания веб сайтов и веб-приложений. LAMP - это аббревиатура от ОС Linux, веб-сервера Apache, сервера БД MySQL и ЯП PHP. Все четыре из этих технологий имеют открытый исходный код, что означает, что они поддерживаются сообществом и свободно доступны для использования всеми.

## Принцип работы

Веб-приложения используют стек LAMP для ответа на запросы веб-браузеров. Веб-сервер Apache и БД MySQL работают под управлением ОС Linux и взаимодействуют с помощью PHP.

- Веб-сервер Apache получает входящий запрос от браузера. Если запрос заключается в загрузке статического файла, сервер Apache отвечает непосредственно соответствующим содержимым. Если запрос относится к динамическому контенту, сервер Apache передает запрос компоненту PHP. Компонент PHP находит и загружает соответствующий PHP-файл, который может обработать запрос
- Файл PHP содержит функции PHP, которые представляют собой коды для генерации динамического контента. Компонент PHP обрабатывает функции PHP, такие как преобразование единиц измерения или создание диаграммы продаж. Для некоторых функций PHP может потребоваться информация из базы данных. В таких случаях PHP-код извлекает сохраненную информацию из базы данных и использует ее для обработки функции
- Файл PHP передает вычисленные результаты веб-серверу в формате HTML. В то же время он хранит новые данные в базе данных MySQL. HTTP-сервер Apache отправляет динамические результаты HTML в браузер пользователя

## Базовая настройка LAMP-stack

```bash
apt update && apt upgrade -y
apt install apache2 php
service apache2 start
service apache2 status
cd /var/www/html

```
- Обновляем пакеты
- Устанавливаем apache2, php
- Запускаем apache
- Смотрим статус службы
- По умолчанию файлы apache, которые предназначены для клиентов web-сервера лежат в /var/www/html. Но этот путь при необходимости можно изменить, настроив конфигурационный файл /etc/apache2/sites-enabled/000-default.conf (`DocumentRoot /var/log/html`)

```bash
<Directory /var/www/html/>
	Order allow,deny
	Allow from 127.0.0.1
</Directory>
```
- Так как LAMP настраиваем для тестов, то ограничим доступ к нему только по localhost. Изменяем конфиг /etc/apache2/apache2.conf. Добавляем строки в начало файла

Каталог /html/ и все файлы в нем принадлежат группе и пользователю root. Это достаточно безопасно и работает, так как пользователь www-data, от которого работает web-сервер, может читать и выдавать страницы клиентам, но есть в этом минус - данный пользователь не может создавать и записывать новые файлы, что плохо. Поэтому мы сменим группу и владельца данной директории и файлов внутри. В таком случает, web-сервер сможет загружать к себе файлы пользователей, так как у него будет достаточно для этого прав.

```bash
sudo chown -R www-data:www-data html/
```
- Изменение прав

Это повлияет на безопасность, так как если взломают web-сервер, то у злоумышленника будет столько же прав сколько и у www-data.

```bash
echo "<?php phpinfo(); ?>" > info.php
sudo chown -R www-data:www-data info.php
```
- Проверим работу web-сервера, создадим от root-пользователя файл, который будет выводить информацию по php и перейдем по пути к этому файлу

```bash
apt install mariadb-server
service mysql start
service mysql status
sudo mariadb-secure-installation
```
- Установка, запуск и проверка статуса MariaDB. Запускаем скрипт для повышения безопасности БД. Начиная с MariaDB 10.5 клиент называется mariadb-secure-installation. Будет предложен ряд вопросов, на все вопросы отвечаем “Да”, за исключением вопроса “Switch to unix_socket authentication”:

```php
<?php
$link = mysqli_connect('127.0.0.1', 'root', 'pass');
if (!$link) {
	die('Error:' . mysqli_error());
}
echo 'OK!';
mysqli_close($link);
?>
```
- Чтобы убедиться в работоспособности MariaDB, изменим содержимое файла info.php. Если все успешно, то в браузере отобразится сообщение “OK!”
