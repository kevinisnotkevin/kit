
# Геометрия дисков и разделов

### **Жесткий диск**

Любое устройство с движущимися частями вносит сложность в систему, поскольку существуют физические элементы, которые не поддаются абстрагированию. Жесткий диск — не исключение: даже если представлять его как блочное устройство с произвольным доступом к любому блоку, если система не будет внимательна к тому, как она размещает данные на диске, это может иметь серьезные последствия для производительности.

**Рассмотрим физические свойства простого диска с одной пластиной на рисунке.**

Диск состоит из вращающейся пластины на шпинделе с головкой, прикрепленной к движущемуся коромыслу, которое может перемещаться по радиусу диска. Когда диск вращается под головкой, последняя считывает данные. Когда коромысло находится в одном положении, головка может считывать данные только с фиксированного круга, называемого цилиндром. Большие диски имеют более одного «блина» (жесткого магнитного диска), которые вращаются вокруг одного и того же шпинделя. Каждый «блин» может иметь одну или две головки в верхней и/или нижней части, все головки прикреплены к одному шпинделю (коромыслу) и движутся согласованно. Шпиндель смещается, а на диске находится множество цилиндров, от маленьких в его центре до больших на периферии. Наконец, вы можете разделить цилиндр на доли, называемые секторами. Такой подход к геометрии диска кратко называется **CHS** (**cylinder-head-sector** — _цилиндр, головка, сектор_), в старых системах вы могли бы найти любую часть диска, используя эти три параметра.

![https://i.imgur.com/KiJdoN0.png](https://i.imgur.com/KiJdoN0.png)

**Вид на жесткий диск сверху**

Ядро и различные программы разбиения на разделы могут показать, какое количество цилиндров имеет диск. Однако на любом из современных жестких дисков эти значения не правдивы! Традиционная схема передачи, применяемая системой CHS, не масштабируется на современном дисковом оборудовании и не учитывает тот факт, что появилась возможность поместить во внешние цилиндры больше данных, чем во внутренние.
    
Аппаратное обеспечение диска поддерживает логическую блочную адресацию (**Logical Block Addressing, LBA**) для передачи местоположения на диске по номеру блока (это гораздо более простой интерфейс), но остатки CHS еще видны. Например, таблица разделов MBR содержит информацию о CHS, а также эквиваленты LBA, и некоторые загрузчики все еще доверяют значениям CHS (не волнуйтесь, большинство загрузчиков Linux используют значения LBA).

### **Твердотельные диски**

Устройства хранения данных без движущихся частей, такие как твердотельные накопители (**SSD**), радикально отличаются от вращающихся дисков с точки зрения характеристик доступа. Для них произвольный доступ к разделам — не проблема, потому что нет головки, которая двигалась бы по «блину», но некоторые характеристики все же меняют работу **SSD**.

Один из наиболее существенных факторов, влияющих на производительность **SSD**, — это выравнивание разделов. Считывая данные с **SSD**, вы читаете их частями (они называются страницами, не путайте со страницами виртуальной памяти), например, 4096 байт или 8192 байта за раз, и чтение должно начинаться с части, кратной этому значению. Это означает, что если ваш раздел и его данные не лежат на границе, вам придется выполнять два считывания вместо одного для небольших распространенных операций, например чтения содержимого каталога.

_Новые версии утилит разбиения включают логику, позволяющую помещать вновь созданные разделы под соответствующие порядковые номера от начала дисков, поэтому вам не нужно беспокоиться о выравнивании разделов. Инструменты разбиения в настоящее время не производят никаких вычислений — они просто выравнивают разделы по границам 1 Мбайт, или, точнее, 2 048 512-байтовых блоков. Это довольно консервативно, потому что граница совпадает с размерами страниц 4096, 8192 и т. д. вплоть до 1 048 576._

**Разделы** являются более мелкими частями всего диска. В Linux они обозначаются цифрой после блочного устройства, поэтому у них есть такие имена, как `/dev/sda1` и `/dev/sdb3`. Ядро представляет каждый раздел как блочное устройство, как представляло бы весь диск. Разделы определяются на небольшой области диска, называемой таблицей разделов (также метка диска).

Ядро позволяет одновременно получать доступ как ко всему диску, так и к одному из его разделов, но обычно в этом нет необходимости, если вы не копируете диск целиком.

Менеджер логических томов Linux (**Logical Volume Manager, LVM**) позволяет более гибко управлять традиционными дисковыми устройствами и разделами и в настоящее время применяется во многих системах.

![Типичная схема диска Linux](https://i.imgur.com/6DIPTDw.png)

**Типичная схема диска Linux**

_Несколько разделов данных когда-то были распространены в системах с большими дисками, поскольку старые компьютеры могли загружаться только с определенных частей диска. Кроме того, администраторы задействовали части для резервирования определенного объема пространства для областей операционной системы. Например, они не хотели, чтобы пользователи могли заполнять всю систему и препятствовать работе критически важных служб. Эта практика не уникальна для систем Unix — вы найдете множество новых систем Windows с несколькими разделами на одном диске. Кроме того, большинство систем имеют отдельный раздел подкачки._

Следующий уровень разбиения на разделы — это файловая система, база данных файлов и каталогов, с которыми вы привыкли взаимодействовать в пользовательском пространстве.

Как видно на рисунке выше, если вы хотите получить доступ к данным в файле, вам необходимо использовать соответствующее расположение раздела из таблицы разделов, а затем выполнить поиск в базе данных файловой системы в этом разделе.Для доступа к данным на диске ядро Linux и применяет систему слоев, показанную на рисунке ниже.

Обратите внимание: вы можете работать с диском как через файловую систему, так и непосредственно через дисковые устройства.

![Схема ядра с доступом к диску](https://i.imgur.com/F6QCE7Q.png)

**Схема ядра с доступом к диску**
