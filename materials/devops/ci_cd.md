# CI/CD

## 1 Что такое CI/CD

CI/CD - это комбинация непрерывной интеграции (continuous integration) и непрерывного развертывания (continuous delivery или continuous deployment) программного обеспечения в процессе разработки.

> Непрерывная интеграция (continuous integration) - это процесс, при котором продукт регулярно собирается из исходного кода и подвергается исполнению значительной части автоматических тестов, таких как модульные тесты. В случае, если автоматические тесты занимают много времени, их можно запускать реже, например, раз в сутки. Основной подход для организации непрерывной интеграции заключается в использовании инструментов, таких как TeamCity или Jenkins, которые загружают исходный код из системы контроля версий, осуществляют его сборку и запускают тесты.

> Непрерывная доставка (continuous delivery) представляет собой подход, при котором продукт всегда находится в готовом состоянии и может быть передан в промышленную эксплуатацию, включая последние изменения, внесенные разработчиками в код. Вероятно, непрерывная доставка будет реализована с использованием той же технологии, что и непрерывная интеграция.

> Непрерывное развертывание (continuous deployment) - это процесс, при котором обновления продукта регулярно вводятся в промышленную эксплуатацию, например, после каждого изменения, внесенного разработчиками. При этом все процессы предметной области продолжают работать без сбоев. В некотором смысле непрерывное развертывание представляет собой хорошо автоматизированную и часто выполняющуюся непрерывную доставку.

CI/CD является неотъемлемой частью devops и всех современных методик разработки. С помощью специальной платформы CI/CD мы можем оптимизировать процесс разработки в любой компании, используя средства автоматизации, тестирования и совместной работы. Эта практика позволяет разработчикам, командам по безопасности и эксплуатации работать максимально эффективно и результативно. CI/CD устраняет необходимость в ручной работе по разработке и устаревших процессах согласования и утверждения, освобождая команды devops для более инновационного подхода к разработке.

![](/materials/images/devops/devops_whatis_ci_cd.png)

Инструменты CI/CD: CircleCI, Github Actions, Gitlab CI, Drone, Travis CI, Jenkins, TeamCity, Azure DevOps.

## 2 Этапы CI/CD

**Написание кода.** Каждый разработчик создает код отведенного ему модуля и тестирует его в ручном режиме. Затем разработанный и проверенный программный блок интегрируется в основной ветке с текущей версией продукта. Как только все модули будут опубликованы в главной ветке, команда переходит к следующему этапу.

**Сборка.** Заранее подобранная система контроля версий запускает автоматизированную сборку и тестирование всего продукта. Триггеры могут быть настроены автоматически или вручную. Автоматическая сборка выполняется с помощью Jenkins или другого сервера непрерывной интеграции.

**Ручное тестирование.** Как только CI-сервер закончит автоматизированную сборку продукта, он передается тестировщикам на проверку. Они используют различные методики тестирования для выявления и устранения ошибок и уязвимостей программы.

**Релиз.** После исправления ошибок вычищенный и отлаженный код переходит на этап релиза для клиентов. Его проверяет заказчик, возможно, с привлечением своих специалистов или ограниченной группы пользователей. По результатам проверки код отправляется на доработку или согласуется.

**Развертывание.** Текущая версия программы размещается на продакшн-серверах разработчика. Заказчик может работать с программой, исследовать ее функции, искать уязвимости.

**Поддержка и отслеживание.** После развертывания приложение становится доступным конечным пользователям. Параллельно этому разработчики выполняют его поддержку и одновременно мониторят реакцию пользователей, анализируют их опыт взаимодействия с программой.

**Планирование.** На основании данных, полученных при изучении пользовательского опыта, разработчик подготавливает план доработок, включающий новые функции, исправление ошибок и т.д. После этого он вносит все корректировки в продукт — и цикл разработки начинается снова.

- __CI (Continuous Integration, Непрерывная интеграция)__ — интеграция отдельных кусочков кода приложения между собой. CI обычно выполняет две задачи, описанные далее;
    - BUILD:
        - Сборка кода;
        - Подготовка артефактов для следующих стадий;
    - TEST:
        - Тесты кодстайла;
        - Модульные тесты;
        - Интеграционные тесты;
        - Прочие тесты;
        - Отчеты о тестах.
- __CD (Continuous Delivery, Непрерывная доставка)__ — это расширение непрерывной интеграции, поскольку оно автоматически развертывает все изменения кода в тестовой и/или производственной среде после этапа сборки. CD может выполнять задачи, описанные далее;
    - PUBLISH (В случае применения докера для развёртывания):
        - Сбор образов контейнеров;
        - Пуш образов;
    - UPDATE CONFIGS:
        - Обновление конфигураций на машинах;
    - DEPLOY STAGING:
        - Развертывание тестовой среды для ручных тестов, QA, и прочих не автоматизируемых проверок;
        - Может запускаться как вручную, так и автоматически при успешном прохождении стадий CI;
    - DEPLOY PRODUCTION:
        - Разворачиваем новую версию системы на прод;
        - Этот этап желательно запускать вручную, а не автоматически;
        - По желанию можно настроить только для определенной ветки репозитория (master, release и т.п.).

## 3 Pipeline

CI/CD pipeline - это последовательность действий (скриптов) для определенной версии кода в репозитории, которая запускается автоматически при совершении изменений (Постоянная автоматизация и непрерывный мониторинг на протяжении всего жизненного цикла приложений, от этапов интеграции и тестирования до доставки и развертывания).

В общем случае, пайплайн можно представить в виде 7 основных шагов.

### 3.1 Триггер

Пайплайн должен автоматически запускаться каждый раз, когда в репозиторий отправляется новый код. Существует несколько способов достичь этого. Например, инструмент CI/CD, такой как Jenkins, может опрашивать репозиторий Git, или же определенный хук, например Git webhooks, может отправлять уведомления о push разработчика инструменту CI/CD. Хотя возможен и запуск пайплайна вручную, такое решение не является наилучшим и автоматический запуск дает больше уверенности.

### 3.2 Проверка кода

Инструмент CI/CD извлекает код из репозитория вместе с информацией о том, какой коммит вызвал запуск пайплайна, и какие шаги необходимо выполнить. На данном этапе могут быть запущены инструменты статического анализа кода, которые могут прервать выполнение пайплайна в случае обнаружения ошибки. Если все в порядке, то процесс CI/CD продолжается далее.

### 3.3 Компиляция кода

Естественно, инструмент CI/CD должен иметь доступ к необходимым инструментам сборки для компиляции кода. Например, для приложений на Java могут использоваться Maven или Gradle. К тому же, для обеспечения максимальной чистоты процесса сборки, можно использовать Docker для создания изолированной среды.

### 3.4 Unit-тестирование

Одна из важнейших составляющих пайплайна - модульное тестирование или unit testing. Для этого используются специальные библиотеки для конкретного языка программирования. Скомпилированное приложение запускается с тестами, и если выполнение проходит без ошибок, переходим к следующему шагу. Важно достичь максимального покрытия всех функций и компонентов приложения тестами, а также поддерживать и улучшать их по мере роста кодовой базы.

### 3.5 Упаковка кода

Если все тесты пройдены успешно, приложение необходимо упаковать для доставки пользователю. Для Java-приложений может быть создан JAR-файл, а для приложений, работающих в Docker-контейнере, - Docker-образ.

### 3.6 Приемочное тестирование (Здесь начинается CD)

Этот способ позволяет убедиться, что ПО соответствует всем требованиям клиента и заявлениям самого разработчика.

Требования и ожидаемые результаты формулируются в понятном для компьютерной системы формате и могут быть автоматизировано протестированы, так же как модульные тесты. Например, можно протестировать функциональные части приложения, например, проверить, сможет ли пользователь добавить товар в корзину на сайте интернет-магазина, используя Selenium для имитации действий пользователя в браузере. Приемочное тестирование сокращает время, затрачиваемое на ручное тестирование. Зачем кликать мышью на кнопку вручную, если это может сделать специальная программа по триггеру?

### 3.7 Доставка и развертывание

На этом этапе уже существует готовый к развертыванию программный продукт, который нужно доставить в рабочую среду клиента и установить корректно. Для непрерывного развертывания необходима производственная среда. Это может быть публичное облако с собственным API или инструмент Spinnaker, который работает с оркестрацией контейнеров Kubernetes и популярными облачными платформами, такими как Google Cloud Platform, AWS, Microsoft Azure и Oracle Cloud.

Таким образом, это последний этап пайплайна. В следующий раз, когда код отправляется в репозиторий разработчиком, процесс будет запущен заново.

## 4 Безопасность в CI/CD

### 4.1 Введение

**DevSecOps** - это практика, которая включает в себя тестирование безопасности на каждом этапе разработки ПО. Она зависит от эффективного сотрудничества между разработчиками ПО, специалистами по безопасности и операционными группами, чтобы создать безопасное и защищенное ПО. Одним из ключевых аспектов DevSecOps является культурная трансформация, при которой каждый, кто участвует в процессе создания ПО, принимает ответственность за его безопасность.

DevSecOps объединяет концепции разработки, безопасности и операций в рамках единой практики. Каждый термин определяет свою роль и обязанности в командах разработчиков, работающих над программными приложениями.

Основная цель DevSecOps - помочь разработчикам эффективно решать проблемы безопасности. Эта методика предлагает альтернативу устаревшим подходам к обеспечению безопасности программного обеспечения, которые часто приводили к срывам сроков и отставанию от постоянно меняющихся требований.

Успешная реализация DevSecOps включает в себя следующие компоненты:

- Анализ кода: процесс, в ходе которого осуществляется исследование исходного кода приложения для выявления уязвимостей и обеспечения его соответствия передовым практикам безопасности.
- Управление изменениями: команды разработчиков ПО используют инструменты управления изменениями для отслеживания изменений, связанных с программным обеспечением и требованиями, управления ими и создания соответствующей отчетности. Это позволяет предотвратить возникновение непреднамеренных уязвимостей безопасности, вызванных изменениями в ПО.
- Управление соответствием: команды разработчиков ПО обеспечивают соответствие ПО нормативным требованиям. К примеру, можно использовать сервис AWS CloudHSM для демонстрации соответствия требованиям безопасности, конфиденциальности и защиты от несанкционированного доступа, таким как HIPAA, FedRAMP и PCI.
- Моделирование угроз: команды DevSecOps исследуют проблемы безопасности, которые могут возникнуть до и после развертывания приложения. Они устраняют известные проблемы и выпускают обновленные версии приложений.
- Обучение по безопасности: обучение по безопасности означает обучение разработчиков ПО и операционных групп актуальным рекомендациям в области безопасности. Такие практики позволяют командам разработки и эксплуатации независимо принимать решения по безопасности при создании и развертывании приложения.

#### 4.1.1 Shift-left

Основная цель методологии DevSecOps заключается в интеграции автоматизированных проверок безопасности в процесс разработки, то есть в devops-пайплайн. Ранее специалисты по информационной безопасности проводили проверки уже после завершения процесса разработки, однако такой подход оказался неэффективным. Обнаружение ошибок в процессе тестирования безопасности заставляло начинать весь цикл разработки заново, что требовало много времени и денег.

Для достижения максимальной эффективности проверки безопасности должны выполняться как можно раньше. Визуально это можно представить переносом проверок в левую сторону пайплайна. Эта концепция называется shift-left и широко обсуждается специалистами по безопасности.

### 4.1.2 Структура DevSecOps-пайплайна

![](/materials/images/devops/devsecops_pipeline.png)
- Основные этапы проверки безопасности.
- **Pre-commit** - проверка безопасности исходного кода до его коммита разработчиком в систему контроля версий. Эта проверка позволяет обнаружить незашифрованную конфиденциальную информацию, такую как пароли или API-ключи.
- **Pre-build** - проверка безопасности исходного кода после его попадания в систему контроля версий. В ходе этой проверки выполняется статический анализ исходного кода и его зависимостей для обнаружения распространенных уязвимостей, таких как те, которые перечислены в owasp top ten.
- **Post-build** - проверка безопасности артефакта, собранного из исходного кода, такого как Docker-файл, RPM-пакет или JAR-архив. Инструменты анализируют окружение и зависимости приложения, ищут устаревшие версии пакетов и библиотек, имеющих исправления в более новых версиях.
- **Test-time** - проверка безопасности приложения, запущенного из собранного артефакта. В этой фазе инструменты пытаются "сломать" приложение, имитируя действия злоумышленников.
- **Post-deploy** - проверка безопасности приложения после его развертывания в production-среде. В реальном времени инструменты мониторят открытые реестры известных уязвимостей и отправляют уведомления при обнаружении угроз для приложения.

### 4.1.2 SAST

**SAST (Static application security testing, Статический анализ кода)** - процесс анализа исходного кода без его выполнения. Он позволяет обнаружить потенциальные проблемы, такие как синтаксические ошибки, неправильное использование переменных и функций, утечки памяти и т.д.

SAST позволяет разработчикам обнаруживать уязвимости безопасности приложения на ранних этапах процесса разработки ПО.

Тестирование "белого ящика" - это метод тестирования ПО, который включает в себя проверку внутренней структуры и дизайна ПО, в отличие от проверки внешних результатов или опыта конечного пользователя, что характерно для тестирования "черного ящика".

SAST также обеспечивает соответствие руководствам и стандартам кодирования без фактического выполнения базового кода.

Статические анализаторы кода можно поделить на два вида.

- Линтеры - инструменты статического анализа кода, которые проверяют код на соответствие определенным стилистическим правилам и стандартам. Их цель - обнаружить распространенные ошибки и антипаттерны.
- Статические анализаторы уязвимостей - это более сложные инструменты, которые анализируют код программы в поисках уязвимостей и вредоносных конструкций. Они строят граф вызовов функций и могут анализировать как используемый, так и неиспользуемый код.

**SAST ИНСТРУМЕНТЫ**

- **SonarQube** - платформа с открытым исходным кодом для непрерывного анализа и измерения качества программного кода.
- [PT Application Inspector](https://www.ptsecurity.com/ww-en/products/ai/).
- [PVS‑Studio](https://pvs-studio.com/en/pvs-studio/sast/).

### 4.1.3 DAST

**DAST (Dynamic application security testing, Динамический анализ кода)** - это процесс тестирования программного кода во время его выполнения. Такой анализ позволяет обнаруживать ошибки, которые проявляются только при работе программы, такие как некорректное поведение в определенных условиях и проблемы с производительностью.

DAST предоставляет возможность обнаруживать проблемы, недоступные для других типов тестирования. Например, проблемы с архитектурой информационных систем или с аутентификацией, а также ошибки, возникающие при взаимодействии пользователя с приложением. Тестирование с использованием DAST позволяет выявить недостатки, которые могут быть пропущены обычными тестами. Более того, DAST помогает обеспечить соответствие продукта нормативным документам.

Тестирование чёрного ящика или поведенческое тестирование - это стратегия тестирования, при которой рассматривается функциональное поведение объекта (программы, системы) с точки зрения внешнего мира. Важно отметить, что тестировщики, занимающиеся тестированием чёрного ящика, не имеют доступа к исходному коду приложения.

Некоторые динамические анализаторы:

- **Netsparker** - это отличное решение DAST, которое позволяет IT-персоналу отслеживать потенциальные векторы атак. Этот инструмент особенно полезен для организаций, которые должны демонстрировать соответствие стандартам HIPAA или PCI DSS. Netsparker можно установить на ОС Windows или Windows Server, а также использовать в качестве облачного сервиса.
- **GitLab Pro** - это последняя версия платформы GitLab, предназначенная для поддержки CI/CD в DevOps. В ней также доступен механизм DAST, предоставляемый в виде облачного сервиса с подпиской. Система DAST GitLab поддерживает сканирование API и может быть развернута по запросу или по расписанию. Кроме того, в состав системы входит сервис статического анализа кода (SAST). Для GitLab Pro доступна бесплатная тридцатидневная пробная версия.

**МИНУСЫ DAST**

Методы динамического тестирования безопасности приложений могут помочь в обнаружении уязвимостей, однако есть некоторые недостатки, которые следует учитывать.

Во-первых, разработка полного набора тестов для каждого приложения является сложной задачей. Методы DAST могут порождать ложноположительные результаты, что затрудняет работу аналитиков.

Во-вторых, инструменты DAST могут указывать на проблемы, но не обнаруживать недостатки внутри кода приложения. Более того, эти инструменты сосредоточены на запросах и ответах, что может привести к появлению ошибок в архитектурной концепции проекта.

В-третьих, процесс DAST может занимать много времени (обычно требуются дни или недели для проведения тестирования). Обнаруженные проблемы на поздних этапах жизненного цикла приложения могут вызвать большое количество задач для команды разработчиков, приводя к продлению сроков и увеличению затрат. В определенных случаях разработчикам может потребоваться возвращаться и изучать старый код перед внесением необходимых исправлений.

**DAST ИНСТРУМЕНТЫ**

- [GitLab DAST](https://docs.gitlab.com/ee/user/application_security/dast/) (доступно только в Ultimate‑версии)
- [OWASP Zed Attack Proxy (ZAP)](https://www.zaproxy.org/) (решение open‑source, которое используется в том числе и в GitLab DAST)
- Acunetix
- Fortify WebInspect
- [PT Application Inspector](https://www.ptsecurity.com/ww-en/products/ai/)

### 4.1.4 IAST

**IAST (Interactive Application Security Testing, Интерактивное Тестирование Безопасности Приложений)** - это метод тестирования безопасности, который использует современные подходы и является лучшим выбором для проверки соответствия безопасности веб- и мобильных приложений. В отличие от устаревших технологий, таких как SAST и DAST, IAST предлагает устранить их недостатки и предоставить более полный и эффективный анализ.

Один из недостатков статического анализа (SAST) заключается в том, что он ограничен только просмотром исходного кода приложений, и не может обеспечить достаточное понимание библиотек и фреймворков, которые часто используются в современных приложениях. Также, сторонние компоненты могут привести к ложным срабатываниям статических анализаторов.

В отличие от этих подходов, IAST объединяет лучшие элементы SAST и DAST и позволяет проводить анализ в реальном времени:

- в любом месте процесса разработки IDE
- непрерывной интегрированной среде
- производственной среде

Поскольку IAST работает внутри приложения, он анализирует не только код приложения.

Он может анализировать:

- код приложения
- потоки данных
- конфигурации
- HTTP-запросы и ответы
- библиотеки, фреймворки и другие компоненты
- информацию о внутреннем подключении

**IAST ИНСТРУМЕНТЫ**

- [Synopsys Seeker](https://www.synopsys.com/software-integrity/security-testing/interactive-application-security-testing.html)
- [Veracode Interactive Analysis](https://www.veracode.com/products/interactive-analysis-iast)
- [Checkmarx CxIAST](https://www.checkmarx.com/products/interactive-application-security-testing)
- [PT Application Inspector](https://www.ptsecurity.com/ww-en/products/ai/)

### 4.1.5 RASP

**RASP (Runtime Application Self-Protection)** - это технология, которая в реальном времени обнаруживает и блокирует атаки на приложение. Она добавляет защитные функции в окружение выполнения, позволяя приложению самозащиту в автоматическом режиме.

Основное преимущество технологии RASP по сравнению с другими средствами защиты веб-приложений заключается в том, что она понимает работу приложения и распознает атаки и нелегитимный трафик. При этом RASP способен обнаружить не только типичные атаки с использованием сигнатурного сравнения, но и попытки эксплуатации уязвимостей zero-day, реагируя на аномалии.

**RASP ИНСТРУМЕНТЫ**

- Fortify
- [Sqreen](https://www.sqreen.com/)
- [OpenRASP](https://github.com/baidu/openrasp) (решение open‑source, разработанное Baidu)
- [Signal Sciences](https://www.signalsciences.com/products/rasp-runtime-application-self-protection/)

### 4.1.6 SCA

**SCA (Software Composition Analysis, Анализ состава программного обеспечения)** - это процесс, который автоматизирует отслеживание использования программного обеспечения с открытым исходным кодом (OSS) с целью управления рисками, обеспечения безопасности и соответствия лицензиям.

SCA позволяет обнаружить проблемы, когда уязвимость в одном компоненте может привести к проблемам с безопасностью во всех приложениях, которые используют этот компонент.

Хорошим примером является уязвимость под названием Log4Shell, которая была обнаружена в конце 2021 года в популярном java-фреймворке для логирования под названием Log4j. Эта уязвимость стала одной из самых серьезных, так как позволяла злоумышленникам выполнить произвольный java-код на миллионах устройств.

- [Trivy](https://trivy.dev/): Опенсорсное решение
- [GitLab Dependency Scanning](https://docs.gitlab.com/ee/user/application_security/dependency_scanning/): Инструмент в составе GitLab (доступен только в Ultimate‑версии)
- [Profiscope](https://profiscope.io/): Российское решение
- [CodeScoring](https://codescoring.ru/): Российское решение

### 4.1.7 OAST

**OAST (Out-of-Band Application Security Testing)** - это инструмент, разработанный компанией PortSwigger. Он может обнаруживать те уязвимости, которые не может найти динамический анализатор.

OAST сочетает в себе механизм доставки обычного DAST с детективными возможностями IAST. Он работает динамически, отправляя полезные данные работающему приложению. Эти полезные данные проходят обработку приложения обычным способом. Если полезная нагрузка обрабатывается небезопасным образом, она фактически использует некоторые инструменты для изменения поведения приложения, заставляя его осуществлять сетевое взаимодействие (обычно DNS) с внешней системой. Содержимое этого взаимодействия позволяет инструменту OAST сообщить точный тип уязвимости и точку ввода, которая может быть использована для ее запуска.

### 4.1.8 Fuzzing

**Фаззинг (fuzzing или fuzz testing)** - это метод тестирования, который призван специально вызывать сбои и обойти защиту проверяемого приложения. Для достижения этой цели применяются неправильные или случайные данные. Несмотря на свою простоту, этот метод демонстрирует высокую эффективность, поэтому широко применяется в рамках комплексного подхода к обеспечению безопасности.

**Фаззер** – инструмент, предназначенный для автоматизации фаззинга.

Фаззинг-тестирование способно выявить такие проблемы, как:

- Скрытые проблемы безопасности.
- Недостатки, не обнаруженные при других формах тестирования.
- Нарушения целостности потока управления.
- Неожиданное поведение программного обеспечения.
- Обработка исключительных ситуаций.

Фаззинг-тестирование позволяет достичь наивысшего покрытия кода при его исследовании и обнаружить проблемы с планированием и производительностью.

Среди преимуществ фаззинг-тестирования можно выделить следующие:

- Выявление проблем в сложных программах.
- Обнаружение ошибок, которые не были раскрыты другими методами анализа.
- Проверка уровня безопасности.
- Минимизация человеческого участия в процессе тестирования.
- Снижение затрат команды разработчиков, так как такое тестирование обходится значительно дешевле, чем ручная проверка.

Однако фаззинг-тестирование также имеет свои слабые стороны, связанные преимущественно с финансовыми вопросами. При внедрении анализаторов кода необходимо учесть затраты. Еще одна статья расходов - привлечение опытных экспертов для оценки результатов тестирования и устранения обнаруженных проблем, если в компании нет таких специалистов.

Временные затраты также являются недостатком фаззинг-тестирования ПО. При проведении быстрого поверхностного анализа в некоторых случаях могут быть пропущены уязвимости, поэтому специалисты рекомендуют проводить детальное фаззинг-тестирование, хоть это и занимает больше времени, но в разы повышает эффективность.

### 4.1.9 Сканер докер образов

Условно уязвимости в docker-образах можно разделить на следующие:

- OS Vulnerabilities - уязвимости базового образа и системных пакетов, включённых в этот образ;
- Dependencies - уязвимости в сторонних зависимостях;
- Software Vulnerabilities - уязвимости непосредственно в коде приложений, которые запускаются в контейнерах;
- Dockerfile - небезопасные инструкции для сборки образа.

Сканеры помогают выявить уязвимости и предоставляют рекомендации по их устранению, что может сэкономить тонны времени и сил. В качестве хранилища образов можно использовать Harbor, который с помощью адаптеров умеет работать с некоторыми сканерами. Это значительно упрощает процесс создания пайплайнов. Кроме того, Harbor может выгрузить отчет о найденных уязвимостях в универсальном csv-формате.

Один из популярных бесплатных сканеров - clair от coreos, предназначен для статического анализа уязвимостей в приложениях и docker-образах. С помощью интеграции с реестром docker, clair может автоматически сканировать все новые образы на наличие уязвимостей.

Еще один популярный инструмент - trivy от aqua security, также бесплатен и может обнаруживать уязвимости в операционной системе и уязвимые библиотеки, используемые вашим приложением. trivy легко интегрируется в процесс ci/cd и может использоваться для регулярной проверки безопасности. Коммерческие продукты, такие как Docker Security Scanning, теперь называемый частью Docker Enterprise, предлагают более широкие возможности и интеграцию с Docker Hub, что позволяет сканировать образы перед тем, как они будут опубликованы в реестре.

## 5 CICD-SEC

Сообщество OWASP представило топ 10 уязвимостей CI/CD конвейера. [OWASP Top 10 CI/CD Security Risks | OWASP Foundation](https://owasp.org/www-project-top-10-ci-cd-security-risks/)

Этот топ позволяет специалистам определить приоритетные направления обеспечения безопасности CI/CD.

- CICD-SEC-1: Недостаточные механизмы управления потоком
- CICD-SEC-2: Неадекватное управление идентификацией и доступом
- CICD-SEC-3: Злоупотребление цепочкой зависимостей
- CICD-SEC-4: Выполнение «отравленного» pipeline
- CICD-SEC-5: Недостаточный контроль доступа конвейера
- CICD-SEC-6: Недостаточная "гигиена" секретов
- CICD-SEC-7: Небезопасная конфигурация
- CICD-SEC-8: Неконтролируемое использование сторонних сервисов
- CICD-SEC-9: Некорректная валидация артефактов
- CICD-SEC-10: Недостаточное логирование и мониторинг

Половина из этого списка так или иначе пересекается с OWASP TOP 10:2021.

### 5.1 CICD-SEC-1: Недостаточные механизмы управления потоком

Недостаточные механизмы управления потоком относятся к способности злоумышленника, получившего разрешения на доступ к системе в рамках процесса CI/CD (SCM, CI, хранилище артефактов и т. д.), самостоятельно проталкивать вредоносный код или артефакты по конвейеру из-за отсутствие механизмов, обеспечивающих дополнительное одобрение или проверку.

Вы попадаете в зону риска если:

- используете автоматическое развертывание в production
- выполняете дебаг в production
- используете ручной триггер на развертывание в production
- у вас бесконтрольное слияние веток
- бесконтрольный push в production
- плохо настроен доступ к рабочей среде или инфраструктуре.

### 1.10.2 CICD-SEC-2: Неадекватное управление идентификацией и доступом

Неадекватное управления идентификацией и доступом возникают из-за трудностей в управлении огромным количеством идентификационных данных, разбросанных по различным системам инженерной экосистемы, от контроля версий до развертывания. Существование плохо управляемых учетных записей (как человеческих, так и программных) увеличивает потенциал и степень ущерба от их компрометации.

Зона риска:

- общие аккаунты на несколько сотрудников
- оutsourcing разработки внешними сотрудниками
- выдача избыточных привилегий
- «забытые» доступы. Человек уже не работает, а его учетка существует.

### 1.10.3 CICD-SEC-3: Злоупотребление цепочкой зависимостей

Риски злоупотребления цепочкой зависимостей относятся к способности злоумышленника злоупотреблять недостатками, связанными с тем, как рабочие станции разработки и среды сборки извлекают зависимости кода. Злоупотребление цепочкой зависимостей приводит к тому, что вредоносный пакет случайно извлекается и выполняется локально при извлечении.

Вектора атак:

- **Dependency confusion** — публикация заражённых пакетов в общедоступных репозиториях с названием как у одного из внутренних пакетов. Реализуют это в надежде на то, что менеджер пакетов по ошибке получит вредоносный пакет вместо легитимного.
- **Dependency hijacking** — угон учетной записи владельца популярного общедоступного пакета и загрузка вредоносного от его имени.
- **Typosquatting** — публикация вредоносных пакетов с именами, похожими на имена популярных пакетов, в надежде на опечатку.
- **Brandjacking** — публикация вредоносных пакетов под видом «брендированного», ложная ассоциация со знакомым брендом.

### 1.10.4 CICD-SEC-4: Выполнение «отравленного» pipeline

Poisoned Pipeline Execution (PPE) относятся к способности злоумышленника с доступом к системам контроля версий и без доступа к среде сборки манипулировать процессом сборки путем внедрения вредоносного кода/команд в конфигурацию конвейера сборки. по сути «отравляет» конвейер и запускает вредоносный код как часть процесса сборки.

Известные атаки:

- Direct/прямой PPE — изменение файла конфигурации CI в репозитории, либо отправляя изменения в незащищенную удаленную ветку репозитория.

Поскольку выполнение конвейера CI запускается событиями «push» или «PR», а выполнение конвейера определяется командами в измененном файле конфигурации CI (.gitlab-ci.yml), вредоносные команды злоумышленника в конечном итоге запускаются на узле сборки после запуска конвейера сборки.

- Indirect/косвенный PPE — когда D-PPE нереализуемо, злоумышленник все равно может «отравить» конвейер, внедрив вредоносный код в файлы, на которые ссылается конфигурация. Например, [example.sh](http://example.sh), Makefile, файлы в том же репо, которые используются при сборке, и т.д.
- Public PPE — злоумышленнику требуется доступ к репозиторию, где находится конфигурация конвейера, или к файлам, на которые он ссылается, но в публичных, общедоступные проектах/репозиториях.

### 1.10.5 CICD-SEC-5: Недостаточный контроль доступа конвейера

Узлы выполнения конвейера имеют доступ к многочисленным ресурсам и системам внутри и за пределами среды выполнения. Это может позволить злоумышленнику перемещаться внутри или за пределами системы CI/CD.

### 1.10.6 CICD-SEC-6: Недостаточная "гигиена" секретов

Риски недостаточной гигиены учетных данных связаны со способностью злоумышленника получать и использовать различные секреты и токены, распространяющиеся по всему конвейеру.

Примеры:

- хранение учетных данных разработчиком в своем репозитории.
- Забыли сменить пароль после настройки сервиса.
- При сборке и развёртывании, в том числе на стороне заказчика, секреты передаются в открытом виде.

### 1.10.7 CICD-SEC-7: Небезопасная конфигурация

Настройки по умолчанию, отсутствие важных исправлений безопасности, путаница зависимостей (Dependency confusion). Это не полный список причин риска небезопасной конфигурации.

### 1.10.8 CICD-SEC-8: Неконтролируемое использование сторонних сервисов

Использование сторонних сервисов повышает поверхность атаки. Соответственно неконтролируемое использование увеличивает поверхность еще больше. Хуже, если компания использовав какой-то сервис, перешла на новый, а токен на старом забыли отключить.

### 1.10.9 CICD-SEC-9: Некорректная валидация артефактов/Неправильная проверка целостности артефакта

Риски неправильной проверки целостности артефактов позволяют злоумышленнику, имеющему доступ к одной из систем в процессе CI/CD, проталкивать вредоносный код или артефакты по конвейеру из-за недостаточных механизмов обеспечения проверки кода и артефактов.

### 1.10.10 CICD-SEC-10: Недостаточное логирование и мониторинг

Недостаточное ведение журнала позволяют злоумышленнику осуществлять вредоносные действия в среде CI/CD, не будучи обнаруженным на любом этапе атаки, включая идентификацию TTP злоумышленника (Techniques, Tactics and Procedures) как часть любого пост-инцидента. расследование.

## Дополнительные материалы

[https://cloud.yandex.ru/ru/blog/posts/2023/06/devsecops-steps-part-2](https://cloud.yandex.ru/ru/blog/posts/2023/06/devsecops-steps-part-2)

[https://habr.com/ru/companies/zyxel/articles/651667/](https://habr.com/ru/companies/zyxel/articles/651667/)

[https://habr.com/ru/companies/zyxel/articles/549850/](https://habr.com/ru/companies/zyxel/articles/549850/)

[https://owasp.org/www-project-top-10-ci-cd-security-risks/](https://owasp.org/www-project-top-10-ci-cd-security-risks/)

Дополнительные материалы по CICD-SEC:

[https://habr.com/ru/companies/ru_mts/articles/781688/](https://habr.com/ru/companies/ru_mts/articles/781688/)

[https://habr.com/ru/companies/bimeister/articles/781274/](https://habr.com/ru/companies/bimeister/articles/781274/)

[https://owasp.org/www-project-top-10-ci-cd-security-risks/](https://owasp.org/www-project-top-10-ci-cd-security-risks/)