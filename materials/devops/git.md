# GIT

## Что такое система контроля версий?

- https://git-scm.com/book/ru/v2/%d0%92%d0%b2%d0%b5%d0%b4%d0%b5%d0%bd%d0%b8%d0%b5-%d0%9e-%d1%81%d0%b8%d1%81%d1%82%d0%b5%d0%bc%d0%b5-%d0%ba%d0%be%d0%bd%d1%82%d1%80%d0%be%d0%bb%d1%8f-%d0%b2%d0%b5%d1%80%d1%81%d0%b8%d0%b9

**Система контроля версий** - это система, позволяющая записать действия выполненные над файлами. Действием может быть создание, удаление или изменение файла.

Такие системы позволяют документировать историю изменений, позволяют нескольким разработчикам работать над одним проектом одновременно, а также позволяют откатить версии приложения, если в проекте что-то сломалось.

Git - это одна из систем контроля версий. Она была создана сообществом разработчиков ядра Linux, включая Линуса Торвальдса - создателя Linux, в поисках замены для BitKeeper.

> Система контроля версий - это один из ключевых инструментов разработки, позволяющий наладить непрерывную интеграцию и развертывание ПО (CI/CD) в процессе работы над проектом

## 1 Цели, которые преследовались при создании Git

- Простота архитектуры
- Скорость работы
- Поддержка нелинейной разработки
- Эффективность в управлении большими проектами
- Децентрализация

## 2 Снимки в Git

В отличие от большинства других систем, которые хранят информацию в виде списка изменений в файлах, Git хранит данные в виде набора снимков миниатюрной файловой системы. Каждый раз, когда вы сохраняете состояние своего проекта в Git (git commit), система запоминает, как выглядит каждый файл в этот момент, и сохраняет ссылку на этот снимок. Если файлы не были изменены, Git не запоминает эти файлы вновь, а только создаёт ссылку на предыдущую версию идентичного файла, который уже сохранён.

## 3 Большинство операции выполняются локально

Практически все операции выполняются на локальной версии проекта. Не важно создали вы свой проект или клонировали с GitHub. Команды могут выполняться не локально, когда вы работаете с удаленными репозиториями, серверами Git или Git-хостингами, а также когда вы используете графические интерфейсы или веб-интерфейсы для работы с Git.

## 4 Целостность Git

При создании коммитов Git вычисляет хэш сумму этого коммита. Как только файл будет изменен, изменится его и хэш сумма, а значит Git увидит факт изменения. Так, Git сохраняет все файлы не по имени, а по хэшу этих файлов.

## 5 Четыре состояния

Последняя важная часть без которой работа с Git невозможна - это состояния.

Состояния, в которых могут находиться файлы:

- изменён (modified)
- индексирован (staged)
- зафиксирован (committed)
- не отслеживаемый (untracked)

![](/materials/images/devops/devops_git_stages.png)

Индексированные файлы - это файлы, которые присутствовали в последнем снимке. Эти файлы могут быть изменёнными или готовыми к следующему коммиту. Соответственно все остальные файлы, которые не индексированы, будут иметь состояние не отслеживаемые.

Как только выполнено редактирование файла, он получает статус изменен и в при просмотре статусов файл будет выделен красным. При выполнении снимка в этом состоянии git не сохранит изменение при коммите. Для того чтобы он это сделал нужно индексировать этот файл. Commited - это состояние файла при выполнении снимка, выдается сразу после коммита. Это значит, что при редактировании файла, мы сможем вернуть его содержимое на момент создания снимка. После редактирования файла статус будет modified и цикл снова повторяется.

## 6 Ветки

Как мы помним, git не хранит данные в виде последовательности изменений, а хранит в виде снимков. Когда делается коммит, git сохраняет его в виде объекта, который указывает на снимок подготовленных данных. Этот объект также содержит информацию об авторе и его электронной почте, сообщение, которое вы ввели при коммите, и указатель на предыдущий коммит или коммиты, которые непосредственно предшествуют данному коммиту. Если это первый коммит, то у него не будет родителя. Если это обычный коммит, то у него будет один родитель, а если это результат слияния двух и более веток, то у него будет несколько родителей.

Помимо этого вычисляется контрольная сумма (хэш), что позволяет отслеживать как факт изменения коммита, так и дает своего рода уникальный идентификатор.

Ветка в Git - это перемещаемый указатель на один из коммитов. Имя основной ветки - master. При создании новых коммитов, ветка (или указатель) master будет указывать на последний коммит. Обычно ветки создают для нового направления разработки. Например: добавление новой функции, фикс багов, разработка новой функции. Ветки в Git помогают работать над проектом более гибко и эффективно.

В конечном итоге цель создания каждой конкретной ветке достигается и с ней нужно что-то делать дальше. А именно её нужно слить/вернуть в основную ветку, то есть все изменение выполнить в обеих ветках. В этом случае слитая ветка становится неактивной и ее удаляют.

Иногда случается так, что слить ветки невозможно. Происходит это, когда в двух ветках изменена одна и та же часть файла. В этом случае необходимо решить конфликт, выбрав нужное изменение, и выполнить коммит.

## 7 GitHub и GitLab. Удаленный репозиторий

Удаленный репозиторий представляет собой сохраненный проект находящийся на удаленном сервере где-то в сети. Это позволяет нескольким разработчикам работать над одним и тем же проектом, синхронизируя изменения между их локальными репозиториями и удаленным репозиторием. По большей части GitHub и GitLab являются такими удаленными репозиториями.

## 8 Github flow

GitHub flow - это набор практик, облегчающий и оптимизирующий работу процесса с Git. Существуют и другие практики, но их мы не коснёмся.

Практики GitHub flow описывают несколько этапов:

1. Создается новая ветка, чтобы начать работу над новой функцией или исправлением ошибки.
2. После выполнения всех изменений разработчик коммитит их. Каждый коммит имеет объяснение. Понятное описание даст возможность понять другим разработчикам ваши намерения и насколько изменения им соответствуют.
3. Выполнить запрос на слияние(pull request). Запрос на слияние может быть выполнен в любом из случаев: - вы готовы к проверке вашей работы - вы столкнулись с проблемами и нуждаетесь в помощи - вы хотите поделиться некоторыми соображениями и/или скриншотами с командой.
4. После идет обсуждения запроса на слияния. Если есть какие-то доработки, то их можно отправить помощью команды push. GitHub покажет ваши новые фиксации и любую дополнительную информацию.
5. Теперь после проверки можно влить в основную. После слияния создаётся фиксация со всеми изменениями из вашей ветки.

В других подходах сначала происходит слияние, потом различные тесты. Если что-то не стыкуется, то для отката и фиксов потребуется время, что может привести к переносу релиза.

## 9 GitHub или GitLab

GitHub и GitLab являются веб-репозиториями Git, важными для успешной разработки программного обеспечения. Они помогают управлять изменениями в проектах с открытым исходным кодом и сохраняют эффективность разработки. GitHub является самой популярной платформой для управления репозиториями на основе git, с более 28 миллионами пользователей и 85 миллионами репозиториев кода. GitHub поддерживает размещение открытого исходного кода, но не является полностью открытым. GitHub делает упор на высокую доступность и производительность инфраструктуры.

GitLab также является веб-репозиторием git. Он набирает популярность среди разработчиков проектов с открытым исходным кодом. GitLab является полноценной DevOps системой на хорошо интегрированной платформе. Важным плюсом GitLab можно считать возможность установить его локально.

## 10 GitLab Runner

GitLab Runner - агент который занимается выполнением инструкций .gitlab-ci.yaml. В отличие от Jenkins, он написан на GO, поэтому он быстрый и мало весит. Так же Runner умеет запускать задачи разными способами: локально, в докер-контейнерах, в различных облаках или через ssh-коннект к какому либо серверу.

- [https://git-scm.com/book/ru/v2/](https://git-scm.com/book/ru/v2/)

## Настройка и конфигурация

```bash
# Инициализация нового репозитория
git init

# Клонирование и создание копии удаленного репозитория
git clone <url>

# Глобальная конфигурация настроек Git. Эти параметры используются для идентификации автора коммитов
git config --global <setting_name> "value"

# Конфигурация настроек Git для конкретного репозитория. Переопределяет глобальные настройки для конкретного репозитория
git config --local <setting_name> "value"
```

## Операции с файлами

```bash
# Статус текущей ветки
git status

# Добавление файлов в буфер для коммита
git add <files>

# Удаление файла из буфера и репозитория
git rm <files>
# Удаление файла из буфера с сохранением в репозитории
git rm --cached <file_name>

# Переместить или переименовать файл
git mv <old_file> <new_file>

# Создание коммита с комментарием
git commit -m "Commit message"

# Разница между текущей директорией и последним коммитом
git diff
# Разница между двумя коммитами
git diff <commid_id1> <commit_id2>
```

## Branching and merging

```bash
# Список всех веток
git branch
# Создание новой ветки
git branch <branch_name>
# Удалить указанную ветку
git branch -d <branch_name>
# Список всех удаленных веток
git branch -r
# Удаленные ветки, которые могут быть merged с текущей веткой
git branch -r --merged
# Удаленные ветки, которые не могут быть merged с текущей веткой
git branch -r --no-merged

# Перемещение на другую ветку
git checkout <branch_name>
# Создание новой ветки на основании удаленной ветки
git checkout -b <branch_name> <remote_name>/<remote_branch>

# Слияние ветки в текущую ветку
git merge <branch_name>
# Отмена merge при наличии конфликтов
git merge --abort
```

## Удаленные репозитории

```bash
# Список удаленных репозиториев
git remote
# Создать удаленный репозиторий
git remote add <name> <url>
# Удалить удаленный репозиторий
git remote rm <remote_name>
# Информация об удаленном репозитории
git remote show <remote_name>
# Ветки удаленных репозиториев
git remote show <remote_name> --verbose
# Обновление локальных ссылок на удаленные ветки и теги
git remote update
# Переименование удаленного репозитория
git remote rename <old_name> <new_name>
# Изменение сслыки удаленного репозитория
git remote set-url <name> <new_url>
# Удаление ссылок на удаленные элементы, которых уже нет в удаленном репозитории
git remote prune <remote_name>

# Получение данных из удаленного репозитория
git fetch <remote_name>
# Синхронизация локального репозитория с удаленным. Обновляет все удаленные ветки, удаляет удаленные ветки
git fetch -p

# Получение данных из удаленного репозитория
git pull <remote_name> <remote_branch>

# Отправка данных на удаленный репозиторий
git push <remote_name> <remote_branch>
# Принудительная загрузка изменений на удаленный репозиторий
git push --force <remote_name> <local_branch>
```

## Commits

```bash
# История коммитов
git log
# История коммитов в кратком формате
git log --oneline
# История коммитов в виде графа. Отображает связи между ветками и их объединения
git log --graph
# История коммитов по автору
git log --author=<author_name>
# История коммитов с указанной даты
git log --since=<date>
# История коммитов до даты
git log --until=<date>
```

## Tags

```bash
# Список тегов
git tag

# Новый тег для коммита
git tag <tag_name> <commit_id>

# Создание тега с комментарием
git tag -a <tag_name> -m 'tag message'

# Удаление тега
git tag -d <tag_name>

# Удаление удаленного тега
git push <remote_name> --delete <tag_name>

# Информация о теге
git show <tag_name>
```

## Commit Management

```bash
# Изменение последнего коммита
git commit --amend

# Создание нового коммита, который отменяет действия предыдущего коммита
git revert <commit_id>

# Отменение изменений и перемещение HEAD на конкретный коммит
git reset --hard <commit_id>

# Переместить HEAD на конкретный коммит, но сохранить изменения
git reset --soft <commit_id>

# Запись всех изменений, внесенных в заголовок локального репозитория
git reflog
```
