# GRUB и Сброс пароля root на примере Kali

**GRUB** расшифровывается как **Grand Unified Boot Loader** - главный унифицированный загрузчик. Рассмотрим версию GRUB 2, но существует также устаревшая версия под названием **GRUB Legacy**, которая применяется все реже. Одной из наиболее важных возможностей **GRUB** является навигация по файловой системе, которая позволяет легко выбирать образ ядра и его параметры. Лучший способ увидеть это в действии и узнать о загрузчике **GRUB** в целом - заглянуть в его меню. 

**GRUB весь процесс его работы:**

1. PC BIOS или прошивка инициализирует аппаратное обеспечение и выполняет поиск загрузочного кода на своих устройствах хранения данных.
2. После нахождения загрузочного кода BIOS (или прошивка) загружается и выполняет его. Вот тут-то и вступает в дело GRUB.
3. Загружается ядро GRUB.
4. Ядро инициализируется. На этом этапе GRUB может получить доступ к дискам и файловым системам.
5. GRUB идентифицирует свой загрузочный раздел и загружает туда конфигурацию.
6. GRUB дает пользователю возможность изменить конфигурацию.
7. После тайм-аута или действий пользователя GRUB выполняет конфигурацию (последовательность команд в файле grub.cfg, как описано в разделе 5.5.2).
8. В ходе выполнения конфигурации GRUB может загружать дополнительный код (модули) в загрузочный раздел. Некоторые из них могут быть предварительно загружены.
9. GRUB выполняет команду boot для загрузки и выполнения ядра, как указано в конфигурации команды linux.

> [!INFO] Title
> В GRUB нет пользователей и это отдельная ОС, но есть некоторые команды, которые похожи на обычную операционную систему их можно посмотреть с помощью help. 
> 
> В GRUB мы можем только читать, нельзя копировать или редактировать. Даже если загрузка с флешки запрещена, то через GRUB она загрузится.

- Заходим в GRUB
- Открываем терминал GRUB (Клавиша `C`)
- Делаем фон черным (`background_color black`)
- Смотрим имеющиеся в системе диски (`ls -l`)
- Определяем какой диск содержит корневую файловую систему (`ls (hd0,msdos1)`)
- Смотрим содержимое диска (`ls (hd0,msdos1)/`)
- Посмотрим содержимое /etc/passwd (`cat (hd0,msdos1)/etc/passwd`)
- Изменим корневой каталог (`set root=(hd0,msdos1)`)
- Теперь мы можем получить данные на этом диске с помощью ls (`ls /`)
- Активируем функцию просмотра more (`set pager=1`)
- Возврщаемся в GRUB с помощью ESC
- Открываем конфиги загрузчиков (Нажимаем `e`)
- Изменяем строку `...linux... /boot/...` и изменяем `ro` на `rw`
- Добавляем опцию запуска bash без авторизации сразу после загрузки ядра и файловой системы (Добавляем `init=/bin/bash`)
- Запускаем систему с помощью `CTRL+X`
- Получаем доступ к bash с правами root и сбрасываем пароль (`passwd`)
- Если нет прав на изменение, то нужно перемонтировать диск (`mount -p remount,rw /`)

> [!ERROR] Осторожно
> Если закрыть консоль нештатно, то это приведет к критической ошибке

- Перезагружаемся с помощью интерфейса sysrq-trigger (`echo b > /proc/sysrq-trigger`). Интерфейс позволяет сделать запрос напрямую к ядру

> [!INFO] Про sysrq
> https://ru.wikipedia.org/wiki/SysRq
> https://habr.com/ru/post/98770

- Загрузить ОС как обычно и войти под root с новым паролем

> [!WARNING] Внимание
> Защитные меры мало эффективны, единственная мера - это шифрование диска.
> 
> Если диск не зашифрован, то почти всё бесполезно и произвести сброс может любой, кто обладает знаниями как это сделать.
