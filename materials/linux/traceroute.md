# TRACEROUTE

**Traceroute** - это утилита командной строки для отслеживания полного пути от вашей локальной системы к другой сетевой системе. Он печатает количество переходов (IP-адреса маршрутизатора) на этом пути, по которому вы путешествуете, чтобы добраться до конечного сервера. Это простая в использовании утилита для устранения неполадок сети после команды ping.

Команда traceroute может применяться для тестирования, администрирования и оценки значений параметров сети.

Команда ping позволяет убедиться, что удаленная сеть IP достижима. Однако с ее помощью нельзя обнаружить и устранить неполадки. 

Рассмотрим следующий пример:
- Если маршрут от системы к целевому хосту содержит много транзитных узлов (например, шлюзов и маршрутизаторов), то неполадка может возникнуть на любом из этих узлов. В этом случае нужно выяснить, на каком этапе теряется пакет
- Если пакет не удается доставить, команда **ping** не сообщает причину ошибки.

Команда traceroute позволяет узнать, где в данный момент находится пакет, и почему его нельзя доставить по заданному маршруту. Если пакет будет передаваться через маршрутизаторы и каналы связи, принадлежащие другим организациям, то вам вряд ли удастся проверить состояние этих маршрутизаторов с помощью команды telnet. В этом случае можно воспользоваться командами traceroute и ping.


> [!NOTE] Основные опции
> - 4 или -6 - использовать ipv4 или ipv6 протокол
> - I - использовать ICMP пакеты вместо UDP
> - T - использовать TCP пакеты вместо UDP
> - F - не фрагментировать пакеты
> - f - указать TTL с которого нужно начать
> - g - передавать пакет через указанный шлюз
> - i - передавать пакет через указанный интерфейс
> - m - максимальное количество узлов, через которые пройдет пакет
> - q - количество пакетов, отправляемых за раз, по умолчанию три
> - n - не узнавать доменные имена
> - p - указать порт вместо порта по умолчанию
> - w - установить время ожидания ответа от узла, по умолчанию полсекунды
> - r - использовать другой роутер вместо того, что указанный в таблице маршрутизации
> - z - минимальный интервал между пакетами
> - U - использовать UDP с увеличением номера порта
> - UL - использовать протокол UDPLITE
> - D - использовать протокол DCCP
> - –mtu - указать размер пакета
> - P - протокол, доступны такие значения: raw, dccp, udplite, udp, tcpconn, tcp, icmp

Команда **traceroute** применяет протокол UDP и функцию создания отчета об ошибках, предусмотренную в ICMP. Эта команда трижды отправляет пакет UDP каждому шлюзу или маршрутизатору, входящему в маршрут. Первый пакет отправляется ближайшему шлюзу. Второй пакет отправляется следующему за ним транзитному узлу и т.д. Последний пакет отправляется целевой системе. В выводе команды указывается имя шлюза, IP-адрес шлюза и время оборота трех пакетов, отправленных шлюзу.

Если маршрут проходит через сеть с коммутацией каналов (WAN), то при передаче первого пакета дополнительное время будет затрачено на установление соединения. В результате может произойти тайм-аут. Тайм-аут по умолчанию составляет 3 секунды. Его можно изменить с помощью опции -w.

> [!ERROR] Неполадки, возникающие при выполнении команды traceroute
> Если маршрут к целевому хосту включает большое число транзитных узлов или проходит через сети со сложной конфигурацией, то при вызове команды traceroute часто возникают различного рода ошибки. Поскольку многие аспекты работы команды зависят от ее реализации, во многих случаях невозможно найти причину ошибки. Однако если все маршрутизаторы и системы, через которые передается пакет, относятся к вашей организации, то вы можете проанализировать причину ошибки.
> 
> Если в течение 3 секунд от целевой системы не будет получен ответ, то для всех запросов возникает тайм-аут, и в выводе команды указывается звездочка. Если предположительно ошибка связана с каналом связи, то увеличьте значение тайм-аута с помощью флага `-w`. Кроме того, возможно, хотя и маловероятно, что все порты были заняты. Попробуйте изменить номера портов и повторите запрос.

```bash
# Маршрут сетевых пакетов до example.com
traceroute example.com

# Указание использовать IPv6
traceroute -6 example.com

# Предотвращение фрагментации пакетов
traceroute -F example.com

# Маршрут без изменения IP в имена
traceroute -n example.com

# Использовать указанный порт при трассировке маршрута
traceroute -p 80 example.com
```
