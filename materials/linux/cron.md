# CRON

[lab](materials/labs/linux_labs/lab_14.md)

Cron - это планировщик заданий, который позволяет автоматически выполнять определенные действия на сервере (запуск программ, скриптов и т.д.), с заданным временем или периодичностью.

cron - демон.
crontab (Cron Table) - системный файл, который создает табличную структуру, в которой поля разделяются пробелами. Содержит cron jobs (задачи).
cron job - задача, которая описана в строке в таблице.

Нужно создать сценарий, а затем указать демону CRON, чтобы он вызывал его в определенное время. Чтобы настроить демон CRON, нужно сохранить задачи в файле с именем crontab, а затем сообщить демону, когда запускать задачи.

# Базовые операции

```bash
# Изменение файла CRON
crontab -e

# Изменение файла CRON другого пользователя
crontab -u username -e

# Удаление файла CRON текущего пользователя. `-r` удаляет принудительно, `-i` спрашивает подтверждение
crontab -r
# или
crontab -i

# Отображение файла CRON. Если нет созданных файлов CRON, то будет соответствующий вывод
crontab -l
```

# Синтаксис

```
[Minute] [Hour] [Day] [Month] [Weekday] [Command to be executed]
```

- __Minute__: (0-59) Определяет, в течение какой минуты задача должна быть выполнена
- __Hour__: (0-23) Определяет, в какой час должна быть выполнена задача
- __Day__: (1-31) Определяет, в какой день месяца должна выполняться задача
- __Month__: (1-12) Определяет, в каком месяце задача должна быть выполнена
- __Weekday__: (0-6) Определяет, в какой день недели должна выполняться задача (0 - вс)

## Операторы

```bash
*    : Все значения
,    : Разделяет отдельные значения
-    : Диапазон значений
/    : Разделяет значения на шаги
```

## Специальные строки

- __`@reboot`__: every reboot.
- __`@hourly`__: once every hour - same as `0 * * * *`.
- __`@daily`__: once every day - same as `0 0 * * *`.
- __`@midnight`__: once every midnight - same as `@daily`.
- __`@weekly`__: once every week - same as `0 0 * * 0`.
- __`@monthly`__: once every month - same as `0 0 1 * *`.
- __`@yearly`__: once every year - same as `0 0 1 1 *`.

## Примеры

```bash
# Запуск каждый час, в 0 минут
0 * * * * /bin/bash /script.sh

# Запуск в 0 минут 0 часов, каждый день
0 0 * * * /bin/bash /script.sh

# Запуск в первый день каждого месяца
0 0 1 * * /bin/bash /script.sh

# Запуск каждое 15 число месяца
0 0 15 * * /bin/bash /script.sh

# Запуск в первый день недели первого месяца в 0 часов 0 минут
0 0 * 1 0 /bin/bash /script.sh

# Запуск в первый день недели в 0 часов 0 минут
0 0 * * 0 /bin/bash /script.sh

# Запуск в третий день недели в 15 часов 30 минут
30 15 * * 2 /bin/bash /script.sh

# Запуск каждое вс в 15:30
30 15 * * sun /bin/bash /script.sh

# Запуск каждый час с 7 до 19 часов
0 7-19 * * * /bin/bash /script.sh

# Запуск каждые 16:05 и 16:35
5,35 16 * * * /bin/bash /script.sh

# Запуск раз в 10 минут
/10 * * * * /bin/bash /script.sh

# Изи
echo “@reboot echo hi” | crontab
```

# Особенности

- Минимальное время составляет одну минуту
- Файл crontab должен всегда заканчиваться пустой строкой
- Условия времени запуска «день недели» и «день месяца» обрабатываются через логическую операцию «ИЛИ», все остальные условия - через логическое «И»
- Выводы запускаемых команд выводятся в виде сообщений пользователю, но если в файле crontab была определена директива MAILTO - сообщение будет отправлено по указанному в этой директиве e-mail

# Управление

```bash
service cron status
systemctl status cron
```
- Статус утилиты CRON



**В нашем случае текст скрипта `pwd.sh` следующий:**

![https://i.imgur.com/Bts5YZ3.png](https://i.imgur.com/Bts5YZ3.png)

```
#!/bin/bash                         - указывает, что это скрипт
# This is a comment                 - любой комментарий
cat /dev/null > /var/log/cron.log   - удаление текста в cron.log
cat /dev/null > /var/log/cron.txt   - удаление текста в cron.txt
pwd && whoami >> /var/log/cron.log  - последовательное выполнение pwd и whoami с последующей записью в cron.log
w >> /var/log/cron.log              - выполнение команды w с последующей записью в cron.log
ping -c3 ya.ru >> /var/log/cron.txt - выполнение ping -c3 ya.ru с последующей записью в cron.txt
ping -c4 77.88.8.8 >> /var/log/cron.log - выполнение ping -c4 77.88.8.8 с последующей записью в cron.txt
```
