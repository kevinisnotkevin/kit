# ФАЙЛОВЫЕ СИСТЕМЫ

## Виды разделов

**Первичный (основной) раздел**

Первичный раздел обязательно должен быть на физическом диске. Этот раздел всегда содержит либо одну файловую систему, либо другие логические разделы. На физическом диске может быть до четырёх первичных разделов. Некоторые старые операционные системы - например, MS-DOS и Windows - могли быть установлены только на первичный раздел.

**Расширенный и Логические разделы**

Таблица разделов может содержать не более 4 первичных разделов, поэтому были изобретены расширенный разделы. В расширенном разделе можно создать несколько логических разделов. Логические разделы выстраиваются в цепочку где информация о первом логическом разделе храниться в MBR, а информация о последующем хранится в первом секторе логического раздела. Такая цепочка позволяет (в теории) создавать неограниченное количество разделов, но (на практике) число логических разделов ограничивается утилитами и, обычно, больше 10 логических разделов не создать.

Некоторые версии Windows не могут загрузиться с логического раздела (нужен обязательно первичный раздел), тогда как для Linux никакой разницы в виде разделов - нет, Linux загружается и работает с разделами совершенно независимо от их вида (первичный или логический).

## Файловые системы

**Файловая система** - это инструмент, позволяющий ОС и программам обращаться к нужным файлам и работать с ними. При этом программы оперируют только названием файла, его размером и датой созданий. Все остальные функции по поиску необходимого файла в хранилище и работе с ним берет на себя файловая система накопителя.

**Основные функции файловой системы**

- Фрагментация файлов и их распределение на носителе.
- Поиск файла при запросе программ.
- Участие в создании, чтении и удалении файлов.
- Работа с атрибутами файлов: изменение названия, размера, времени последнего изменения, доступ к файлу и многое другое.
- Каталогизация и организация файлов.
- Защита файлов от несанкционированного доступа и сбоев системы.
- Определение права доступа к файлам.
- Восстановление информации в случае сбоев.

Таким образом, файловая система устанавливает правила эксплуатации и организацию данных на накопителе, и тем самым экономит ресурсы ОС и рабочих программ. К тому же наличие файловой системы позволяет использовать накопитель на разных компьютерах без каких-либо предварительных настроек и оптимизации.

## FAT32

Исходный код файловой системы, получившей название FAT, был разработан по личной договоренности владельца Microsoft Билла Гейтса с первым наемным сотрудником компании Марком Макдональдом в 1977 году. Основной задачей FAT была работа с данными в ОС Microsoft 8080/Z80 на базе платформы MDOS/MIDAS. Файловая система FAT претерпела несколько модификаций - FAT12, FAT16, FAT32, которая используется сейчас в большинстве внешних накопителей. Основным отличием каждой версии является преодоление ограниченного объема доступной для хранения информации. В дальнейшем были разработаны еще две более совершенные системы обработки и хранения данных - NTFS и ReFS. Современная версия FAT32 вышла в 1995 году. Она может работать с томами размером до 32 ГБ и файлами размером до 4 ГБ. При этом система не работает с накопителями объемом более 8 Тб. Поэтому сегодня FAT32 используется в основном только на флешках, картах памяти фотоаппаратов и музыкальных плееров.

Структура накопителя с FAT32 имеет три области:

- Служебный сектор, который зарезервирован системой.
- Таблица указателей для поиска файлов.
- Область записи данных.

Благодаря отсутствию шифрования, современных систем защиты информации и журнала данных, накопители с файловой системой FAT32 могут работать быстрее, но только с единичными файлами. Работа с массивом небольших файлов может затянуться надолго. Причиной является иерархическая структура, которая подразумевает многоуровневый доступ к файлам, в отличие от бинарного дерева, где доступ к файлам открывается напрямую, независимо от других.

Однако несмотря на очевидные недостатки, система все еще востребована, и даже предоставляет некоторые преимущества:

- Накопители меньше изнашиваются, благодаря отсутствию журнала.
- Флешки с FAT32 распространены в рабочей среде. На них удобно переносить документы, фотографии, небольшие видеоролики, презентации.
- Флешки с FAT32 используются в качестве установочных.

Числа в FAT12, FAT16 и FAT32 обозначают количество бит, используемых для перечисления блока файловой системы. FAT32 является фактическим стандартом и устанавливается на большинстве видов сменных носителей по умолчанию. Одной из особенностей этой версии ФС является возможность применения не только на современных моделях компьютеров, но и в устаревших устройствах и консолях, снабженных разъемом USB.

С целью устранения ограничений, присущих FAT32, корпорация Microsoft разработала обновленную версию файловой системы exFAT (расширенная таблица размещения файлов). Новая ФС очень схожа со своим предшественником, но позволяет пользователям хранить файлы намного большего размера, чем четыре гигабайта. В exFAT значительно снижено число перезаписей секторов, ответственных за непосредственное хранение информации. Функция очень важна для твердотельных накопителей ввиду необратимого изнашивания ячеек после определенного количества операций записи. Продукт exFAT совместим с операционными системами Mac, Android и Windows. Для Linux понадобится вспомогательное ПО.

## NTFS

NTFS, или новая технология файловой системы была создана, чтоб устранить недостатки FAT32.

Структура системы хранения данных имеет вид бинарного дерева. В отличие от иерархической, как у FAT32, доступ к информации осуществляется по запросу, а поиск ведется по названию файла. При этом система имеет каталог, отсортированный по названиям. Массив делится на 2 части и отсекается та, в которой данного файла не будет, оставшаяся часть также делиться на 2, и так далее до тех пор, пока не будет найден нужный файл.

**Особенности**

- Имена файлов размером до 255 символов.
- Журналирование - действия с файлами выполняются полностью, или не совершается вовсе. Например, если во время копирования файлов отключается питание, то при включении по журналу система проверит, какие файлы были скопированы полностью, а результаты незавершенных процессов удаляются.
- Использование шифрования для защиты данных. Использование системы шифрования Encryption File System (метод «прозрачного шифрования») осуществляет разграничение доступа к данным для различных пользователей, предотвращает несанкционированный доступ к содержимому файла. 
- Файловая система позволяет использовать расширенные имена файлов, включая поддержку многоязычности в стандарте юникода UTF, в том числе в формате кириллицы. 
- Встроенное приложение проверки жесткого диска или внешнего накопителя на ошибки файловой системы повышает надежность работы диска, но отрицательно влияет на производительность.
- В отличие от предыдущей файловой системы, NTFS может работать с томами объемом 8 ПБ (1 петабайт – 10^15 байт), и оперировать более чем 4 миллиардами файлов.

## ReFS

ReFS (Resilient File System) - это последняя разработка Microsoft, доступная для серверов Windows 8 и 10. Архитектура файловой системы в основном организована в виде B-tree. Файловая система ReFS обладает высокой отказоустойчивостью благодаря реализации новых функций:

- Copy-on-Write (CoW) - никакие метаданные не изменяются без копирования;
- Данные записываются на новое дисковое пространство, а не поверх существующих файлов;
- При модификации метаданных новая копия хранится в свободном дисковом пространстве, затем система создает ссылку из старых метаданных на новую версию.

Все это позволяет повысить надежность хранения файлов, обеспечивает быстрое и легкое восстановление данных.

## Файловые системы macOS

Для ОС macOS компания Apple использует собственные разработки файловых систем:

1. HFS+, которая является усовершенствованной версией HFS, ранее применяемой на компьютерах Macintosh, и ее более соверешенный аналог APFS. Стандарт HFS+ используется во всех устройствах под управлением продуктов Apple, включая компьютеры Mac, iPod, а также Apple X Server.
2. Кластерная файловая система Apple Xsan, созданная из файловых систем StorNext и CentraVision, используется в расширенных серверных продуктах. Эта файловая система хранит файлы и папки, информацию Finder о просмотре каталогов, положениях окна и т.д.

## Файловые системы Linux

В отличие от ОС Windows и macOS, ограничивающих выбор файловой системы предустановленными вариантами, Linux предоставляет возможность использования нескольких ФС, каждая из которых оптимизирована для решения определенных задач. Файловые системы в Linux используются не только для работы с файлами на диске, но и для хранения данных в оперативной памяти или доступа к конфигурации ядра во время работы системы. Все они включены в ядро и могут использоваться в качестве корневой файловой системы.

**Основные файловые системы**

- Ext2;
- Ext3;
- Ext4;
- JFS;
- ReiserFS;
- XFS;
- Btrfs;
- ZFS.

**Ext2, Ext3, Ext4** или **Extended Filesystem** - это стандартная файловая система, первоначально разработанная для Minix. Содержит максимальное количество функций и является наиболее стабильной в связи с редкими изменениями кодовой базы. Начиная с ext3 в системе используется функция журналирования. Сегодня версия ext4 присутствует во всех дистрибутивах Linux.

**JFS** или **Journaled File System** разработана в IBM в качестве альтернативы для файловых систем ext. Сейчас она используется там, где необходима высокая стабильность и минимальное потребление ресурсов (в первую очередь в многопроцессорных компьютерах). В журнале хранятся только метаданные, что позволяет восстанавливать старые версии файлов после сбоев.

**ReiserFS** также разработана в качестве альтернативы ext3, поддерживает только Linux. Динамический размер блока позволяет упаковывать несколько небольших файлов в один блок, что предотвращает фрагментацию и улучшает работу с небольшими файлами. Недостатком является риск потери данных при отключении энергии.

**XFS** рассчитана на файлы большого размера, поддерживает диски до 2 терабайт. Преимуществом системы является высокая скорость работы с большими файлами, отложенное выделение места, увеличение разделов на лету, незначительный размер служебной информации. К недостаткам относится невозможность уменьшения размера, сложность восстановления данных и риск потери файлов при аварийном отключении питания.

**Btrfs** или **B-Tree File System** легко администрируется, обладает высокой отказоустойчивостью и производительностью. Используется как файловая система по умолчанию в OpenSUSE и SUSE Linux.

Другие ФС, такие как NTFS, FAT, HFS, могут использоваться в Linux, но корневая файловая система на них не устанавливается, поскольку они для этого не предназначены.

## Точки монтирования

Linux не назначает буквы каждому диску и разделу, как в Windows и DOS. Вместо этого вы должны задать точку монтирования для каждого диска и раздела. Linux работает по принципу иерархического дерева каталогов, где корневой каталог ( / ) является основной точкой монтирования, в которую по умолчанию входят все остальные. 

В отличии от Windows в Linux все используемые разделы дисков монтируются в подкаталоги корня, а не как отдельные устройства (C:, D: …). К примеру, в _/home_ хранятся все ваши персональные файлы. Если вы хотите разместить эти данные в отдельном от корня разделе, то создадите новый раздел и установите точку монтирования на `/home`. Это можно сделать для любого подкаталога. 

Например во время установки Ubuntu у вас возможность задать следующие точки монтирования: _/boot_ (начальный загрузчик и заголовки ядра), _/dev_ (драйверы и устройства), _/home_ (пользовательские файлы), _/opt_ (дополнительное программное обеспечение), _/srv_ (системные сервисы) _/tmp_ (временные файлы), _/usr_ (приложения), _/usr/local_ (данные, доступные всем пользователям) и _/var_ (server spool и логи). Также при установке можно создать и свои точки монтирования с произвольными именами. Для типичной настольной системы нет никакого смысла выделять собственные разделы для _/dev_, _/opt_, _/srv_, _/tmp_, _/usr/local_ и _/var_. Если вы планируете запускать более двух операционных систем или использовать шифрование корневого раздела, то возможно потребуется отдельный раздел для _/boot_. Иногда стоит также создать раздел для _/usr_, но только если вы уже имеете чёткое представление о том, сколько места займут приложения. Желательно создать отдельный раздел для _/home_. Это предоставит вам дополнительные удобства при обновлении и переустановке системы.

Минимально можно ограничится только двумя разделами: «root» и «swap», тогда _/boot_, _/home_, _/usr_ и все остальные будут просто храниться в корневом разделе ( / ).
