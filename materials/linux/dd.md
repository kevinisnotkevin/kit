# dd

[lab](materials/labs/linux_labs/lab_12.md)

dd - утилита, которая копирует и конвертирует данные.

Используется для работы с дисками и файловыми системами.

```bash
# Создание точного образа USB-накопителя и запись его в новый файл
dd if=/dev/sdb1 of=~/usb_drive_image.img bs=4096
```


### 1 Копирование данных с одного диска на другой

```bash
sudo dd if=/dev/sda of=/dev/sdb bs=4M status=progress
```
- **`if=/dev/sda`** указывает исходное устройство или файл, откуда будут считываться данные
- **`of=/dev/sdb`** указывает целевое устройство или файл, куда будут записываться скопированные данные
- **`bs=4M`** задает размер блока данных, который будет считываться и записываться за одну операцию (4 мегабайта). Изменение этого параметра может влиять на скорость копирования и потребление ресурсов
- **`status=progress`** добавляет вывод информации о текущем прогрессе выполнения операции. Она показывает текущее состояние операции, сколько данных уже было скопировано и скорость копирования

### 2 Создание образа диска для резервного копирования

```bash
sudo dd if=/dev/sda of=disk_image.img bs=4M status=progress
```
- После выполнения этой команды, **`dd`** начнет копирование данных с диска **`/dev/sda`** и сохранит их в файл **`disk_image.img`**. В процессе выполнения операции будет выводиться информация о текущем прогрессе, и по завершении операции вы получите информацию о скорости и времени выполнения. Образ диска будет сохранен в файле **`disk_image.img`** и может быть использован, например, для резервного копирования или восстановления данных с этого диска в будущем.

### 3 Клонирование USB-флешки на другую флешку

```bash
sudo dd if=/dev/sdc of=/dev/sdd bs=4M status=progress
```
- **`dd`** начнет копирование данных с блочного устройства **`/dev/sdb1`** на блочное устройство **`/dev/sdc1`**. В выводе команды будет отображаться текущий прогресс операции, и по завершении копирования вы увидите информацию о скорости и времени выполнения

### 4 Запись образа на диск или флешку

```bash
dd if=/dev/sda3 of=/home/user/usb/sda3.img bs=4M status=progress
```
- Cоздаем образ раздела **`/dev/sda3`** и сохраняем его в файл **`/home/user/usb/sda3.img`**. Файл **`sda3.img`** содержит точную копию содержимого раздела **`/dev/sda3`**. Вы сможете использовать этот образ для резервного копирования данных или для восстановления раздела, если это будет необходимо.

```bash
dd if=/home/user/usb/sda3.img of=/dev/sdc bs=4M status=progress
```
- Записываем содержимое образа раздела **`/home/user/usb/sda3.img`** на устройство **`/dev/sdc`**. Это позволит восстановить содержимое раздела **`/dev/sda3`** на устройстве **`/dev/sdc`**

**Переходим на вторую машину**

```bash
cryptsetup luksOpen /dev/sdc my-dm_crypt-1
```
- Открываем устройство **`/dev/sdc`** с помощью LUKS шифрования и называем его **`my-dm_crypt-1`**. После успешного выполнения этой команды, устройство будет доступно для использования в виде **`/dev/mapper/my-dm_crypt-1`**

```bash
vgscan
```
- Сканируем систему на предмет групп томов (VG) с использованием метаданных LVM2. Она обнаруживает группу томов с именем "ubuntu-vg", использующую метаданные типа LVM2 в системе
```bash
vgchange -ay
```
- Активируем группу томов, указанную в конфигурации LVM. Вывод "1 logical volume(s) in volume group 'ubuntu-vg' now active" указывает на то, что один логический том внутри группы томов "ubuntu-vg" был активирован и теперь доступен для использования.
```bash
mount /dev/ubuntu-vg/ubuntu-lv /home/user/usb
```
- Монтируем логический том и получаем доступ к его ресурсам

**Таким образом, мы получили доступ к копии файловой системы первой машины на второй машине**

Теперь деактивируем подключенный диск.

```bash
umount /dev/ubuntu-vg/ubuntu-lv /home/igor/usb
```
- Размонтируем два раздела
```
vgchange -an ubuntu-vg
```
- После выполнения этой команды том будет отключен и не будет доступен для использования до тех пор, пока его не активируют снова с помощью **`vgchange -ay`**
```bash
cryptsetup close my-dm_crypt-1
```
- Отключение LUKS-контейнера

### 5 Удаление данных с диска

```bash
sudo dd if=/dev/urandom of=/dev/sdf bs=4M status=progress
```
- Удаление данных с диска, записывая случайные данные

### 6 Изменение размера образа

```bash
truncate -s 2G disk_image.img
```
- Изменение размера образа диска до 2 гб

### 7 Преобразование текстового файла

```bash
dd if=input.txt of=output.bin conv=ebcdic bs=1 count=100
```
- Преобразование текстового файла в бинарный

### 8 Чтение и запись данных в определенном формате

```bash
dd if=input.ebcdic of=output.ascii conv=ascii
```
- Преобразование данных из формата EBCDIC в ASCII и сохранение в файл

### 9 Создание случайных данных

```bash
dd if=/dev/urandom of=random_data.bin bs=1M count=1024
```
- Создание файла со случайными данными обьемом 1 гб

### 10 Измерение производительности дисков

```bash
dd if=/dev/zero of=/dev/sdg bs=4M count=1000 oflag=direct
```
- Измерение скорости чтения и записи на диск
