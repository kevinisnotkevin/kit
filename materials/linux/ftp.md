# FTP

FTP (англ. File Transfer Protocol) — протокол передачи файлов по сети, появившийся в 1971 году задолго до HTTP и даже до TCP/IP, благодаря чему является одним из старейших прикладных протоколов. Изначально FTP работал поверх протокола NC (nc - реализация подключений и ожиданий входящих соединений, через TCP и UDP), на сегодняшний день широко используется для распространения ПО и доступа к удалённым хостам. В отличие от TFTP, гарантирует передачу (либо выдачу ошибки) за счёт применения квотируемого протокола. Протокол построен на архитектуре «клиент-сервер» и использует разные сетевые соединения для передачи команд и данных между клиентом и сервером. Пользователи FTP могут пройти аутентификацию, передавая логин и пароль открытым текстом.

FTP (File Transfer Protocol) — протокол передачи файлов. FTP придумали в 1971 году, еще до того, как появились протоколы TCP/IP. Сначала FTP работал поверх протокола NCP. Версия на основе TCP/IP появилась в 1980 году. А в 1985 году была принята спецификация FTP, которой пользуются до сих пор, позже в неё были добавлены полезные расширения, такие как, пассивный режим и поддержка IPv6.

_Место протокола FTP в стеке TCP/IP В стеке TCP/IP протокол находится на прикладном уровне._

Протокол FTP работает в режиме клиент сервер. На сервере есть файловая система, это структура каталогов в которой находятся файлы. Клиент по протоколу FTP подключается к серверу и может работать с файловой системой, просматривать каталоги, переходить между ними, загружать и записывать файлы сервера, перемещать их между разными каталогами и выполнять другие операции, которые можно делать с файловой системой.

**Протокол FTP, также как и HTTP для адресации файлов использует url.**


**URL состоит из 3-х частей:**

- первая часть ftp — идентификатор протокола;
- вторая часть [ftp-server.ru](http://ftp-server.ru/) — имя сервера, здесь может быть DNS имя либо IP адрес;
- третья часть pub/documents/latex/example1.tex — путь к файлу, файловой системе и само имя файла.


_В отличии от других протоколов прикладного уровня, протокол FTP использует два отдельных соединения. Первое соединение управляющее, второе соединение для передачи данных._

FTP использует протокол транспортного уровня TCP, а для управляющего соединения на сервере используется порт 21. Соединение для данных может быть установлено в двух режимах: в активном и пассивном, при этом используются разные номера портов.

В активном режиме FTP инициатором установки соединения для передачи данных является сервер. В этом случае используется порт 20 на сервере, а со стороны клиента порт больше 1024.

Однако, если между сервером и клиентом находится межсетевой экран или устройство трансляции сетевых адресов NAT, то сервер установить соединение с клиентом не сможет. В этом случае используется пассивный режим, при котором соединение для передачи данных устанавливает клиент. В пассивном режиме и на клиенте и на сервере используются порты с номерами больше, чем 1024.

Команды:
- Команды USER и PASS используются для аутентификации;
- LIST позволяет посмотреть содержимое текущего каталога;
- CWD поменять текущий каталог;
- RETR позволяет загрузить файл с сервера на клиент;
- STOR позволяет сохранить файл на сервере;
- Протокол FTP может передавать данные в двух режимах, текстовом и бинарном. В текстовом режиме возможна отправка управляющих символов, которые будут обработаны специальным образом. В бинарном режиме, обработка специальных символов не производится. Для выбора режима, который будет использоваться для передачи файлов, служит команда TYPE;
- DELE позволяет удалить файлы;
- Команды MKD и RMD используются для создания и удаления каталога;
- По умолчанию FTP сервер работает в активном режиме, т.е. соединение для передачи данных устанавливает сервер. Команда PASV служит для перехода в пассивный режим;
- Команда QUIT используется для корректного закрытия соединения FTP после того, как все необходимые операции с файлами и каталогами были завершены.




Установка: `sudo apt install vsftpd`

**заходим в конфигурационный файл**

[https://jakondo.ru/fajl-konfiguratsii-vsftpd-conf/](https://jakondo.ru/fajl-konfiguratsii-vsftpd-conf/) - подробное описание конфигурационного файла

```
sudo nano /etc/vsftpd.conf
```

- listen=NO

Если опция включена сервер стартует в независимом от inetd/xinetd режиме "standalone mode". В этом случае он сам заботится о прослушивании и определении входящих соединений. Default: NO

- listen_ipv6

Тоже самое что listen, за исключением того что vsftpd слушает IPv6 протокол включительно. Этот параметр и listen взаимно исключаемые. Default: NO

- anonymous_enable

Разрешает или запрещает вход анонимных пользователей. Если разрешено, пользователи с именами ftp и anonymous распознаются как анонимные пользователи. Default: YES

**Например:**

[https://ftp.dlink.ru/pub/](https://ftp.dlink.ru/pub/)

мы когда подключаемся мы анонимны для этого сайта

- local_enable

Разрешить анонимный вход под локальными логинами или нет? Если включено, то для авторизации могут использоваться обычные нормальные учётные записи пользователей из «/etc/passwd» (или оттуда, куда ссылается ваша настройка PAM). Это должно быть включено для того, чтобы работал любой НЕ «anonymous» логин, включая и виртуальных пользователей. По-умолчанию: NO

- dirmessage_enable

Если включено, то пользователям FTP-сервера можно показывать сообщения, когда они переходят в каталог. По-умолчанию каталог сканируется на наличие файла «.message», но вы можете указать другой файл, изменив расположение в значении параметра «message_file». По-умолчанию: NO (но демонстрационный файл настроек содержит YES)

- use_localtime

Если параметр установлен в «YES», то vsftpd будет отображать время в вашей локальной временной зоне в списке содержимого в каталоге. По-умолчанию отображается GMT. Этот параметр может затронуть также время, возвращаемое FTP-командой «MDTM». По-умолчанию: NO

- xferlog_enable

Если параметр установлен в «YES», то лог-файл будет содержать детальную информацию о загрузках на vsftpd и закачках с vsftpd. По-умолчанию, этот файл находится в «/var/log/vsftpd.log», но путь к файлу может быть изменён установкой значения параметра «vsftpd_log_file». По-умолчанию: NO

- connect_from_port_20

Включение этого параметра указывает исходящим с сервера соединениям использовать 20 порт (ftp-data). По соображением безопасности, некоторые клиенты могут настаивать на таком случае (чтобы параметр был установлен в YES). Наоборот, отключение этого параметра позволяет vsftpd запускаться с меньшими привилегиями. По-умолчанию: NO (но демонстрационный файл настроек содержит YES)

- secure_chroot_dir

Параметр должен содержать имя пустого каталога. Так же этот каталог не должен быть доступен для записи ftp-пользователем. Каталог используется безопасной клеткой chroot() во время, когда vsftpd не требует доступ к файловой системе. По-умолчанию: /usr/share/empty

- rsa_cert_file

Параметр содержит путь в файловой системе до сертификата RSA для использования в шифрованных SSL-соединениях. По-умолчанию: /usr/share/ssl/certs/vsftpd.pem


Перезапускаем службу




и теперь открываем браузер в Kali и вбиваем [](ftp://192.168.1.80/)[ftp://192.168.1.80](ftp://192.168.1.80)_вводим логин вводи пароль_

что-бы увидеть всю файловую систему на сервисе необходимо в файле конфигурации снять комментарий и изменить YES на NO

`chroot_local_user=YES`

[https://jakondo.ru/fajl-konfiguratsii-vsftpd-conf/](https://jakondo.ru/fajl-konfiguratsii-vsftpd-conf/) - подробное описание конфигурационного файла

**есть программа, которая здорово облегчет жизнь именно с работой FTP**

это _file zilla_[https://filezilla.ru/get/](https://filezilla.ru/get/)

**Как можно продемонстрировать, что сервис ftp не шифруется**

_запускаем Wireshark_

_и запускаем FileZilla на Windows подключаемся к нашей kali и видим следующее:_



**Видим пароль, который мы вводили.**

_Таким образом можно перехватить трафик FTP._
