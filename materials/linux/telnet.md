# TELNET

**TELNET** - это сетевой протокол, который обеспечивает двунаправленный восьмибитный канал передачи данных для создания стандартного метода взаимодействия терминальных устройств и терминал-ориентированных процессов через сеть.

telnet использует TCP-соединение для передачи данных вперемешку с управляющей информацией протокола. В принципе, для работы протокола передавать какую-либо управляющую информацию не обязательно. Таким образом, протокол может использоваться для соединения с любым сервисом, использующим TCP в качестве транспортного протокола, и обмену данными между участниками соединения.

Протокол telnet использовался для удалённого администрирования различными сетевыми устройствами и программными серверами, но уступил ssh из-за безопасности. Тем не менее может являться единственной возможностью взаимодействовать через cli с embedded systems, например, router, т.к. на них отсутствует ssh.

telnet можно использовать для проверки доступности хоста (в случае, если идеология по той или иной причине презирает утилиту ping).

Протокол telnet находится на сеансовом уровне модели OSI/ISO. Для обеспечения удаленного доступа к терминалу сервера стандартом резервируется порт 23. Основу протокола составляют три базовые концепции:

1. Концепция "Сетевого Виртуального Терминала"

**Сетевой виртуальный терминал, Network Virtual Terminal, NVT**

Когда устанавливается соединение, предполагается, что оно начинается и завершается на "Сетевом Виртуальном Терминале" (Network Virtual Terminal, NVT). NVT - это воображаемое устройство, которое создает промежуточное стандартное представление канонического терминала. NVT является стандартным описанием наиболее широко используемых возможностей реальных физических терминальных устройств. NVT позволяет описать и преобразовать в стандартную форму способы отображения и ввода информации.

Терминальная программа и работающий с ней процесс преобразовывают характеристики физических устройств в спецификацию **NVT**, что позволяет, с одной стороны, унифицировать характеристики физических устройств, а с другой обеспечить совместимость устройств с различными возможностями.

Характеристики диалога определяются устройством с меньшими возможностями. В результате, "пользовательскому" и "серверному" узлам не нужно хранить информацию о характеристиках терминалов друг друга. Все узлы отображают характеристики своих устройств так, чтобы другой стороне казалось, что она имеет дело с NVT. Обычно, под "пользовательским" понимают узел, к которому подключен реальный терминал, а под "серверным" - который предоставляет некоторый сервис. Можно считать "пользовательским" тот узел, который инициирует соединение.

2. Принцип согласования параметров

**Option negotiation**

NVT - это минимально необходимый набор параметров, который позволяет работать даже самым примитивным устройствам. Реальные современные устройства обладают гораздо большими возможностями представления информации. Принцип согласования параметров позволяет использовать эти возможности. Например, NVT является терминалом, который не может использовать функции управления курсором, а реальный терминал, с которого осуществляется работа, возможно умеет это делать. Используя согласование параметров, терминальная программа предлагает обслуживающему процессу использовать управляющие последовательности для управления выводом информации. Получив такую команду процесс начинает вставлять управляющие последовательности в данные, предназначенные для отображения.

Протокол предлагает структуру дополнительных параметров "DO, DON'T, WILL, WON'T", позволяющую пользователю и серверу более точно договориться об используемых в соединении соглашениях.

Команда **WILL** XXX указывает на предложение отправляющей стороны использовать параметр XXX. **DO** XXX и **DON'T** XXX являются, соответственно, положительным и отрицательным ответом. Аналогично, **DO** XXX посылается как предложение получающей стороне использовать параметр XXX**. WILL** XXX и **WON'T** XXX суть положительный и отрицательный ответы. Так как **NVT** это то, что остается, когда никакие параметры не используются, ответы **DON'T** и **WON'T** гарантируют, что соединение останется в состоянии, которое подходит обеим сторонам. В отличие от других протоков сеансового уровня, таких как **FTP** или **SMTP**, команды передаются не английскими словами (или их сокращениями), а в виде восьмибитных последовательностей (байтов).

Так, команде **DO** соответствует байт 253, **WON'T** - 252, и т.д.

Установка определенного параметра происходит так: один из участников соединения посылает другому запрос, предлагая использовать в сеансе работы определенный параметр. Если другая сторона соглашается, параметр немедленно вступает в силу. Если приходит отказ, используется то значение параметра, которое определяется для **NVT**. Обычно параметры согласуются вначале при установке соединения, хотя при работе одна из сторон может вновь изменить какие-либо параметры.

3. Симметрия терминалов и процессов

Симметрия терминалов и процессов отражает тот факт, что все управляющие команды протокола могут даваться любой стороной, участвующей в соединении. Разделения на "клиент" и "сервер" здесь нет.


```bash
apt-get install telnetd
```
- Установка сервера telnet.

```bash
telnet -d ip 23
```
- Подключение к серверу.

```bash
apt install telnet
```
- Установка telnet.

```html
telnet опции хост порт
```
- Синтаксис telnet.
- Хост - это домен удаленного компьютера, к которому следует подключиться, а порт - порт на этом компьютере.

**Основные флаги**

- **4** - принудительно использовать адреса ipv4;
- **6** - принудительно использовать адреса ipv6;
- **8** - использовать 8-битную кодировку, например, Unicode;
- **E** - отключить поддержку Escape последовательностей;
- **a** - автоматический вход, берет имя пользователя из переменной окружения USER;
- **b** - использовать локальный сокет;
- **d** - включить режим отладки;
- **р** - режим эмуляции rlogin;
- **e** - задать символ начала Escape последовательности;
- **l** - пользователь для авторизации на удаленной машине.

После установки подключения telnet может работать в двух режимах:

- **Построчный** - это предпочтительный режим, здесь строка текста редактируется на локальном компьютере и отправляется только тогда, когда она будет полностью готова. На такая возможность есть не всегда и не у всех сервисов;
- **Посимвольный** - все набираемые вами символы отправляются на удаленный сервер. Тут будет сложно что-либо исправить, если вы допустили ошибку, потому что Backspace тоже будет отправляться в виде символа и стрелки движения тоже.

Использование telnet заключается в передаче специальных команд. У каждого сервиса свои команды, но у протокола есть свои команды telnet, которые можно применять в консоли telnet.

- **CLOSE** - закрыть соединение с сервером;
- **ENCRYPT** - шифровать все передаваемые данные;
- **LOGOUT** - выйти и закрыть соединение;
- **MODE** - переключить режим, со строчного на символьный или с символьного на строчный;
- **STATUS** - посмотреть статус соединения;
- **SEND** - отправить один из специальных символов telnet;
- **SET** - установить значение параметра;
- **OPEN** - установить подключение через telnet с удаленным узлом;
- **DISPLAY** - отобразить используемые спецсимволы;
- **SLC** - изменить используемые спецсимволы.

## Консоль telnet

Использование консоли telnet тоже важный момент в разборе как пользоваться telnet. В основном режиме вы можете выполнять команды, на удаленном сервере, если же вы хотите адресовать команду именно telnet, например, для настройки ее работы, необходимо использовать спецсимвол для открытия консоли, обычно утилита сразу говорит вам что это за символ. По умолчанию используется символ, соответсвующий очетанию клавиш `Ctrl+[`.

Чтобы посмотреть все доступные команды, вы можете набрать `?`.

Не рекомендуется использовать небезопасный telnet для удаленного управления, потому что все команды и пароли могут быть прослушаны сторонним пользователем. Но иногда, например, для роутеров, telnet все же используется для удаленного управления.

```bash
telnet localhost 23
```
- Подключение к серверу, на котором установлен telnet-server на 23 порту.
- Далее, нужно ввести логин и пароль, а затем можно выполнять команды в удаленной системе.
