# PASSWD


Пароли пользователей хранятся в отдельном файле `/etc/shadow`.

**passwd** - это утилиты для смены пароля. Она позволяет не только менять пароль, но и управлять сроком его жизни.

**ФЛАГИ**

- **d** - удалить пароль пользователя, после этого он не сможет войти
- **e** - сделать пароль устаревшим
- **i** - через сколько дней после того, как пароль устарел, отключить аккаунт, если пользователь не сменил пароль
- **l** - запретить пользователю входить в систему
- **n** - минимальное количество дней между сменами пароля
- **S** - отобразить информацию об аккаунте
- **u** - отменяет действие параметра **l**
- **x** - максимальное количество дней, пока пароль можно использовать
- **w** - количество дней, после которых нужно предупреждать пользователя о том, что надо сменить пароль.

```bash
passwd
```
- Сменить пароль текущего пользователя. Пароль кодируется с помощью необратимого шифрования и сохраняется в файле `/etc/shadow`.

Общие требования для пароля такие: должен содержать от 6 до 8 символов, причём один или несколько из них должны относиться как минимум к двум из таких множеств:

- Буквы нижнего регистра
- Буквы верхнего регистра
- Цифры от нуля до девяти
- Знаки препинания и знак

```bash
sudo passwd -d user
```
- Удалить пароль для пользователя.

Файл `/etc/gshadow` содержит пароли для групп. Нельзя войти от имени группы, но, зная ее пароль, можно получить доступ к предоставляемым ею функциям в отдельной командной оболочке с помощью команды **newgrp**. Для установки пароля на группу используется **gpasswd**.

```bash
sudo gpasswd disk
```
- Смена пароля группы.

```bash
passwd -S user
```
- Вывод информации о пароле.
- Первое поле: имя пользователя.
- Второе поле: **P** - пароль установлен, **L** - пользователь заблокирован, **NP** - пароля нет.
- Третье поле: дата последнего изменения пароля.
- Четвертое поле: минимальное время до смены пароля
- Пятое поле:  максимальное время действия пароля
- Шестое поле:  за сколько дней нужно предупреждать об истечении срока действия пароля
- Седьмое поле:  через сколько дней пароль нужно деактивировать.

```bash
sudo passwd -x 30 user
```
- Назначить пароль пользователя устаревшим через 30 дней.

## /etc/passwd

/etc/passwd - это текстовая БД, которая содержит информацию обо всех учетных записях пользователей в системе. Она принадлежит пользователю root и имеет разрешение 644. Файл может быть изменен только пользователем root или пользователями с правами sudo и доступен для чтения всем пользователям системы. Обычно первая строка описывает пользователя root, за которым следуют системные и обычные учетные записи пользователей. Новые записи добавляются в конец файла.

Каждая строка файла /etc/passwd содержит семь полей:

1. Username. Строка, которую вы вводите при входе в систему. Каждое имя пользователя должно быть уникальной строкой на компьютере. Максимальная длина имени пользователя ограничена 32 символами.
2. Password. В старых системах Linux зашифрованный пароль пользователя хранился в файле /etc/passwd. В большинстве современных систем это поле имеет значение x, и пароль пользователя сохраняется в файле /etc/shadow.
3. UID. Идентификатор пользователя - это номер, назначенный каждому пользователю. Он используется операционной системой для обращения к пользователю.
4. GID. Номер идентификатора группы пользователя, относящийся к основной группе пользователя. Когда пользователь создает файл, группа файла устанавливается на эту группу. Как правило, имя группы совпадает с именем пользователя. Пользователя вторичные группы перечислены в файле /etc/groups.
5. GECOS или полное имя пользователя. Это поле содержит список значений через запятую со следующей информацией: Полное имя пользователя или название приложения, Номер комнаты, Рабочий номер телефона, Домашний телефон, Другая контактная информация.
6. Home directory. Абсолютный путь к домашнему каталогу пользователя. Он содержит файлы пользователя и конфигурации. По умолчанию домашние каталоги пользователей именуются по имени пользователя и создаются в каталоге /home.
7. Login shell. Абсолютный путь к оболочке входа пользователя. Это оболочка, которая запускается, когда пользователь входит в систему. В большинстве дистрибутивов Linux оболочкой входа по умолчанию является Bash.

## /etc/shadow

/etc/shadow - это зашифрованный файл паролей, в котором хранится зашифрованная информация о паролях для учетных записей пользователей В дополнение к этому файл /etc/shadow хранит дополнительную информацию о сроке действия пароля.

Появление теневого файла (shadow) произошло из-за необходимости отделить зашифрованные пароли от файла `/etc/passwd`. Это было необходимо, потому что легкость, с которой можно было взломать зашифрованные пароли, росла с увеличением вычислительной мощности обычных компьютеров (домашних ПК). Идея заключалась в том, чтобы сделать файл **/etc/passwd** доступным для чтения всем пользователям, не сохраняя в нем зашифрованные пароли, а затем сделать **/etc/shadow** файл доступным для чтения только root или другим привилегированным программам, которым требуется доступ к этой информации. Примером такой программы может быть программа входа в _систему_.

Строки состоят из различных стандартных полей, каждое из которых разделено двоеточием:

1. Логин
2. Зашифрованный пароль
3. Количество дней, прошедших с 1 января 1970 г., когда последний раз меняли этот пароль.
4. Дней до того, как пароль может быть изменен
5. Кол-во дней, по истечении которых пароль необходимо изменить
6. За сколько дней до истечения срока действия пароля пользователь получает предупреждение
7. Через сколько дней после истечения срока действия пароля эта учетная запись будет отключена
8. Дней с 1 января 1970 г., когда эта учетная запись была отключена
9. Зарезервированное поле


Зашифрованный пароль соответсвует формату `$type$salt$hashed`. где `$type` является методом криптографического алгоритма хеширования и может иметь следующие значения:

- `$1$` - MD5
- `$2a$` - Blowfish
- `$2y$` - Eksblowfish
- `$5$` - SHA-256
- `$6$` - SHA-512

Если поле пароля содержит звездочку или восклицательный знак, пользователь не сможет войти в систему с использованием аутентификации по паролю. Другие методы входа, такие как аутентификация на основе ключей или переключение на пользователя, по-прежнему разрешены.
