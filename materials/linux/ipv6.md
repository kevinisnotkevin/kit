# IPv6 Linux

# 1 Как узнать IPv6 адрес сайта

```bash
nslookup domain
```
- Узнать IPv6 адрес сайта на WIndows/Linux. Если у сайта есть IPv6 адрес, то он будет выведен вместе с IP адресами
```bash
host yandex.ru
```
- Способ узнать IPv6 адрес
```bash
dig +short yandex.ru AAAA
```
- Команда dig также умеет показывать IPv6 адреса, но по умолчанию выводит данные только для A записи, поэтому нужно указать вид записи явно

# 2 Как открыть IPv6 в веб-браузере

Для использования IPv6 адреса в URL его достаточно поместить в квадратные скобки: `https://[2604:a880:800:c1::2ae:d001]/`

# 3 Как в IPv6 посмотреть ARP таблицу. Показ соседей в IPv6

```bash
ip -6 neigh show
```

```bash
traceroute -6 ya.ru
```

# 4 Как настроить свою систему на работу с DNS по IPv6

Даже если ваш компьютер подключён к IPv6 сети, то, скорее всего, в качестве DNS серверов указаны IP четвёртой версии. Если вы хотите, чтобы DNS запросы также делались по протоколу IPv6, то в дополнение к имеющимся записям добавьте также IPv6 адреса DNS серверов.

Для DNS Google это адреса:
- 2001:4860:4860::8888
- 2001:4860:4860::8844

```bash
nameserver 2001:4860:4860::8888
nameserver 2001:4860:4860::8844
```
- Добавление к имеющимся записям IPv6-адресов DNS-серверов в файле /etc/resolv.conf. После этого DNS запросы будут отправляться через IPv6 протокол.

# 5 Как посчитать сколько IPv6 адресов в подсети

Прежде чем перейти к примерам сканирования IPv6 подсетей, давайте научимся считать, сколько именно в заданной подсети IPv6 адресов.

Предположим, дана IPv6 сеть: 2604:A880::/32, сколько в этой сети IPv6 адресов?
Считаем: 2(128-32) = 7,922816251×1028

Начинать сканирование таких сетей бессмысленно - сканирование не завершится никогда.

Программа nmap поддерживает работу с IPv6 адресами и может сканировать диапазоны IPv6, хотя есть некоторые ограничения: поддерживаются не все виды нотаций, которые доступны для обычных IP.

Предположим, я хочу просканировать свою локальную IPv6 сеть к которой принадлежит мой адрес `inet6 fe80::20c:29ff:fee9:3242/64`. В этот же момент моему сетевому интерфейсу присвоен IPv6 адрес `inet6 fe80::20c:29ff:fee9:3242/64`.

```bash
sudo nmap -6 fe80::20c:29ff:fee9:3242/120
```
- Сканирование локальной IPv6 сети. Подсеть /64 слишком большая. Поэтому просканируем подсеть /120, в которой 2(128-120) = 256 адресов

На самом деле, если копнуть глубже и внимательнее присмотреться к протоколу IPv6, то мы узнаем, что клиентам выделяются очень крупные подсети, а так много адресов нужно из-за особенностей маршрутизации IPv6. Может оказаться, что клиенты собраны в начале крупных диапазонов и нет смысла сканировать весь большой диапазон IPv6 адресов целиком — достаточно разбить цели сканирования на такие же подсети, которые выделяет Интернет-провайдер клиентам и сканировать только самое начало каждого такого диапазона. В результате время сканирования должно уменьшиться. В сканировании IPv6 сетей есть простор для оптимизации, но это требует понимание топологии конкретной сети и глубокое понимание протокола IPv6 и его маршрутизации.

Все опции и возможности nmap поддерживаются также и для IPv6 адресов.

# 6 Показ IPv6 маршрутов в локальной системе

```bash
# Вывод списка IPv6 маршрутов
ip -6 route show
# Сокращение той же команды
ip -6 ro
# Показать маршрут по умолчанию IPv6
ip -6 route show default
```

# 7 Как посмотреть настройки IPv6

Выше показано, как узнать свой IPv6 адрес и IPv6 маршруты, но кроме этих настроек в системе имеется множество других опций IPv6 для тонкой конфигурации и включения или отключения определённых функций IPv6.

```bash
sysctl -a | grep ipv6
```
- Просмотр текущих настроек IPv6

# 8 Как отключить и включить IPv6

```bash
sudo sysctl -w net.ipv6.conf.all.disable_ipv6=1

sudo sysctl -w net.ipv6.conf.default.disable_ipv6=1
```
- Отключение IPv6. Данные настройки действуют до следующей перезагрузки компьютера
```bash
sudo -i

echo 'net.ipv6.conf.all.disable_ipv6=1' >> /etc/sysctl.d/sysctl.conf

echo 'net.ipv6.conf.default.disable_ipv6=1' >> /etc/sysctl.d/sysctl.conf

```
- Сделать настройки постоянными
```bash
sysctl -p
```
- Активировать изменения

```bash
sysctl -n net.ipv6.conf.all.disable_ipv6

sysctl -n net.ipv6.conf.default.disable_ipv6
```
- Проверить статус IPv6 на уровне ОС

# 9 Ping между двумя linux машинками по ipv6 выполняется следующим образом

```bash
ping -6 ipv6
```

# 10 Как настроить SSH для работы только с IPv6

```
ListenAddress 0.0.0.0
ListenAddress ::
```
- В системе может быть несколько сетевых интерфейсов с несколькими IP адресами, по умолчанию sshd прослушивает их все, в том числе IPv6 адреса. Если убрать запись ListenAddress 0.0.0.0, то будут прослушиваться только IPv6
```bash
AddressFamily any
```
- Директивой ListenAddress также можно указать конкретный IP, который будет прослушиваться в ожидании подключений. А опцией AddressFamily можно выбрать для прослушивания все адреса, только IPv4 или только IPv6.

Варианты:
- any (по умолчанию — любые адреса),
- inet (использовать только IPv4),
- inet6 (использовать только IPv6),

**Для чего нужно ограничивать прослушиваемые адреса только протоколом IPv6?**

Многие автоматические сканеры по умолчанию сканируют порты только для IPv4 адресов, полностью игнорируя IPv6. До сих пор довольно много пользователей, в том числе и хакеров, у которых нет доступа к IPv6. Если же у вашего Интернет-провайдера имеется поддержка IPv6, то перейдя на SSH с протоколом IPv6 вы значительно ограничите доступ к вашему SSH серверу для автоматических сканеров и резко сократите количество попыток взлома брут-форсом.

**Атака человек-посередине на IPv6?**

Классический ARP спуфинг не работает для IPv6 протокола, поскольку в нём используется другой протокол. Тем не менее имеются схожие атаки Neighbor Advertisement Spoofing, Last Hop Router.

IPv4 и IPv6 — это отдельные протоколы, поэтому атака одного напрямую не влияет на другой. Тем не менее методы для спуфинга NA и ARP очень похожи. Если у вас есть возможность сделать одно, вы наверняка могли бы сделать другое.
