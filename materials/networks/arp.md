# ARP

Одним из важнейших протоколов в современных локальных сетях является ARP - Address Resolution Protocol. Это протокол, в компьютерных сетях, предназначенный для определения МАС-адреса другого компьютера по известному IP-адресу. Он преобразует логический адрес(IP) в физический адрес (MAC) и сохраняет результаты в кэше ARP хоста.

ARP (Address Resolution Protocol, протокол определения адреса) - протокол для определения соответствия между логическим адресом сетевого уровня (IP) и физическим адресом устройства (MAC). ARP был спроектирован для передачи IP-пакетов через пакеты (кадры) Ethernet.

ARP работает на уровнях 2 и 3 модели OSI.

Каждое устройство уровня 3 использует ARP.

Размер кэша ARP специально ограничен, и адреса, как правило, остаются в кэше всего несколько минут. Он регулярно очищается, чтобы освободить пространство. Эта разработка также предназначена для обеспечения конфиденциальности и безопасности, чтобы предотвратить кражу или подделку IP-адресов кибератаки. В то время как MAC-адреса фиксированы, IP-адреса постоянно изменяются.

В процессе очистки неиспользуемые адреса удаляются; также удаляются любые данные, связанные с неудачными попытками связи с компьютерами, не подключенными к сети или даже не включенными.

Broadcast адрес (Широковещательный адрес) - условный (не присвоенный никакому устройству в сети) адрес, который используется для передачи широковещательных пакетов в компьютерных сетях. На уровне L2 используется широковещательный MAC-адрес FF:FF:FF:FF:FF:FF для передачи служебных датаграмм (например, ARP-запросов). Датаграммы, отправленные на такой адрес, принимаются всеми сетевыми устройствами локальной сети.

Broadcast ARP (когда устройство подключается в сети, оно посылает запрос всем устройствам в сети, чтобы они записали его адрес в свои ARP таблички).

Когда приходит ответ на ARP запрос данные записываются на коммутатор или любое другое сетевое устройство, в его ARP таблицу, в которой есть три столбца: Host | MAC адрес | IP.



- __ARP (Address Resolution Protocol)__ – протокол определения адреса, который сопоставляет 64-битные MAC-адреса с 32-битными IP-адресами и наоборот, обеспечивая инкапсуляцию и декапсуляцию данных. Компьютеры записывают информацию о найденных MAC-адресах в кэш, чтобы не запрашивать MAC-адрес при каждом отправлении.

# Принцип работы

- Узел, которому нужно выполнить отображение IP-адреса на аппаратный адрес, формирует запрос ARP с IP-адресом получателя, вкладывает его в кадр протокола канального уровня и рассылает его широковещательно;
- Все узлы сегмента локальной сети получают запрос ARP и сравнивают полученный IP-адрес с собственным;
- В случае совпадения, узел формирует ответ ARP, в котором указывает свой IP-адрес и MAC-адрес и отправляет ответ отправителю запроса.

# Проблемы безопасности

Злоумышленник отправляет ARP сообщения, чтобы связать свой MAC-адрес с IP-адресом целевого устройства, что приводит к MITM. Для предотвращения такой атаки реализуют статические записи ARP, динамические проверки ARP, обеспечение обновления сетевых устройств.

# ARP запрос

ARP работает следующим образом:

Шаг 1. Хост А отправляет ARP запрос всем хостам в сети с IP-адресом хоста В, генерируя широковещательный запрос

Шаг 2 Хост В распознаёт IP-адрес в запросе. Он выполняет ARP-ответ, в котором честно указывает свой MAC-адрес. Другие же хосты, например, хост C проигнорирует полученный трафик, т.к. его IP-адрес не совпадает с IP-адресом в запросе

Шаг 3. Хост А получает ARP-ответ и сохраняет МАС-адрес хоста В в кэше ARP вместе с соответствующим IP-адресом хоста В

# ARP таблица

Благодаря такому взаимодействию на нашем компьютере создается ARP таблица, которая содержит все ответы, полученные от других устройств в сети. Таблица представлена в виде простого сопоставления ip адреса и mac адреса.

Arp –a, arp –g отображают ARP-таблицу хоста

Таблица или кэш ARP хранится в оперативной памяти устройства. ARP содержит три параметра:

- IP-адрес целевого хоста
- Соответствующий MAC-адрес этого хоста
- Как определяется входной МАС-адрес источника: статически или динамически. Статические добавляются администратором, динамические же – создаются и удаляются автоматически. При этом в ARP-таблице всегда хранится широковещательный физический адрес FF:FF:FF:FF:FF:FF
