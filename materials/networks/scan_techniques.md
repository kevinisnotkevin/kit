
# Техники сканирования сети

## Инстурменты для сканирования

Существует огромное количество утилит для сканирования сети. Обозначим некоторые из них:

- Ping

**Ping** — утилита для проверки целостности и качества соединений в сетях на основе TCP/IP, а также обиходное наименование самого запроса.

Утилита отправляет запросы (ICMP Echo-Request) протокола ICMP указанному узлу сети и фиксирует поступающие ответы (ICMP Echo-Reply). Время между отправкой запроса и получением ответа позволяет определять двусторонние задержки по маршруту и частоту потери пакетов, то есть косвенно определять загруженность на каналах передачи данных и промежуточных устройствах.

- Arpping

**arping** — утилита для обнаружения хостов в компьютерной сети.

Функционирует аналогично утилите _ping_, но, в отличие от неё, посылает/получает не ICMP-запросы/ответы, а ARP-запросы/ответы. Т.к. ARP-пакеты являются широковещательными и не проходят сквозь маршрутизаторы, утилиту arping можно использовать только внутри L2-доменов.

Основные опции, доступные при инициализации утилиты:

- А — использовать при отправке ARP-пакета ARP-ответ (ARP REPLY) вместо ARP-запроса (ARP REQUEST).
- b — отправка широковещательных пакетов на уровне MAC.
- с — указание количества запросов адресату, после которых рассылка должна быть остановлена.
- I — наименование сетевого интерфейса, через который будут отправлены ARP-пакеты.

- Arp-scan

Это ARP сканнер.

arp-scan — это инструмент командной строки для обнаружения и снятия отпечатков. Он создает и отправляет ARP запросы указанным IP адресам и отображает полученные ответы.

arp-scan позволяет вам:

- Отправлять ARP-пакеты на любое количество хостов-получателей, используя настраиваемую пропускную способность или скорость передачи.

Это полезно для обнаружения устройств, когда вам может потребоваться сканировать большие адресные пространства.

- Гибким способом конструировать исходящий ARP пакет.

arp-scan предоставляет управление всеми полями пакета ARP и полями в заголовке Ethernet кадра.

- Декодировать и отображать любые возвращённые пакеты.

arp-scan будет декодировать и отображать любые принятые ARP-пакеты и искать поставщика, используя MAC-адрес.

- Снимать отпечатки IP хостов, используя инструмент arp-fingerprint.
- Nmap

**nmap** — утилита, предназначенная для разнообразного настраиваемого сканирования IP-сетей с любым количеством объектов, определения состояния объектов сканируемой сети. Изначально программа была реализована для систем UNIX, но сейчас доступны версии для множества операционных систем.

- Masscan

MASSCAN — это массовый сканер IP портов. Это самый быстрый сканер портов Интернета. Отправляя 10 миллионов пакетов в секунду, он может сканировать весь интернет за 6 минут. Этот инструмент полезен для обзора сетей большого масштаба — таких как Интернет или внутренние сети. Хотя скорость по умолчанию ограничена 100 пакетами в секунду, программа может разгоняться до 25 миллионов пакетов в секунду, при такой скорости весь (по одному порту на IP) Интернет будет просканирован за 3 минуты.

Он создаёт результат схожий с nmap, самым знаменитым сканером портов. Внутри он работает используя асинхронную передачу. Он быстрее этих сканеров. Дополнительно, он более гибкий, позволяет произвольные диапазоны адресов и портов.

- Nbtscan

Это инструмент командной строки, который сканирует NETBIOS в локальной или удалённой TCP/IP сети, это первый шаг по поиску открытых совместных ресурсов. Также утилита определяет имя компьютера и имя рабочей группы (или домена) и собирает информацию о запущенных на компьютере службах. Инструмент основывается на функциональности стандартного инструмента Windows **nbtstat**, но он может работать не только с одним адресом, но и по диапазону адресов.

Инструмент имеет версию для Windows и Linux.

Версия Win32 работает на ОС Windows начиная с Windows 9x, NT и 2000 и более поздних версиях, доступна ниже как nbtscan.exe. Она написан на переносимом C и занимает менее 40 кбайт, не требует специальных библиотек или DLL и запускается в командном окне MS-DOS.

## Методы обнаружения хостов в сети

Первый вид сканирования - ping-сканирование. Основная задача - обнаружить «живые» узлы в сети. Под ping-сканированием понимают широковещательную рассылку пакетов ICMP. Сканер рассылает пакеты типа Echo REQUEST по указанным IP-адресам и ожидает в ответ пакеты типа Echo REPLY. Если ответ получен, считается, что узел присутствует в сети по указанному IP-адресу.

ARP сканирование. Эта техника похожа на ping-сканирование, но вместо протокола ping используется arp. В сеть рассылаются широковещательные запросы по всем искомым ip адресам, и если устройство ответило – значит, работает. Так как протокол arp нельзя отключить без последствия для устройства, это сканирование довольно эффективно, но действует только в рамках подсети, в которой находится злоумышленник. В добавок такое сканирование легко обнаружить.

Более продвинутая тактика сканирования - сканирование портов. Сканирование этими методами определяет доступные порты на узлах, а затем на основе полученных данных делается предположение о типе используемой операционной системы или конкретного приложения, запущенного на конечном узле. Под сканированием портов понимают пробные попытки подключения к внешним узлам.

Методы сканирования портов:

Наиболее часто используется метод TCP SYN. Его называют сканированием с установкой полуоткрытого соединения, так как соединение не устанавливается до конца. На исследуемый порт посылается сообщение SYN, затем идет ожидание ответа, на основании которого определяется статус порта. Ответы SYN/ACK говорят о том, что порт прослушивается, а ответ RST говорит о том, что порт не прослушивается.

Метод TCP CONNECT менее популярен, чем TCP SYN. При реализации метода TCP CONNECT производится попытка установить соединение по протоколу TCP к нужному порту с процедурой handshake. Процедура заключается в обмене сообщениями для согласования параметров соединения, то есть служебными сообщениями SYN, SYN/ACK, ACK, между узлами. Соединение устанавливается на уровне операционной системы, поэтому существует шанс, что оно будет заблокировано средством защиты и попадет в журнал событий.

UDP-сканирование медленнее и сложнее, чем TCP-сканирование. Время сканирования всего диапазона UDP портов по одному ip адресу может занимать чуть ли не сутки.

Для определения статуса порта посылается пустой UDP-заголовок, и если в ответ приходит ошибка достижимости ICMP Destination Unreachable с кодом Destination port unreachable, это значит, что порт закрыт; другие ошибки достижимости ICMP означают, что порт фильтруется. Если порт отвечает UDP-пакетом, значит, он открыт. Из-за специфики UDP и потери пакетов запросы повторяются несколько раз.
