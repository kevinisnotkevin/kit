# MAC-адрес

**MAC-адрес (Физический адрес)** - это уникальный идентификатор сетевого интерфейса в локальной сети. Одно устройство (компьютер, роутер) может иметь несколько сетевых интерфейсов (проводных и беспроводных) и, следовательно, иметь несколько MAC-адресов.

Физический адрес состоит из 6 байт. Его принято выражать в шестнадцатеричной системе счисления. Значение каждого байта отделяют дефисом или двоеточием для того, чтобы адрес легко воспринимался визуально. MAC-адрес состоит из шести пар символов (их называют октетами). В эти символы входят все цифры и буквы от A до F (набор символов шестнадцатеричной записи).

- `00:00:00:00:00:00`
- `000000000000`
- `00-00-00-00-00-00`

Первые три октета (бита) содержат уникальный идентификатор организации (OUI) или код MFG (Manufacturing, производителя), который производитель получает в IEEE. Они уникальны для каждого производителя сетевых устройств и каждый производитель, присваивая MAC-адрес своему сетевому устройству, начинает его со своих трёх октетов. Именно по ним, зная MAC-адрес, можно определить производителя. 

Последние три октета производитель присваивает произвольно и, в отличии от первых трёх, они должны быть уникальны для каждого сетевого интерфейса.

Два старших разряда имеют специальное значение:
- первый бит указывает, для одиночного (0) или группового (1) адресата предназначен кадр;
- следующий бит указывает, является ли MAC-адрес глобально (0) или локально (1) администрируемым.

## Как в Windows по MAC-адресу определить производителя

В Windows для определения вендора (производителя) устройства по MAC-адресу есть ПО MACAddressView.

Вы можете искать по MAC-адресу, названию компании, адресу компании, стране компании, всем MAC-адресам.

Правила ввода такие: Введите один или несколько MAC-адресов, разделяя их пробелами или нажатиями `<Enter>`. Можно указывать полный адрес (например, `01-02-03-04-05-06`) или только его первые 3 байта (например, `01-02-03`).

## Как в Linux по MAC-адресу определить производителя

База с уникальными идентификаторами организаций (OUI) обычно уже присутствует в системах Linux, поскольку её используют различные программы.

```bash
locate oui.txt
```
- Поиск файла с OUI.

```bash
wget <http://standards-oui.ieee.org/oui/oui.txt>
```
- Скачивание файла с OUI, если его нет.

```bash
#!/bin/bash

MAC="$(echo $1 | sed 's/ //g' | sed 's/-//g' | sed 's/://g' | cut -c1-6)";

result="$(grep -i -A 4 ^$MAC ./oui.txt)";

if [ "$result" ]; then
    echo "Для MAC $1 найдена следующая информация:"
    echo "$result"
else
    echo "MAC $1 не найден в базе данных."
fi
```
- Скрипт для работы с OUI файлом

## Как узнать свой MAC-адрес в Windows

Чтобы узнать свой MAC-адрес в Windows из командной строки, откройте командную строку, для этого нажмите Win+x и выберите «Windows PowerShell».

```bash
getmac
```
- Показывает краткую информацию о всех MAC-адресах системы, при этом не всегда просто сориентироваться, какому именно интерфейсу соответствует конкретный MAC-адрес.

```bash
ipconfig /all
```
- Выводит более расширенную информацию о подключении, по ней можно сориентироваться, какой физический адрес (MAC) какому именно интерфейсу принадлежит.

## Как узнать свой MAC-адрес в Linux

```bash
cat /sys/class/net/*/address
```
- Выводит информацию о текущем значении MAC и постоянный MAC-адрес устройства.

```bash
ip link
```
- MAC-адрес располагается в строках, перед которыми стоит «link/ether». Если MAC-адрес был изменён, то текущее значение показывается после «link/ether», а постоянное значение после «permaddr».

```bash
ip a
```
- Показать информацию о статусе соединений, в том числе MAC-адрес.

```bash
iw dev
```
- Посмотреть MAC-адрес беспроводных интерфейсов.

```bash
nmap 192.168.127.0/24
```
- Просканировать одно устройство или сразу сеть и показать параметры, в том числе mac-адресс.

```bash
arp-scan –l
# или
arp-scan --interface=ens33 192.168.127.0/24
```
- Узнать MAC-адрес.

## Зачем менять MAC-адрес?

- MAC-адрес является уникальным для каждого сетевого интерфейса
- Кстати, у роутера или у свитча у каждого порта свой уникальный MAC-адрес, если устройство поддерживает беспроводные сети, то у каждого беспроводного интерфейса (2.4 ГГц и 5 ГГц) также свой MAC-адрес
- Поскольку MAC-адрес должен быть уникальным, то он позволяет однозначно идентифицировать сетевое устройство. А поскольку это сетевое устройство является частью вашего компьютера, то это позволяет однозначно идентифицировать ваш компьютер
- Причём MAC-адрес не меняется при смене операционной системы - он вшит в сетевой интерфейс
- Для хакера понятно желание скрыть свой MAC-адрес - чтобы не допустить возможность доказать его идентичность с лицом, выполнившим атаку, но зачем обычным пользователям скрывать (спуфить) свой истинный MAC? Лично для меня ответ на этот вопрос не очевиден. Но проблема, судя по всему, важная, поскольку в новых прошивках Android и iOS MAC-адрес постоянно спуфится, т.е. подменяется на поддельный, причём для одного и того же устройства постоянно генерируются новые MAC-адреса
- Подмена MAC-адреса нужна чтобы не было возможности отследить и идентифицировать устройство по MAC-адресу. Это вполне реальная проблема, например, с помощью iSniff-GPS можно отследить предыдущие географические расположения устройств
- Но имеется более важная причина узнать о MAC-адресах и о способах их подмены, либо запрета изменения в своей системе. На основе MAC-адресов может выполнятся идентификация пользователя при подключении через Перехватывающий Портал

MAC-адрес используется для передачи данных в локальной сети. То есть он не передаётся при подключении к веб-сайтам и при выходе в глобальную сеть. Хотя имеются исключения: некоторые уязвимости позволяют лицу, не находящемуся в вашей локальной сети, узнать ваш MAC-адрес (это умеют некоторые скрипты Nmap).

Т.е. если вы подключаетесь к роутеру по локальной сети, то роутер знает ваш MAC-адрес (и может вести журнал подключений, в том числе сохраняя MAC-адрес), но если вы открываете сайт в Интернете, то владелец сайта не может узнать ваш MAC-адрес.

Все устройства, находящиеся в локальной сети, могут видеть MAC-адреса друг друга (имеется много сканеров, которые могут получить эти данные).

## Уникальный MAC при каждом подключении

```
[connection]
ethernet.cloned-mac-address=stable
wifi.cloned-mac-address=stable

```
- В файл /etc/NetworkManager/conf.d/mac.conf нужно добавить строки, чтобы при каждом подключении подменялся MAC-адрес, но при этом при соединении с одной и той же сетью использовался одинаковый MAC. Строки с ethernet.cloned-mac-address и wifi.cloned-mac-address можно добавлять по отдельности или вместе.

```
[connection]
ethernet.cloned-mac-address=random
wifi.cloned-mac-address=random

```
- В файл /etc/NetworkManager/conf.d/mac.conf нужно добавить строки, чтобы при каждом подключении подменялся MAC-адрес.

## Как установить определённый MAC

```bash
[connection] ethernet.cloned-mac-address=Новый_MAC
[connection] wifi.cloned-mac-address=Новый_MAC
# или
[connection] ethernet.cloned-mac-address=Новый_MAC wifi.cloned-mac-address=Новый_MAC2
```
- В файл /etc/NetworkManager/conf.d/mac.conf нужно добавить строки, чтобы поменять MAC для проводного соединения и беспроводного.

Обратите внимание, что особенностью данного метода является то, что MAC меняется только после подключения к сети. До подключения к сетям у интерфейсов будут их исходные MAC-адреса. Кроме, возможно, Wi-Fi интерфейса, поскольку для него по умолчанию установлен спуфинг MAC.

```bash
[device] wifi.scan-rand-mac-address=no
```
- Для отмены спуфинга добавьте в конфигурационный файл строки.

```bash
sudo systemctl restart NetworkManager
```
- Чтобы изменения вступили в силу, перезапустим службу.

## Изменение MAC с помощью iproute2

```bash
ip link show
```
- Просмотр всех интерфейсов.

```bash
sudo ip link set dev ens33 down
```
- Перевод интерфейса в состояние down.

Далее мы переходим непосредственно к спуфингу MAC. Можно использовать любое шестнадцатеричное значение, но некоторые сети могут быть настроены не назначать IP адреса клиентам, чей MAC адрес не соответствует какому-либо известному вендору.

```bash
sudo ip link set dev ens33 address 52:dc:aa:22:eb:77
```
- Изменение MAC-адреса.

```bash
sudo ip link set dev ens33 up
```
- Возвращаение интерфейса в состояние up.

- Поскольку NetworkManager по умолчанию присутствует и работает в большинстве дистрибутивов с графическим интерфейсом, то если у вас не получается сменить адрес, либо наоборот выполняется неожиданная смена адреса, то обратитесь в первую очередь к настройкам NetworkManager, поскольку на большинстве дистрибутивов эта служба запущена по умолчанию.
- В настоящее время NetworkManager предоставляет довольно много возможностей спуфинга MAC, в том числе смены на случайный адрес, либо на определённый. Особенностью NetworkManager является разделение на режимы «сканирование» и «подключён», т.е. вы можете не видеть, что сделанные настройки уже вступили в силу, пока не подключитесь к какой-либо сети.
