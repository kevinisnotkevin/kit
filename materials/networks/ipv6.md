# IPv6

# 1 IPv6

IPv6 (Internet Protocol version 6) - это последняя версия Интернет-протокола, используемая для передачи данных в Интернете между устройствами. IPv6 является протоколом следующего поколения после IPv4, который вышел в конце 1970-х годов. IPv6 использует 128-битные адреса вместо 32-битных адресов, используемых в IPv4. Это позволяет создать огромное количество уникальных IP-адресов, что является необходимым для увеличения числа устройств, подключенных к Интернету, и для создания новых сервисов в Интернете. IPv6 также обеспечивает более безопасные, надежные и эффективные соединения в Интернете.

Сейчас, когда IP и IPv6 протоколы работают вместе, это приводит к существованию фактически двух параллельных сетей. Например, роутер моего Интернет-провайдера поддерживает IPv6 и IP. Если я обращаюсь к сайту, у которого есть IPv6 адрес (большинство сайтов), то мой запрос и ответ идёт по сетям (узлам) с поддержкой IPv6. Если я обращусь к сайту, у которого только IP адрес, то мой запрос и ответ на него может пойти по другому маршруту.

При анализе сети, допустим, с помощью Wireshark или tcpdump можно пропустить половину или даже больше трафика, если забыть про IPv6! То есть в качестве фильтра отображения пакетов в Wireshark вы введёте обычный фильтр для показа трафика IP протокола. Но если ввести фильтр ipv6, то картина изменится кардинально, окажется, что компьютер подключается ещё и к совершенно другим хостам.

При анализе сети, при настройке фильтров отображения по IP, при выполнении атак (например, ARP и DNS спуфинг в локальной сети), нужно помнить про IPv6.

IP и IPv6 это две параллельные сети, которые не особо связаны друг с другом (хотя одно и то же оборудование может поддерживать работу с обоими протоколами). В результате при настройке сети, например, файервола, нужно отдельно сделать настройки для протокола IP, а затем делать такую же настройку IPv6. Поскольку это разные сети, есть шанс, что системный администратор настроил их по-разному, что даёт лазейки для выполнения атак или обхода ограничений с использованием IPv6.

IPv6 адреса могут пригодиться при исследовании локальных сетей Интернет-провайдеров, стоит попробовать использовать IPv6 для обхода Captive Portal (перехватывающих порталов) и других ограничений сети, про IPv6 нужно помнить при анализе трафика на своём компьютере и в локальных сетях, либо наоборот для увеличения скрытности своего пребывания (в надежде, что в настройках логирования трафика не упомянут IPv6 или что геолокация по IPv6 сейчас в зачаточном состоянии (по крайней мере, в публичных базах данных)).

В ядра Debian включена обработка IPv6 внутри самого ядра (за исключением нескольких архитектур устройств, в которых скомпилирован модуль, называемый ipv6). Основные инструменты, такие как ping и traceroute, имеют их IPv6 эквивалентов, называемых ping6 и traceroute6, которые доступны в пакетах с соответствующими именами iputils-ping и iputils-tracepath

Сеть IPv6 настраивается аналогично тому, как это делается в IPv4, в файле /etc/network/interfaces. Но если вы хотите, чтобы сеть была доступна глобально, вы должны убедиться, что имеете IPv6-совместимый маршрутизатор, перенаправляющий трафик в глобальную IPv6 сеть.

# 2 Структура IPv6 адреса

```
::1
2a02:6b8:a::a
2a02:f680:1:1100::3d60
2604:a880:800:c1::2ae:d001
2001:db8:11a3:9d7:1f34:8a2e:7a0:765d
```
- Примеры правильных IPv6 адресов

Адреса IPv6 в полной форме отображаются как восемь четырёхзначных шестнадцатеричных чисел (то есть восемь групп по четыре символа), разделённых двоеточием.

Шестнадцатеричные числа записываются с помощью цифр от 0 до 9 и с помощью букв от a до f.

Полная запись может быть сокращена используя несколько методов нотации, к примеру, адрес 2001:0db8:0000:0000:0000:8a2e:0370:7334 равнозначен адресу 2001:db8::8a2e:370:7334.

У IPv6 адресов в каждом сегменте 16 бит информации (hextet или hexadectet). Всего 8 сегментов по 16 бит информации, получается, что для записи IPv6 адресов используется 8*16=128 бит.

Как уже было сказано выше, в IPv6 адресах числа в группах записываются в виде шестнадцатеричных чисел, а не в виде десятеричных, как в IP. Кстати, если запись была бы в виде десятичных чисел, то в каждом сегменте были бы числа от 0 до 65535 (это 216). Что касается шестнадцатеричных чисел, то для записи 16 бит информации нужно число длиной до четырёх символов, поэтому получается, то размер раздела составляет 4 символа, но может быть меньше, поскольку нули в начале числа писать необязательно. То есть если там должно быть число 00a1, то можно записать просто a1 — это первый способ сокращения записи IPv6 адресов.

_Если в группе число равно 0 (то есть четыре нуля), то записывается один ноль._

Если групп с нулями несколько подряд, то независимо от количества нулей вся эта группа записывается как идущие два подряд двоеточия (::). Последнее сокращение можно использовать в одном IPv6 адресе только один раз, даже если имеется несколько групп с нулями. Если групп с нулями несколько, то заменяется только самая продолжительная из них. Если имеется две группы с нулями одинаковой длины, то заменяется та, которая идёт первой, то есть более левая.

Пример использования этих правил:

Начальный адрес: `2001:0db8:0000:0000:0000:ff00:0042:8329`

После удаления всех начальных нулей в каждой группе: `2001:db8:0:0:0:ff00:42:8329`
После пропуска последовательных сегментов с нулями: `2001:db8::ff00:42:8329`
Петлевой адрес `0000:0000:0000:0000:0000:0000:0000:0001` используя правила сокращения можно сократить до `::1`

Вернёмся к адресам из примеров выше: `::1`
Как мы уже выяснили, это петлевой адрес: `0000:0000:0000:0000:0000:0000:0000:0001`.

`2a02:6b8:a::a` - Здесь пропущено несколько секций с последовательными нулями. Сколько именно? Это можно узнать исходя из следующего правила: всего должно быть 8 секций, а имеется только 4, значит, пропущено 4 секции, то есть в полном виде число должно выглядеть так: `2a02:6b8:a:0:0:0:0:a`

Следующий пример: `2a02:f680:1:1100::3d60`
В этом адресе 5 сегментов, а должно быть 8, значит пропущено 3, запись адреса в полном виде: `2a02:f680:1:1100:0:0:0:3d60`

`2604:a880:800:c1::2ae:d001` - В этом адресе 6 сегментов, а должно быть 8, следовательно, полная запись этого адреса: `2604:a880:800:c1:0:0:2ae:d001`

# 3 Как узнать, у меня IPv6 адрес или нет? Как узнать свой IPv6 адрес

Узнать свой внешний IP адрес без сторонних сервисов иногда просто невозможно, поскольку довольно часто клиенты Интернет-провайдеров выходят в Глобальную сеть через несколько NAT. Поэтому приходится заходить на сайты и сервисы «Узнать свой IP» - эти сервисы смотрят, с какого IP адреса пришёл запрос и показывают его вам. Но скорее всего, это не совсем «ваш» IP адрес, поскольку у компьютеров и телефонов в вашей локальной сети есть только локальные IP адреса, у вашего роутера тоже какой-то локальный IP принадлежащий сети Интернет-провайдера, а тот IP, который показывают вам сайты, на самом деле, присвоен какому-то сетевому устройству у провайдера, через который вы выходите во внешнюю сеть одновременно со многими другими пользователями.

С IPv6 адресами в этом смысле проще — их настолько много, что потребность в NAT отпадает — можно каждому клиенту раздать по персональному IPv6 адресу.

# 4 Зарезервированные IPv6 адреса

Рассмотрим диапазоны IPv6 адресов для целевого назначения, чтобы мы могли сразу отфильтровывать их из многочисленных IPv6 адресов сетевых интерфейсов.

У IP также есть зарезервированные диапазоны адресов: 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16, 127.0.0.0/8, 100.64.0.0/10 и ещё несколько.

![](materials/images/networks/ipv6_reserve.png)
- Специальные диапазоны IPv6 адресов

## 4.1 Глобальные IPv6

Соответствуют публичным IPv4-адресам. Могут находиться в любом не занятом диапазоне. В настоящее время региональные интернет-регистраторы распределяют блок адресов 2000::/3 (с 2000:: по 3FFF:FFFF:FFFF:FFFF:FFFF:FFFF:FFFF:FFFF).

Это означает, что глобальными сейчас являются только IPv6 адреса, которые начинаются на «2» или на «3».

У одного сетевого интерфейса может быть много IPv6 адресов, по умолчанию. Зачем так много IPv6 одному интерфейсу? Каждый интерфейс IPv6 имеет локальный IP-адрес. Если интерфейс также может обмениваться данными с более крупной сетью (например, через Интернет), он также имеет глобальный адрес. Это как минимум два адреса. И если хост находится за многосетевым подключением к Интернету, он, вероятно, имеет ещё больше адресов.
