# RIP

Один из самых простых протоколов маршрутизации - Протокол маршрутной информации (Routing Information Protocol, он же RIP - протокол маршрутизации на основе вектора расстояния). Этот протокол применяется в небольших компьютерных сетях и позволяет маршрутизаторам динамически обновлять маршрутную информацию, получая ее от соседних маршрутизаторов.

**Метрика**

Для определения наилучшего маршрута используется Метрика. Метрика – это условная стоимость передачи по сети. Полное измерение конкретного маршрута равно сумме метрик сетей, которые включают в себя маршрут. Маршрутизатор всегда выбирает маршрут с наименьшей метрикой.

Некоторые простые протоколы, такие, как RIP, рассматривают все сети как одинаковые. Для измерения расстояния между сетью-источником и сетью-получателем RIP использует единую метрику — количество переходов. Один переход – это действие прохода трафика через один роутер. Еще проход называют хопом.

При получении сообщения об обновлении маршрутов с новой или измененной записью о сети-получателе маршрутизатор добавляет единицу к значению метрики, указанному в сообщении и обновляет свою таблицу маршрутизации, включая в нее новый маршрут. IP-адрес отправителя используется в качестве следующего перехода.

В первой версии протокола RIP не было даже аутентификации – роутеры верили всем анонсам от соседей и их легко было обмануть, обрушив маршрутизацию по всей сети или направив нужный трафик в сторону компьютера злоумышленника.

Недочеты попытались устранить во второй версии протокола. Добавили возможность аутентификации для подтверждения легитимности роутеров в сети, а так же добавили возможность работы с масками подсетей.

**Обмен информацией**

Используя вектор расстояния маршрутизации, каждый маршрутизатор периодически делится своей информацией об известных ему сетях со своими соседями.

Существует три основных принципа процесса обмена информацией:

1. Распределение информации о существующих сетях в автономной системе. Каждый маршрутизатор распределяет информацию об известных сетях соседним маршрутизаторам.
2. Распределение только своим соседям. Каждый маршрутизатор посылает свою информацию только к соседям, а не всем существующим роутерам. Он посылает информацию через все свои подключенные интерфейсы.
3. Распределение через регулярные интервалы. Каждый маршрутизатор посылает свою информацию соседним роутерам через фиксированные интервалы, в протоколе RIP это каждые 30 секунд

**Обновление таблицы маршрутизации**

Когда на роутерах включен протокол динамической маршрутизации, они постоянно обмениваются информацией о том, какие маршруты в какие сети знают. Маршруты могут быть как с большой метрикой, так и с маленькой. Логично, что для оптимальной работы сети нужно выделить те маршруты, метрика которых минимальна. Поэтому если изначально роутер узнал о том, что до одной сети можно добраться с помощью пяти хопов, а потом его сосед прислал ему обновление, содержащее информацию о достижимости этой сети через два хопа, то роутер должен обновить свою таблицу маршрутизации. Он удалит изначальный длинный маршрут, заменив его более коротким.

**Формат сообщения**

Каждая таблица маршрутизации обновляется по сигналу RIP-сообщения, используя определенный RIP-алгоритм обновления.

У протокола RIP стандартизованы сообщения, которые роутер отправляет своим соседям с целью поделиться знанием о тех или иных сетях. Рассмотрим заголовки такого сообщения.

- Команда. Это поле длиной 8 бит задает тип сообщения: запрос (1) или ответ (2).
- Версия. Это поле длиной 8 бит определяет версию протокола RIP.
- Семейство. Это поле длиной 16 бит определяет семейство используемых протоколов. Для TCP/IP значение равно 2.
- Адрес сети. Поле адрес определяет адрес пункта назначения. RIP отводит 14 байт для этого поля в приложении к любым протоколам. Однако IP в настоящее время использует только 4 байта. Остаток адреса заполняется нулями.
- Расстояние. Это поле длиной 32 бита определяет расстояние до сети назначения, которая объявлена в поле адрес сети.

Рассмотрим новые заголовки, появившиеся во второй версии протокола RIP:

- Тэг маршрута. Это поле переносит такую информацию, как номер автономной системы. Он может использоваться для обеспечения возможности RIP получать информацию от внешнего протокола маршрутизации.
- Маска подсети. Это поле в 4 байта, которое несет маску к подсети (или префикс). Это означает, что RIP2 поддерживает классическую адресацию и бесклассовую междоменную маршрутизацию CIDR (Classless Inter Domain Routing).
- Адрес следующего участка. Он используется, например, если две автономных системы вместе используют одну сеть. По этому сообщению можно определить маршрутизатор той же самой системы или другой автономной системы, к которому должен пройти пакет.

**Аутентификация RIP версии 2**

Поле «Тег маршрута» переименовывается в поле «Тип аутентификации», которое для аутентификации по паролю принимает значение, равное 2. Далее следуют 16 байтов информации, содержащие пароль. Если пароль занимает менее 16 байт, он дополняется нулями. Если же пароль имеет длину более 16 байт, для аутентификации используются первые 16 байт.

Изначально использовались текстовые пароли для аутентификации, которые легко было перехватить. Потом ввели возможность аутентификации по хешу пароля. Но даже такие технологии не спасли протокол RIP. Сейчас он уже почти не используется ввиду большого количества недостатков.

**Таймеры RIP**

В протоколе RIP существует несколько разных таймеров.

- Update timer — частота отправки обновлений протокола, по истечению таймера отправляется обновление. По умолчанию равен 30 секундам.
- Invalid timer — Если обновление о маршруте не будет получено до истечения данного таймера, маршрут будет помечен как Invalid, то есть с метрикой 16. Такой маршрут считается недостижимым. По умолчанию таймер равен 180 секундам.
- Flush timer (или garbage collection timer) — По умолчанию таймер равен 240 секундам, на 60 больше чем invalid timer. Если данный таймер истечет до прихода обновлений о маршруте, маршрут будет исключен из таблицы маршрутизации. Если маршрут удален из таблицы маршрутизации то, соответственно, удаляются и остальные таймеры, которые ему соответствовали.
- Holddown timer — Запуск таймера произойдет после того, как маршрут был помечен как недостижимый. До истечения данного таймера маршрут будет находиться в памяти для предотвращения образования маршрутной петли и по этому маршруту передается трафик. По умолчанию равен 180 секундам. Таймер не является стандартным, добавлен в реализации Cisco.

**Расщепление горизонта**

Для оптимизации и предотвращения петель маршрутизации в протоколе RIP был разработан метод Расщепление горизонта.

Петли маршрутизации в основном возникают из-за медленной сходимости этого дистанционно-векторного протокола маршрутизации.

Правило расщеплённого горизонта говорит, что маршрутизатор не должен распространять информацию о сети через интерфейс, в которых прибыло обновление об этой сети. Обычно роутеры по протоколу RIP обмениваются своей полной таблицей маршрутизации. Получается, если роутер два отправит роутеру один информацию о подсети двадцать, то роутер один будет отправлять роутеру два информацию об этой же сети, достижимой через него. Роутер два такую информацию не примет, так как знает, что до этой сети ему ближе идти через свой непосредственно подсоединенный интерфейс. Но получается, что мы лишний раз нагружаем сеть ненужной информацией. Правило расщеплённого горизонта даст понимание роутеру 1, что раз от получил анонс от второго роутера про подсеть двадцать, то этому же второму роутеру можно не посылать часть таблицы маршрутизации с подсетью двадцать – ведь второй и так про нее знает.

**Поглощение ответа** Поглощение ответа – вариант "расщепленного горизонта". В этом методе информация, полученная маршрутизатором, используется маршрутной таблицей и затем передается всем интерфейсам. Однако вход таблицы, который получил информацию через интерфейс, устанавливает для этого интерфейса метрику 16 и исключает его из процесса рассылки обновления.

**Недостатки протокола**

Получается, протокол RIP весьма несовершенен. Резюмируем основные недостатки этого протокола:

**Первый недостаток** – медленная сходимость.

**Второй недостаток** – проблема масштабирования из-за ограничения метрики маршрута.

И **третий недостаток** – RIP работает только с классовой адресацией. То есть ничего не знает про разнообразие масок подсетей. Для него есть лишь классы сетей, которые соответствуют современным маскам /8, /16 и /24.
