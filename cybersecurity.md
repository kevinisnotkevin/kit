# Кибербезопасность


## Utils
- [__responder__](#responder): MiTM для аутентификации Windows;
- [__evil-winrm__](#evil-winrm): Удаленное управление Windows (WinRM);
- John the ripper: ;


## Примеры XSS

#### Пример 1
Пример с reflected XSS. Веб-приложение принимает пользовательский ввод и выводит его на html страницу.
```
https://test.com?message=Ok.
<p>Message: Ok.</p>
```
В случае, если приложение не проверяет пользовательский ввод, то может быть внедрен вредоносный код.
```
https://test.com?message=<script>alert(1)</script>
<p>Message: <script>alert(1)</script></p>
```
Если пользователь посещает URL злоумышленника, то скрипт злоумышленника будет выполнен в веб-приложении в браузере пользователя в контексте сеанса пользователя. Скрипт может выполнить любые действия и получать доступ к любым данным, доступным пользователю.

#### Пример 2
Пример stored XSS. Веб-приложение позволяет пользователям оставлять комментарии к блогу на странице. Злоумышленник в поле ввода комментария вводит вредоносный скрипт, который сохраняется на сервере. Теперь, пользователи, которые откроют страницу с комментариями к блогу, то получат вредоносный скрипт, загруженный злоумышленником.

#### Пример 3
Пример с DOM XSS. В этом примере веб-приложение читает значение из поля ввода и записывает это значение в DOM.
```
var search = document.getElementById('search').value; 
var results = document.getElementById('results'); 
results.innerHTML = 'Search: ' + search;
```
Если злоумышленник может контроллировать поле ввода, то он может внедрить вредоностный скрипт.
```
Search: <img src=1 onerror=alert(1)>
```


## CSS
Способы использования CSS для атак:
- Встроенный или внешний CSS может быть модифицирован для включения вредоносного кода. Это происходит, когда разработчики не фильтруют пользовательский ввод, который попадает в стили.
- Когда веб-сайты позволяют загрузку CSS-файлов с внешних источников. Это может быть использовано для запуска атак на уровне протокола, таких как DNS-rebinding или атаки по промежуточным звеньям.
- Clickjacking. CSS может использовать для маскировки вредоносных элементов интерфейса, делая их невидимыми или замаскированными.
- Фишинг. Злоумышленники копируют ресурсы, повышая вероятность обмана и кражи конфиденциальной информации.
- В CSS есть возможность подключения шрифтов или других ресурсов с использованием URL. Потенциально это можно использовать для загрузки вредоносного контента или отслеживания пользователей.

### Способы повышения безопасности CSS
- Включение CSP в заголовки ответов сервера. Это ограничит ресурсы, которые могут загружаться на страницу.
- Фильтровать и санировать пользовательский ввод. Это позволяет предотвратить внедрение вредоносных данных и CSS-инъекций.
- Использование методологии BEM и CSS модули, компонентные подходы (например, в React с styled-components или Emotion). Это позволяет избежать переопределения стилей и обеспечить модульность и изолированность.
- Сократить использование inline-стилей, так как это потенциальный вектор для атак.
- Использовать HTTPS, чтобы исключить MITM.
- Проверять файлы CSS, загружаемые с серверов или CDN. Это поможет заменить подмену содержимого или добавление вредоносного кода.


## JWT
Инструменты для автоматизации атак на JWT:
- JWT Tool. Инструмент на Python, который позволяет проверять все виды атак, которыми может быть уязвимо веб-приложение.
- JWT Editor. Расширение Burpsuite, которое может изменить JWT и быстро протестировать различные способы обхода.
- jwtXploiter. Инструмент на Python, который автоматизирует взлом JWT, проверяя на соответствие всем известным CVE. Поддерживает все виды JWT-атак: от простого взлома до выполнения атак с ключами с использованием самозаверяющих токенов.
- JSON Web Tokens. Расширение Burpsuite, которое автоматизирует распространенные атаки JWT и предоставляет возможность быстро кодировать, декодировать и проверять токены.

### Способы защиты от атак на JWT
- Использование надежных алгоритмов шифрования и подписи, например, HMAC-SHA256 или RSA;
- Защита ключей для подписей и шифрования токенов;
- Регулярное обновление и повышение безопасности ключей и алгоритмов;
- Установка разумных сроков действия для токенов и использование механизмов обновления токенов или повторной аутентификации при необходимости;
- Использование защищенного соединения (HTTPS) при передаче JWT-токенов;
- Избегание передачи конфиденциальной информации напрямую в токенах.


## Способы защиты Clickjacking
- Заголовки безопасности, такие как X-Frame-Options или Content Security Policy (CSP). Работает на уровне HTTP, до загрузки какого-либо содержимого пользователя. Когда X-Frame-Options установлен в DENY, он полностью запрещает отображение страницы в фрейме. Когда установлен в SAMEORIGIN, страница может отображаться в фрейме только на том же домене. Также можно использовать CSP с директивой frame-ancestors, которая позволяет более гибко контролировать, какие источники могут встроить страницу во фрейм. Пример CSP: Content-Security-Policy: frame-ancestors ‘self’ https://example.com. Этот CSP разрешает встраивание страницы только если она открыта непосредственно на собственном домене self или на домене https://example.com.
- Скрипты, которые обнаруживают попытки встраивания страницы в фрейм. Пример JS, который обнаруживает, если веб-страницы загружаются внутри фрейма, и предпринимает действия для предотвращения кликджекинга:
```js
if (window.top !== window.self) {
    window.top.location = window.location;
}
```
- В этом скрипте window.top ссылается на самый верхний фрейм в иерархии вложенных фреймов. window.self ссылается на текущее окно. Если они не равны, значит, страница загружены внутри фрейма, и скрипт перенаправляет браузер на настоящую веб-страницу, выходя из внешнего фрейма.
- Визуальная индикация. Иногда можно использовать техники, которые служат для визуальной индикации того, что элементы интерфейса безопасны для взаимодействия. Пример: добавление шума или водяных знаков в фон, чтобы осложнить создание злоумышленниками невидимых фреймов.


## Принцип работы и защита от DNS rebinding
### Принцип работы
- Подготовка атаки. Злоумышленник регистрирует или использует контролируемый им домен и связывает его с сервером, который способен быстро изменять DNS-записи. 
- Жертва заходит на сайт.
- В браузер загружается автоматически вредоносный скрипт.
- Изменение DNS-записи. После загрузки скрипта злоумышленник меняет DNS-запись для сайта так, чтобы она указывала на локальный IP-адрес жертвы (например, на роутер или умный пылесос).
- Вредоносные запросы. Вредоносный скрипт делает запросы к сайту, которые фактически переадресовываются на внутренний IP-адрес локальной сети жертвы. Например, скрипт может войти в консоль управления домашнего роутера. Атака обходит политику одного источника. Браузер все еще думает, что он взаимодействует с сайтом, даже когда фактический IP-адрес домена изменился до локального. Так скрипт взаимодействует со всеми устройствами в сети жертвы.

### Способы защиты
- Использование Public Suffix List для предотвращения установления cookies на верхнеуровневые домены публичных суффиксов (например, .co.uk). Это усложнит атаку.
- Настройка внутренних серверов, чтобы они отклоняли запросы, исходящие из внешних источников.
- Использование расширения браузера, которое блокирует подозрительный трафик или уведомляет о потенциально опасных изменениях.


## Tools
- __Metasploit__ – широко используемая среди эксплойтов платформа с открытым исходным кодом и большим и активным сообществом пользователей, которое постоянно способствует ее развитию, исследованию уязвимостей и созданию эксплойтов. Поддерживает более 1500 эксплоитов и более 3000 модулей. Предоставляет графический интерфейс и интерфейс командной строки. Предлагает интеграцию с nmap, nessus.
- __Canvas__ – коммерческая платформа эксплойтов, которая включает широкий спектр модулей, предназначенных для различных платформ, сетевых устройств и уязвимостей. Содержит более 450 эксплойтов. Позволяет настройку с помощью Python. Обеспечивает графический интерфейс для управления и выполнения атак.
- __Exploit Pack__ – коммерческая платформа эксплойтов, ориентированная на простоту использования и широкий выбор модулей эксплойтов. Предлагает более 38000 эксплойтов. Позволяет настраивать и разрабатывать эксплойты с использованием JS. Включает фаззеры, генераторы шеллкодов и другие расширенные функции.
- __SET (Social-Engineer Toolkit)__ – платформа с открытым исходным кодом, предназначенная для проведения атак социальной инженерии. Нацелен на учетные данные пользователей, уязвимости ПО и другое. Выполняет атаки по email, sms-атаки. Обеспечивает создание фишинговых писем на основе шаблонов. Интегрируется с Metasploit для полезных нагрузок и эксплойтов. Предлагает использование USB для устройств с человеческим интерфейсом.
- __Nmap__ – популярный сетевой сканер с открытым исходным кодом, используемый профессионалами в области пентеста для обнаружения хостов и сервисов в сети. Помогает идентифицировать хосты, открытые порты, запущенные службы, типы ОС и другие детали. поддерживает ping-сканирование, множество методов сканирования портов, определение версий и TCP/IP fingerprinting. Nmap также предлагает гибкую спецификацию целей и портов, скрытое сканирование, сканирование sunRPC и другое. Поддерживается большинство платформ Unix и Windows как в графическом интерфейсе, так и в режиме командной строки. Также поддерживается несколько популярных портативных устройств, включая Sharp Zaurus и iPAQ. Позволяет узнать какие устройства подключены к сети, какая ОС установлена на устройствах и ее версию.
- __Wireshark__ – инструмент с открытым исходным кодом, используемый для сетевого анализа и устранения неполадок. Позволяет захватывать и анализировать трафик, передаваемый через сеть. Помогает выявить любую подозрительную активность, например, передачу ВПО или попытки несанкционированного доступа.
- __John the Ripper__ – инструмент для взлома паролей, который можно использовать для выявления слабых паролей и проверки их безопасности. Поддерживает различные алгоритмы шифрования, а также используется для идентификации хешей.
- __Burp Suite__ – инструмент тестирования безопасности веб-приложений, в основном используемый для проверки уязвимостей в веб-приложениях. Включает в себя инструменты для перехвата и изменения запросов, автоматизации тестов, сканирования и другое.
- __Aircrack-ng__ – набор инструментов, предназначенных для обеспечения безопасности Wi-Fi. Включает инструменты для захвата и анализа сетевых пакетов, взлома Wi-Fi и тестирования общей безопасности беспроводных сетей.
- __Pentest tools__: burp suite, owasp zap, metasploit, nmap, dirb, nikto, fierce, dnsenum, sqlmap, shodan, beef, arachni, wireshark, hydra, cain and abel, w3af, nessus, trivy, SonarQube, MobSF, Dependency check, ifconfig, netstat, uname, dig, ping, traceroute, tcpdump, john the ripper, aircrack-ng;
- __Инструменты для проверки открытых портов__: Advanced Port Scanner; TCP Port Scan with Nmap; IPVOID; Network Port Scanner Tool; DNS Tools; Web Proxy and Privacy Tool; Solar winds Port Scanner; IP Tool; UltraTools; Yougetsignal.
Shodan – поисковая система для идентификации устройств в Интернете. 
- __Socialscan__ – инструмент командной строки для проверки использования электронной почты и имен пользователей социальных сетей. Он напрямую запрашивает регистрационные серверы платформ и получает соответствующие CSRF-токены, заголовки и куки.
- __Google Dorks__ – поисковая система информации, собранной и проиндексированной автоматическими ботами.
- __Crt.sh__ – распределенная БД с веб-интерфейсом для поиска SSL-сертификатов и журналов прозрачности сертификатов для обнаружения доменов, внутренних сертификатов с внутренними именами/доменами, электронной почты и другой конфиденциальной информации.
- __Ncat__ – реализация Netcat от NMAP, предоставляющая большинство функций, присутствующих в оригинальных реализациях, а также некоторые новые возможности, такие как поддержка IPv6 и SSL. Поддержка сканирования портов удалена.
- __Ndiff__ – инструмент для сравнения сканов Nmap. Он берет два выходных XML-файла Nmap и выводит различия между ними: хосты увеличиваются или уменьшаются, порты становятся открытыми или закрытыми, и так далее.
- __Unicornscan__ – быстрый сканер (как nmap, но асинхронный), который обеспечивает: асинхронное сканирование TCP, асинхронный захват баннера TCP, асинхронное сканирование UDP, активную и пассивную удаленную идентификацию ОСб приложений и компонентов путем анализа ответов, регистрацию и фильтрацию файлов PCAP, вывод реляционной БД, поддержку пользовательских модулей, настраиваемые представления наборов данных, свой стек TCP/IP.
- __Maryam__ – инструмент-многостаночник, в котором очень много поисковых возможностей. Полезен не только для OSINT, но и для подготовительных этапов пентеста. Состоит из модулей, которые разбиты на три категории. Каждый модуль выполняет определенное действие. Для запуска необходимо выбрать модуль, указать нужные параметры и запустить процесс.
- __Masscan__ – сканер TCP-портов, который позволяет использовать произвольные диапазоны адресов и портов, который передает SYN-пакеты асинхронно и выдает результаты, схожие с nmap. Работает как scanrand, unicornscan, ZMap.
- __Dnsenum__ – многопоточный perl-скрипт для перечисления DNS-информации домена  обнаружения несмежных ip-блоков. Основная цель – собрать как можно больше информации о домене.
- __Parsero__ – скрипт на Python, который используется для чтения файла Robots.txt веб-сервера и просмотра записей Disallow. Записи Disallow указывают поисковым системам, какие каталоги или файлы, размещенные на веб-сервере, не должны быть проиндексированы.
- __Nikto__ – сканер уязвимостей с открытым исходным кодом, который анализирует веб-приложения и серверы на наличие неправильной конфигурации, вредоносных файлов, проблем, связанных с версиями, сканированием портов и других проблем.
- __ZUI (Zed User Interface)__ – сканер трафика на движке ZED, который написан на Go и состоит из различных элементов. Преимущества перед Wireshark: скорость работы, поддержка сигнатур, анализ логов. Недостатки: не умеет кодировать пакеты и экспортировать найденные в трафике файлы.
- __SkipFish__ – инструмент, который ищет уязвимости веб-приложений, выполняя рекурсивное сканирование на основе словаря и создавая интерактивную карту целевого сайта. Карта аннотируется выводом ряда активных проверок безопасности. Обладает высокой производительностью при экономном использовании процессора и памяти. Автоматически строит список слов на основе анализа контента сайта. Связанные проверки безопасности для обработки сложных сценариев, слепая инъекция SQL, XML и др. Постобработка отчетов. Это снижает шум, вызванный ложными срабатываниями или уловками сервера, путем выявления повторяющихся шаблонов.
- __Invoke-Obfuscation__ – инструмент для обфускации и команд оболочки для создания собственных сложных скриптов и обхода обнаружения антивирусов и EDR. Обфускация – процесс, когда меняют исходный или исполняемый код, оставляя его функциональность, но затрудняя анализ и понимание алгоритмов.
- __Macro_pack__ – инструмент, который автоматизирует обфускацию и создание документов MS OFFICE, скриптов VB и других алгоритмов. Полезен для запуска CobalStrike, распространенного метода работы вредоносной программы Emotet, непосредственно из документов Word.
- __Wapiti__ – сканер веб-уязвимостей, который использует внедрение полезной нагрузки в веб-приложение для нахождения XSS, SSRF, слабых конфигураций .htaccess.
- __W3af__ – фреймворк для атак и аудита веб-приложений, который может сканировать до 200 уязвимостей в одном веб-приложении: от SQL-инъекций до XSS. Имеет как графический интерфейс , так и командную строку. Требует наличие Python.
- __Skipfish__ – инструмент для тестирования на проникновение, который предоставляет 500+ против интернет-целей, 2000+ запросов в секунду в сетях LAN/MAN и 7000+ запросов против локальных экземпляров, автоматическое построение списка слов на основе анализа содержимого сайта, распознавание нечетких путей и схем обработки параметров, основанных на запросах, связанные проверки безопасности предназначены для обработки сложных сценариев: безопасный XSS, слепые SQL или XML-инъекции или вставка скрытой оболочки.
- __OpenVAS__ – полнофункциональный сканер уязвимостей, который не только сканирует систему на наличие уязвимостей, но и анализирует их. На основе данных можно понять, какие меры безопасности необходимо принять, чтобы устранить недостатки.
- __App-Ray__ – инструмент безопасности для сканирования приложений, который может обнаружить утечку данных, предотвратить установку опасных приложений, выполнить проверку безопасности и достичь цели соответствия: DGPR, CCPA.
- __Codified Security__ – платформа, которая позволяет загружать файлы APK и IPA и сканировать их уязвимости.
- __Runtime Mobile Security__ – веб-приложение на NodeJS, которое позволяет манипулировать приложениями Android и iOS в режиме Runtime.
- __Gorhish__ – набор инструментов для борьбы с фишингом с открытым исходным кодом, который позволяет организовать и провести фишинговые атаки и тренинги по повышению осведомленности о безопасности.
- __BeEF (The Browser Exploitation Framework)__ – среда безопасности, позволяющая использовать векторы атак на стороне клиента, которая обходит окружение и позволяет получить доступ к цели с помощью простого веб-браузера.
- __Bulk_Extractor__ – многопоточный инструмент Linux, который находит и извлекает данные: адреса электронной почты, ip-адреса, данные кредитных карт, url сайтов, другая информация с любого носителя или образа диска. Работает с текстовыми документами: архивами (ZIP, GZIP, RAR) и со сжатыми файлами типа PDF.
- __BloodHound__ – инструмент для визуализации сетей Active Directory (AD) и определения списков контроля доступа, пользователей и связей. Для использования требуется действительный пользователь AD, который может быть получен из утечки БД или путем отправления внутренней сети, например, с помощью инструментов ответчика.
- __PowerUp__ – инструмент PowerShell, позволяющий контролировать неправильную конфигурацию и выполнять различные атаки с повышением привилегий в Windows. Предоставляет модули и методики для эксплуатации уязвимых служб и других возможностей повышения привилегий.
- __PEASS (Privilege Escalation Awesome Scripts SUITE)__ – инструмент, который находит возможности повышения конфигурации для ОС Windows, Linux/Unix* и macOS.
- __CrackMapExec__ – инструмент, который оценивает и использует уязвимости в средах active directory. Для получения учетных данных и навигации по активной директории использует Mimikatz.
- __LaZagne__ – инструмент для восстановления паролей, который извлекает их почти из любого места.
- __Impacket__ – набор классов Python для работы с сетевыми протоколами. Ориентирован на представление низкоуровневого программного доступа к пакетам и имеет набор автономных сценариев для различных сценариев обновления и доступа.
- __CobaltStrike__ – пакет для пост-эксплуатации и эмуляции долгосрочного агента.
- __Crunch__ – генератор списков слов, в котором можно указать стандартный набор символов или любой набор символов, который будет использоваться при создании списков слов. Списки слов создаются путем комбинации и перестановки набора символов. Можно определить количество символов и размер списка. Программа поддерживает цифры и символы, символы верхнего и нижнего регистра по отдельности и Юникод.
- __CUPP__ – утилита для генерации списков паролей, основанных на информации о пользователе.
- __Hashcat__ – утилита для восстановления паролей на базе CPU/GPU, поддерживающая 7 режимов атаки для более чем 100 оптимизированных алгоритмов хеширования.
- __Hydra__ – распараллеленный взломщик логинов, поддерживающий множество протоколов для атак. Он очень быстрый и гибкий, а новые модули легко добавляются.
- __WEF (WiFi Exploitation Framework)__ – фреймворк для автоматизированного взлома WiFi-сетей, который умеет работать с протоколом 802.11, предлагает различный типа атак на WPA/WPA2 и WEP, автоматически взламывает хеши, работает с шаблонами EvilTwin. Возможные атаки: Deauthentication Attack, Authentication Attack, Глушилка Bluetooth, Beacon Flood, PMKID-атака, EvilTwin, Pixie Dust, Null Pin, WEP, Спуфинг GPS с помощью HackRF.
- __WeBaCoo (Web Backdoor Cookie)__ – скрипт веб-бэкдора, который используется для организации скрытого соединения между клиентом и веб-сервером по HTTP, похожего на терминал. По сути это инструмент пост-эксплойта, который поддерживает доступ к взломанному веб-серверу. Разработан для работы под радаром современных AV, NIDS, IPS, сетевых и прикладных брандмауэров. Он обеспечивает скрытый механизм выполнения системных команд на скомпрометированном сервере. Главная особенность - соединение между веб-сервером и клиентом кодируется в HTTP-заголовке cookie. Его могут не обнаружить антивирусы, сетевые системы обнаружения/предотвращения вторжений, сетевые и прикладные брандмауэры.


## VPN

- __VPN (Virtual Private Network)__ – защищенный туннель, который шифрует трафик, обеспечивая анонимность. Направляет трафик через серверы виртуальной частной сети, маскируя IP-адрес отправителя, шифруя передаваемый трафик. VPN включает: аутентификацию, шифрование, проксирование, туннелирование. Способы подключения: P2P, RA, STS;
- __VPN-приложение__ – ПО, которое позволяет пользоваться VPN-сетью;
- __Виртуальная сеть__ – сеть, которая создана программным образом и функционирует на основе физической инфраструктуры. Позволяет объединить удаленные устройства в один локальный пул. Виртуальная сеть может быть составляющей VPN, но не наоборот;
- __Частная сеть__ – сеть, которую могут использовать определенные лица и организации. Создается под конкретные нужды компаний;
- __VPN-протоколы__ – правила, определяющие порядок работы виртуальной частной сети. Отвечают за процессы аутентификации устройств, способы передачи данных, безопасность используемых алгоритмов, приватность соединения.

### Принцип работы

- Пользователь выбирает сервер в сервисе VPN и подключается к нему со своего устройства;
- VPN-сервис создает зашифрованный туннель между клиентом и сервером. В нем шифрует передаваемые данные по протоколу;
- VPN-сервер получает и расшифровывает трафик с помощью ключей шифрования;
- VPN-сервер заменяет информацию о пользователе на свою и перенаправляет на целевой сайт запрос, с которым нужно установить соединение;
- VPN-сервер получает ответ, шифрует и перенаправляет пользователю. Для расшифровки данных VPN-клиент и сервер используют ключи шифрования.

### Использование

- Сохранение анонимности, сокрытие IP-адреса;
- Защита данных при подключении к публичным сетям Wi-Fi;
- Создание безопасного соединения для передачи данных между двумя сетями;
- Получение доступа к контенту, который заблокирован в текущем регионе.

### Сравнение с прокси

- VPN шифрует весь трафик, Proxy – нет;
- Оба скрывают IP-адрес, но VPN шифрует всю интернет-активность, что гарантирует более полную защиту;
- Proxy позволяет выборочно контролировать доступ в интернет, фильтруя и блокируя определенный контент, VPN – нет;
- VPN гарантирует безопасность и конфиденциальность всех приложений и служб на устройстве. Proxy влияют только на настроенные приложения.


## Proxy

- __Прокси__ – сервер, который является посредником между интернетом и пользователем. Когда пользователь запрашивает веб-страницу, прокси передает запрос от его имени, маскируя IP-адрес пользователя. Прокси обеспечивает анонимность, кэширует контент и контролирует доступ к определенным веб-сайтам. Работает на уровне приложений OSI. Обычно не шифрует трафик, что позволяет его прослушивать.

### Использование

- Повышения конфиденциальности в сети;
- Обеспечения анонимности при проведении исследований и веб-скрейпинга;
- Фильтрации контента (например, ограничение доступа сотрудникам к соцсетям);
- Имитации различных сетевых условий и геолокации (например, для тестирования веб-сайтов).

### Типы

- Публичный прокси – бесплатные прокси, которыми одновременно пользуются много людей. Медленные, небезопасные и ненадежные;
- Приватный прокси – личный или общий прокси. Более быстрые, безопасны;
- Выделенный прокси – позволяет подключаться и отправлять запросы только одному клиенту;
- Прозрачный прокси – позволяет подключаться без доп. настроек. Весь трафик с порта клиента перенаправляется на порт прокси-сервера, посредством статических маршрутов;
- HTTP-прокси – сервер-посредник между клиентом и веб-сервером. При отправке запроса на сайт, запрос попадает на прокси-сервер в виде обычного текста, прокси анализирует запрос и посылает новый на сайт, используя данные из запроса;
- Прокси с использованием SSL – создается одно TCP-соединение. Когда пользователь инициирует веб-запрос, он посылает запрос CONNECT на веб-сервер и создает TCP-канал, по которому проходит запрос. В отличие от HTTP-прокси, может использоваться для подключения к ресурсам HTTPS;
- CGI-прокси (Common Gateway Interface) – используется через веб-браузер и выглядит как обычный веб-сайт. Работает через зашифрованную веб-форму, встроенную в другую веб-страницу с использованием SSL;
- SOCKS-прокси (SOCKets Security) – использует TCP соединение, которое предназначено для отправки и получения пакетов данных, гарантии успешной доставки ресурсов по сети. Трафик направляется через прокси по TCP от имени клиента. Скрывает IP клиента.


## Single Sign-on (SSO)
__SSO__ – механизм аутентификации, который позволяет пользователям получать доступ к нескольким приложениям, системам или веб-сайтам, вводя свои учетные данные только один раз. Пользователь может быстро и удобно перемещаться между несколькими платформами без необходимости многократной аутентификации. SSO упрощает управление пользователями и снижает риск нарушений безопасности, связанных с паролями. SSO включает OAuth, SAML, OpenID Connect.

### Ключевые компоненты
- Пользователь: человек, который хочет получить доступ к нескольким приложениям в среде;
- Поставщик услуг (SP): приложение, к которому пользователь пытается получить доступ;
- Поставщик удостоверений (IdP): сторонняя платформа, которая безопасно хранит и управляет удостоверениями пользователей, обеспечивая доступ к приложениям только авторизованным пользователям.

### Принцип работы
- Пользователь запрашивает доступ к Поставщику услуг;
- Поставщик услуг проверяет, прошел ли пользователь аутентификацию у поставщика удостоверений;
- В противном случае Пользователь перенаправляется на страницу входа в систему Поставщика удостоверений;
- Пользователь передает свои учетные данные для входа Поставщику удостоверений;
- Если учетные данные действительны, поставщик удостоверений выдает зашифрованный токен, называемый утверждением безопасности;
- Пользователь представляет этот токен Поставщику услуг в качестве доказательства аутентификации;
- Поставщик услуг проверяет токен и предоставляет доступ Пользователю.


## Kerberos
__Kerberos__ – протокол сетевой аутентификации, предназначенный для обеспечения строгой аутентификации для клиент-серверных приложений. Полагается на доверенную третью сторону KDC, которая поддерживает БД секретных ключей для каждого пользователя и службы в сети. Протокол использует криптографию с симметричным ключом. Предназначен для поддержки больших сетей. Для поддержания точного срока действия билетов и предотвращения атак повторного воспроизведения необходимо иметь синхронизированные часы.

Цель Kerberos: доказать идентичность клиента и сервера друг другу, чтобы они могли безопасно обмениваться информацией. Для этого используются билеты – зашифрованные сообщения, содержащие информацию о личности клиента, личности сервера и общий сеансовый ключ.

### Принцип работы
- Клиент запрашивает билет у KDC, предоставляя свое имя пользователя;
- KDC генерирует билет, шифрует его с помощью секретного ключа клиента и отправляет обратно клиенту;
- Клиент расшифровывает билет и получает сеансовый ключ, который он будет использовать для безопасного взаимодействия с сервером;
- Чтобы получить доступ к определенной службе, клиент запрашивает билет службы у KDC. Запрос включает билет и идентификатор целевого сервера;
- KDC генерирует билет службы, шифрует его с помощью секретного ключа и отправляет обратно клиенту;
- Клиент отправляет билет службы на сервер вместе с сообщением, зашифрованным с использованием сеансового ключа, для установления его личности;
- Сервер расшифровывает билет службы, извлекает сеансовый ключ и использует его для расшифровки сообщения клиента;
- После проверки личности клиента сервер разрешает доступ к запрошенной службе и отправляет зашифрованное сообщение для подтверждения аутентификации.


## Виды пентеста
- Internal & External Network Penetration Testing. Здесь нужно искать слабые узлы, плохо настроенные системы, уязвимости при передаче или получении данных, слабые пароли и другие возможности проникновения в сети. База: https://www.wireshark.org/;
- Wireless Penetration Testing;
- Web Application Testing.  Здесь мы говорим и про локальные, сетевые приложения, и про сайты. Подделывать запросы, пытаться получить доступ к БД, использовать вредоносные скрипты, мешать работе сеансов. База: https://portswigger.net/burp;
- Mobile Application Testing. Здесь мы говорим и про физический уровень, и про программный уровни. Искать слабые места сети, к которой подключено устройство, использовать брутфорс и другие возможности взлома. База: https://www.openwall.com/john/, https://www.aircrack-ng.org/;
- Build and Configuration Review. Дата-центры, серверные или любое другое охраняемое помещение – пентест должен проникнуть туда. А еще проверить системы видеонаблюдению, кондиционирования и другие. База: https://github.com/EntySec/CamOver, https://github.com/v1s1t0r1sh3r3/airgeddon;
- Social Engineering. Человеческий фактор – главная причина плохой кибербезопасности. Оценка возможности случайного слома системы, наивность в переписке через корпоративные порты, слабые пароли, ошибки в хранении и передачи данных. База: https://kali.tools/?p=1435;
- Cloud Penetration Testing;
- Agile Penetration Testing.


## Уровни контроля ИБ
- __Административный уровень__ включает разработку и установление политик безопасности, назначение ответственных лиц за обеспечение ИБ;
- __Логический уровень__ обеспечивает защиту информации путем использования ПО, шифрования данных, управления доступом, аутентификации пользователей, мониторинга сетевого трафика, управления конфигурацией систем;
- __Физический уровень__ направлен на обеспечение безопасности (системы видеонаблюдения, тревоги, защиты от пожара) физических объектов (здания, серверные помещения, ЦОД).


## Средства обеспечения ИБ
- __Физические преграды__ – организация контроля доступа к помещениям, физическая защита сетевой инфраструктуры;
- __Криптография__ – шифрование данных при передаче и хранении;
- __Управление доступом__ – разграничение прав доступа, использование многофакторной аутентификации;
- __Организационные средства__ – обучение персонала, управление рисками, проведение аудитов и другие организационные меры;
- __Антивирусное и антишпионское ПО__ – предназначено для обнаружения и удаления ВПО;
- __Брандмауэр__ – используется для контроля и фильтрации сетевого трафика;
- __VPN и прокси__ – обеспечивают безопасное соединение с сетью через шифрование трафика;
- __Сканеры уязвимостей__ – используются для поиска уязвимостей в сетях, приложениях, устройствах;
- __IPS/IDS__ – системы обнаружения и предотвращения вторжений мониторят сетевой трафик на предмет подозрительной активности, блокируют и предотвращают попытки несанкционированного доступа;
- __DLP (Data Leak Prevention)__ – системы, которые отслеживают и контролируют передачу данных, предотвращая утечки через сеть, почту, внешние устройства и другие каналы;
- __SIEM (Security Information and Event Management)__ – системы, которые собирают, анализируют, интерпретируют данные о безопасности с целью обнаружения угроз и реагирования на инциденты;
- __DevSecOps__ – практики комплексной защиты ПО в течение всего периода разработки;
- __EDR (Endpoint Detection and Response)__ – комплексные решения для обнаружения подозрительной активности на конечных точках корпоративных сетей. Фокусируются на обнаружении и реагировании на продвинутые угрозы, включая целенаправленные атаки, аномальное поведение пользователей и приложений;
- __CASB (Cloud Access Security Brokers)__ – система защиты между пользователями и облачными хранилищами и сервисами.


## Источники угроз ИБ
- __Несовершенное ПО или аппаратное обеспечение__ – устаревшие версии ПО или не обновляемая прошивка аппаратной части нередко содержат уязвимости, которые злоумышленники могут использовать для атак;
- __Неправильное функционирование систем__ – ошибочная конфигурация или неполное обновление системы также приводят к возникновению уязвимостей;
- __Уязвимости в протоколах__ – создать возможности для атак может некорректная реализация протоколов связи или интерфейсов, связывающих компоненты системы;
- __Сложные или несовершенные условия эксплуатации__ – нестандартные сценарии использования ПО или оборудования, недостаточное тестирование;
- __Человеческий фактор__ – ошибки персонала и недостаточное знание правил безопасности, фишинг и другие приемы социальной инженерии.


## Классификация угроз ИБ
- Угрозы по месту;
    - Внутренние – уязвимости в системе или компонентах; 
    - В пределах видимости – перехватывающая и прослушивающая аппаратура, кража данных с физических носителей, камер наблюдения;
    - Внешние – угрозы извне;
- Угрозы по видимости;
    - Активные – внесение изменений в систему;
    - Пассивные – отсутствие внесения изменений в логи;
- Угрозы по доступу;
    - Несанкционированный доступ – попытка получения доступа без разрешения или авторизации;
    - Утечка или повреждение данных – ошибочные или неправомерные действия сотрудника с доступом;
- Угрозы по цели;
    - Угрозы данным – попытки несанкционированного доступа с целью кражи данных или их изменения, порчи, удаления;
    - Угрозы программной среде – атаки на ПО, попытки внедрения ВПО, изменение программных компонентов;
    - Угрозы аппаратному обеспечению – физическое повреждение оборудования, кража, неправомерный доступ к аппаратным компонентам;
    - Угрозы поддерживающей инфраструктуре – атаки на сетевую инфраструктуру, серверы, БД;
- Угрозы по объективности;
    - Объективные – электромагнитные излучения, ВПО, бэкдоры, расположение объекта, наличие контролируемой зоны объекта;
    - Субъективные – ошибки при установке ПО, неправильная работа с личными данными, нарушение режима защищенности, уничтожение данных;
    - Случайные – сбои и отказы в работы инфраструктуры, неисправность, повреждения сетевых коммуникаций, систем киберзащиты.


## Виды физических атак
- Восстановление паролей BIOS и безопасность системы. Сброс настроек BIOS можно выполнить несколькими способами. В большинстве материнских плат установлена батарейка, которая, если ее вынуть примерно на 30 минут, сбросит настройки BIOS, включая пароль. Кроме того, на материнской плате можно установить перемычку, которая сбросит эти настройки путем подключения определенных контактов. Если аппаратные настройки невозможны или нецелесообразны, можно воспользоваться ПО. Запуск системы с Live CD/USB с помощью Kali Linux обеспечивает доступ к killCmos и CmosPWD, которые могут помочь в восстановлении пароля BIOS.
- Безопасность UEFI. Для систем, использующих UEFI вместо BIOS, можно использовать инструмент chipsec для анализа и изменения настроек UEFI, включая отключение Secure Boot.
- Анализ оперативной памяти и атаки на холодную загрузку. Оперативная память сохраняет данные после отключения питания недолго, обычно в течение 1-2 минут. Этот период можно продлить до 10 минут, применив холодные вещества, например, жидкий азот. В течение этого периода можно создать дамп памяти с помощью инструмента dd.exe и использовать его для анализа.
- Атаки на прямой доступ к памяти (DMA). INCEPTION – инструмент, предназначенный для манипулирования физической памятью через DMA, совместимый с интерфейсами FireWire и Thunderbolt. Он позволяет обходить процедуры входа в систему, подстраивая память так, чтобы она принимала любой пароль. Он неэффективен против Windows 10.
- Live CD/USB для доступа к системе. Замена системных двоичных файлов, таких как sethc.exe или Utilman.exe, копией cmd.exe может обеспечить командную строку с системными привилегиями. Инструмент chntpw может использоваться для редактирования SAM-файла установки Windows, позволяя изменять пароль. Kon-Boot – инструмент, который облегчает вход в систему Windows без знания пароля путем временной модификации ядра Windows или UEFI.
- Работа с функциями безопасности Windows. Supr – доступ к настройкам BIOS. F8 – вход в режим восстановления. Нажатие Shift после появления баннера Windows – обход автологина. Устройства Rubber Ducky и Teensyduino служат платформами для создания USB-устройств, способных выполнять заданную полезную нагрузку при подключении к целевому компьютеру. Привилегии администратора позволяют создавать копии конфиденциальных файлов, включая файл SAM, с помощью Powershell. Шифрование BitLocker можно обойти, если найти пароль восстановления в файле дампа памяти (MEMORY.DMP) (Для этого можно использовать инструменты Elcomsoft Forensic Disc Decryptor или Passware Kit Forensic). Новый ключ восстановления BitLocker может быть добавлен с помощью тактики социальной инженерии, убеждая пользователя выполнить команду, которая добавляет новый ключ восстановления, состоящий из нулей, тем самым упрощая процесс расшифровки.


## Влияние в социальной инженерии
- __Авторитет__. Использование авторитета может быть очень эффективным, так как люди склонны совершать определенные действия, когда кто-то, наделенный властью, просит их об этом или когда их заставляют поверить, что такое же действие совершает авторитетная фигура.
- __Привлекательность__. Люди, как правило, стремятся помочь тем, кого считают привлекательным и милым.
- __Срочность и дефицит__. Если есть риск, что человек чего-то не получит, он начинает хотеть этого намного сильнее. Занимаясь фишингом, многие злоумышленники заявляют, что продают или раздают что-то такое, чего существует лишь небольшое количество. Чтобы соблазнить жертву действовать, будь то переход по ссылке или ввод информации, они предлагают нечто ценное в сделке, которая слишком хороша чтобы быть правдой, но с оговоркой, что жертва должна действовать в кратчайший срок. В других случаях преступник может попытаться заставить заплатить выкуп за свою программу-вымогатель, выделяя жертве всего несколько часов на оплату, прежде чем безвозвратно удалить, украсть или обнародовать данные, - независимо от того, собирается ли он исполнить угрозу. В любом случае злоумышленник пытается напугать жертву и заставить ее действовать до того, как она успеет все обдумать.
- __Постоянство и последовательность__. Люди ценят постоянство и в большинстве своем не любят перемены. Специалисты по SE иногда остаются последовательным, а иногда нарушают постоянство и последовательность, чтобы влиять на жертву.
- __Социальное доказательство__. Люди часто делают что-то только потому что остальные считают это нормальным, уместным или статусным. Злоумышленник может попытаться убедить свою жертву в том, что определенное поведение или действие повышает социальный статус или что все другие эффективные сотрудники выполняют это действие. Убеждение собеседника в желательности чего-либо называется социальным доказательством. Социальное доказательство может быть придумано благодаря OSINT.
- __Взаимность__. Люди более охотно помогают людям, которые им помогали. Часто социальные пентестеры помогают кому-то, а затем просят сделать что-то взамен.


## Layers of Security
- Уровни безопасности позволяют минимизировать риск нарушений кибербезопасности, а в случае инцидента быстро и эффективно реагировать и восстанавливаться. Глубокоэшелонированная защита требует постоянного мониторинга и оценки общего состояния безопасности организации.
- __Физическая безопасность__ – защита объектов и оборудования организации от несанкционированного доступа или повреждения;
- __Контроль доступа__ – управление разрешениями для ограничения доступа пользователей к определенным ресурсам или данным;
- __Антивирусное ПО__ – обнаружение, удаление и предотвращение заражения ВПО;
- __Брандмауэры__ – фильтрация сетевого трафика для блокировки или разрешения передачи данных на основе заранее определенных правил;
- __IDPS__ – мониторинг и анализ сетевого трафика для обнаружения и предотвращения вторжений и вредоносных действий;
- __Бэкапы__ – обеспечение регулярного резервного копирования данных организации и возможности их полного восстановления в случае потери или случайного удаления;
- __Шифрование__ – кодирование конфиденциальных данных для защиты от несанкционированного доступа или кражи.


## Roles
- __Red team__ – команда, которая моделирует реальные атаки, выявляет уязвимости и проверяет эффективность защитных стратегий. Это внутренние и внешние члены команды, которые действуют как противники, используя творческий подход и передовые методы для проверки защиты кибербезопасности организации. Направления деятельности:
    - Регулярное тестирование на проникновение и оценка безопасности;
    - Использование методов социальной инженерии, чтобы эксплуатировать человеческие слабости;
    - Анализ и эксплуатация уязвимостей в системах, сетях и приложениях;
    - Эмуляция APT и сценариев атак;
    - Предоставление отчетов для улучшения состояния безопасности организации.
- __Blue team__ – команда, которая отвечает за защиту информационных систем, сетей, критически важных активов организации от угроз безопасности. Она осуществляет постоянный мониторинг систем, выявляет потенциальные инциденты безопасности и реагирует на них, принимая защитные меры. Направления деятельности:
    - Разработка и внедрение политики и процедур безопасности;
    - Оценка уязвимостей и рисков;
    - Развертывание инструментов и технологий безопасности;
    - Мониторинг журналов и анализ событий безопасности на предмет потенциальных угроз;
    - Реагирование и расследование инцидентов безопасности;
    - Проведение программ повышения осведомленности и обучения в области ИБ.
- __Purple team__ – команда, которая устраняет разрыв между blue team и red team, помогая создать среду более тесного сотрудничества. Она облегчает общение и обмен информацией между двумя командами, что в конечном итоге направлено на повышение общей эффективности программы безопасности. Направления деятельности:
    - Координация и планирование деятельности red team и blue team;
    - Обмен знаниями, методами и результатами между командами;
    - Помощь во внедрении выявленных улучшений безопасности;
    - Оценка и измерение эффективности мер безопасности;
    - Развитие культуры постоянного совершенствования и сотрудничества.
- __Внутренние пентестеры__ – пентестеры, которые работают внутри компании и постоянно выполняют пентесты для оценки безопасности, анализируют возможные уязвимости связанные с внутренними сетями, сотрудниками, бизнес-логикой и так далее.
- __Внешние пентестеры__ – пентестеры, которые работают вне организации, проводят пентест в сценарии, приближенном к реальной атаке.
Специалисты по безопасности приложений – ищут уязвимости в мобильных и веб-приложениях.
- __Физические пентестеры__ – проникают на объект клиента в офлайне (например, подделывают пропуск) с целью проверить процессы безопасности компании.
- __Эксперты по беспроводным сетям__ – ищут, исследуют и тестируют уязвимости, связанные с протоколами беспроводной связи.
- __Аудиторы__ – проводят полное исследование системы на предмет соответствия с законами, нормативными документами, внутренней политики организации.
- __Слепое тестирование__ – вид пентеста, где о нем знают только 1-2 человека в компании, причем они не имеют право разглашать эту информацию. Обычно этот вид проводят для понимания, как атакующий может обойти службу безопасности.


## HARDENING CONCEPTS
- __Принцип наименьших привилегий__: Предоставление только необходимых разрешений для выполнения их ролей и задач;
- __Глубокая защита__: Использование нескольких уровней безопасности;
- __Управление исправлениями__: Регулярное обновление и исправление систем;
- __Безопасная конфигурация__: Внедрение безопасных конфигураций, отключение ненужных служб;
- __Сегментация сети__: Разделение сети на более мелкие изолированные сегменты;
- __Шифрование__: Шифрование данных при хранении и передаче;
- __Регулярный аудит__: Проведение регулярных проверок безопасности системы, сети, приложений;
- __Обучение пользователей__: Осведомление пользователей об угрозах и методах безопасности.
- __MAC (Mandatory Access Control)__ – надежная модель безопасности, которая применяет строгие политики к ОС и приложениям в отношении доступа к системе. При усилении защиты на основе MAC конечным пользователям не разрешается изменять элементы управления доступом в системе. MAC работает на основе меток безопасности. Эти метки определяют права доступа и интегрируются в систему для классификации данных, ресурсов и пользователей. Как только эти метки установлены, ОС или доверенное ядро безопасности строго налагают ограничения на доступ к данным.
- __NAC (Network Access Control)__ – компонент повышения безопасности сетевой инфраструктуры, который предоставляет возможность контролировать и управлять доступом к сетевым ресурсам, гарантируя, что только авторизованные пользователи смогут подключаться к сети.
- __Port Blocking__ – практика для повышения безопасности сети и устройств. Предполагает ограничение, фильтрацию или полный отказ в доступе к определенным сетевым порта, чтобы минимизировать подверженность к угрозам. 
- __Group Policy__ – функция ОС Windows, которая позволяет определять и управлять конфигами, параметрами и политиками безопасности для различных аспектов пользователей и устройств в сети.
- __ACL (Access Control List)__ – функция безопасности, используемая для определения правил и ограничений для предоставления или запрета доступа к определенным ресурсам. Используется для управления правами доступа пользователей, гарантируя, что только авторизованные пользователи смогут получить доступ к конфиденциальной информации и ресурсам. Списки состоят из записей, определяющих разрешения, которые каждый пользователь или группа пользователей имеет для определенного ресурса. Типы ACL: DACL, MACL.
- __Sinkholes__ – механизм, который перенаправляет и изолирует вредоносный трафик. Используется для защиты от DDoS. Воронки перенаправляют вредоносный трафик на отдельный изолированный сервер или IP-адрес (Сервер воронки), предоставляют перенаправленный трафик для анализа.
- __Patching__ – процесс обновления, изменения или исправления ПО с целью устранения уязвимостей безопасности, повышения стабильности системы.
- __Jump Server__ – выделенный, заблокированный и безопасный сервер, расположенный в защищенной сети и предоставляющий контролирующую точку доступа для доступа к определенным компонентам системы. Промежуточный сервер действует как мост между ненадежными сетями и внутренними привилегированными системами, тем самым уменьшая поверхность атаки и защищая среду.
- __Endpoint Security__ – практика защиты отдельных устройств, подключающихся к сети, от потенциальных угроз. Конечные устройства используются в качестве точек входа для хакеров для доступа к системе. Поэтому важно обеспечить безопасность этих устройств.


## responder

> todo: как это юзать?

- Включает серверы аутентификации HTTP/SMB/MSSQL/FTP/LDAP, которые поддерживают такие методы аутентификации как NTLMv1/NTLMv2/LMv2, Extended Security NTLMSSP и базовую HTTP аутентификацию, для которых Responder выполняет роль ретранслятора. 
- Включает LLMNR, NBT-NS и MDNS poisoner, с помощью которых перенаправляет трафик с запросами и хешами аутентификации.
- Отвечает на определённые запросы NBT-NS, основываясь на их суффиксе имён.



## evil-winrm

> todo: как это юзать?

- Удаленное управление Windows;
- __WinRM__: Реализация протокола WS-Management (Стандартный протокол на основе SOAP, который позволяет взаимодействовать оборудованию и ОС разных производителей);
- Использует протокол PSRP (Powershell Remoting Protocol).